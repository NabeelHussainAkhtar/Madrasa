<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Bites n' More | Admin Dashboard</title>
    <!-- Tailwind CSS -->
    <script src="https://cdn.tailwindcss.com"></script>
    <!-- Google Fonts - Inter for text, Pacifico for logo -->
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;600;700&family=Pacifico&display=swap"
        rel="stylesheet">
    <!-- Font Awesome for icons -->
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <style>
        body {
            font-family: 'Inter', sans-serif;
            background-color: #f7f7f7;
            scroll-behavior: smooth;
        }
        .logo-font {
            font-family: 'Pacifico', cursive;
        }
    </style>
</head>

<body class="bg-gray-50 text-gray-800">
    <!-- Header -->
    <header class="bg-white shadow-md sticky top-0 z-50">
        <nav class="container mx-auto px-6 py-3 flex justify-between items-center">
            <a href="#" id="home-link" class="flex items-center space-x-2">
                <div id="logo-container">
                    <svg class="h-10 w-10 text-red-600" width="24" height="24" viewBox="0 0 24 24" fill="none"
                        xmlns="http://www.w3.org/2000/svg">
                        <path
                            d="M12 2C6.48 2 2 6.48 2 12C2 17.52 6.48 22 12 22C17.52 22 22 17.52 22 12C22 6.48 17.52 2 12 2ZM16.83 15.42C16.5 15.75 16.03 16 15.5 16H8.5C7.97 16 7.5 15.75 7.17 15.42C6.55 14.8 6.25 13.97 6.5 13.2L8.28 7.38C8.55 6.56 9.25 6 10.12 6H13.88C14.75 6 15.45 6.56 15.72 7.38L17.5 13.2C17.75 13.97 17.45 14.8 16.83 15.42Z"
                            fill="#EF4444" />
                        <path d="M12 4C9.79 4 8 5.79 8 8V10H16V8C16 5.79 14.21 4 12 4Z" fill="#FBBF24" />
                    </svg>
                </div>
                <span class="text-2xl font-bold text-red-600 logo-font">BnM Admin</span>
            </a>
            <div id="auth-buttons" class="flex space-x-4">
                <button id="change-password-btn"
                    class="bg-blue-600 text-white font-semibold px-4 py-2 rounded-full hover:bg-blue-700 transition duration-300">
                    Change Password
                </button>
                <button id="logout-btn"
                    class="bg-gray-500 text-white font-semibold px-4 py-2 rounded-full hover:bg-gray-600 transition duration-300">
                    Logout
                </button>
            </div>
        </nav>
    </header>

    <main id="main-content" class="page-container">
        <div class="container mx-auto px-6 py-12">
            <h2 class="text-4xl font-bold mb-8 text-gray-900">Admin Dashboard</h2>
            <div class="grid grid-cols-1 lg:grid-cols-2 gap-12">
                <!-- Section 1: Manage Delivery Partners -->
                <div class="bg-white p-8 rounded-xl shadow-lg">
                    <h3 class="text-2xl font-bold text-red-600 mb-6">Manage Delivery Partners</h3>
                    <form id="add-delivery-form" class="space-y-4 mb-8">
                        <input type="text" id="delivery-username" placeholder="New Partner Username" required class="w-full px-4 py-2 border rounded-md">
                        <input type="password" id="delivery-password" placeholder="Password" required class="w-full px-4 py-2 border rounded-md">
                        <button type="submit" class="w-full bg-green-600 text-white py-2 rounded-md font-semibold hover:bg-green-700 transition">Add Partner</button>
                    </form>
                    <div>
                        <h4 class="text-xl font-semibold mb-4">Current Partners</h4>
                        <ul id="delivery-list" class="space-y-2"></ul>
                    </div>
                </div>

                <!-- Section 2: Manage Categories & Menu Items -->
                <div class="bg-white p-8 rounded-xl shadow-lg">
                    <h3 class="text-2xl font-bold text-red-600 mb-6">Manage Menu</h3>
                    <div class="space-y-4 mb-8">
                        <h4 class="text-xl font-semibold">Categories</h4>
                        <form id="add-category-form" class="flex space-x-2">
                            <input type="text" id="new-category-name" placeholder="New Category Name" required class="flex-grow px-4 py-2 border rounded-md">
                            <button type="submit" class="bg-blue-600 text-white py-2 px-4 rounded-md font-semibold hover:bg-blue-700 transition">Add</button>
                        </form>
                        <ul id="category-list" class="space-y-2"></ul>
                    </div>
                    <div class="space-y-4 mb-8">
                        <h4 class="text-xl font-semibold">Menu Items</h4>
                        <form id="add-menu-item-form" class="space-y-4">
                            <select id="item-category" class="w-full px-4 py-2 border rounded-md" required></select>
                            <input type="text" id="menu-name" placeholder="Item Name" required class="w-full px-4 py-2 border rounded-md">
                            <input type="number" id="menu-price" placeholder="Price" required class="w-full px-4 py-2 border rounded-md">
                            <input type="url" id="menu-image" placeholder="Image URL" class="w-full px-4 py-2 border rounded-md">
                            <button type="submit" class="w-full bg-blue-600 text-white py-2 rounded-md font-semibold hover:bg-blue-700 transition">Add Menu Item</button>
                        </form>
                        <ul id="menu-list" class="space-y-4"></ul>
                    </div>
                </div>

                <!-- Section 3: Manage About Us & Reviews -->
                <div class="bg-white p-8 rounded-xl shadow-lg lg:col-span-2">
                    <h3 class="text-2xl font-bold text-red-600 mb-6">Manage Content</h3>
                    <div class="mb-8">
                        <h4 class="text-xl font-semibold mb-4">About Us Content</h4>
                        <textarea id="about-us-textarea" class="w-full p-4 border rounded-md resize-y" rows="8"></textarea>
                        <button id="save-about-us-btn" class="mt-4 bg-purple-600 text-white py-2 px-6 rounded-md font-semibold hover:bg-purple-700 transition">Save About Us</button>
                    </div>
                    <div>
                        <h4 class="text-xl font-semibold mb-4">Customer Reviews</h4>
                        <div id="admin-reviews-list" class="space-y-4"></div>
                        <form id="add-review-form" class="mt-8 space-y-4">
                            <h5 class="font-semibold">Add New Review</h5>
                            <input type="text" id="review-name" placeholder="Customer Name" required class="w-full px-4 py-2 border rounded-md">
                            <input type="number" id="review-rating" placeholder="Rating (1-5)" min="1" max="5" step="0.5" required class="w-full px-4 py-2 border rounded-md">
                            <textarea id="review-comment" placeholder="Review Comment" required class="w-full p-4 border rounded-md resize-y" rows="3"></textarea>
                            <button type="submit" class="w-full bg-green-600 text-white py-2 rounded-md font-semibold hover:bg-green-700 transition">Add Review</button>
                        </form>
                    </div>
                </div>

                <!-- Section 4: View Orders -->
                <div class="bg-white p-8 rounded-xl shadow-lg lg:col-span-2">
                    <h3 class="text-2xl font-bold text-red-600 mb-6">View All Orders</h3>
                    <div id="admin-orders-list" class="space-y-4">
                        <p class="text-gray-500">No new orders yet.</p>
                    </div>
                </div>
            </div>
        </div>
    </main>

    <!-- Footer -->
    <footer class="bg-gray-900 text-white">
        <div class="container mx-auto px-6 py-8">
            <div class="flex flex-col md:flex-row justify-between items-center">
                <div class="mb-4 md:mb-0 text-center md:text-left">
                    <h3 class="text-xl font-bold">BnM</h3>
                    <p class="text-gray-400">© 2024 All Rights Reserved.</p>
                    <p class="text-xs text-gray-500 mt-2">Developed with ❤️ by Nabeel Hussain Akhtar</p>
                </div>
                <div class="flex space-x-4">
                    <a href="#" class="text-gray-400 hover:text-white"><i class="fab fa-facebook-f fa-lg"></i></a>
                    <a href="#" class="text-gray-400 hover:text-white"><i class="fab fa-instagram fa-lg"></i></a>
                    <a href="#" class="text-gray-400 hover:text-white"><i class="fab fa-twitter fa-lg"></i></a>
                </div>
            </div>
        </div>
    </footer>

    <!-- MODALS AND POPUPS -->
    <div id="message-modal"
        class="fixed inset-0 bg-black bg-opacity-50 hidden items-center justify-center p-4 z-[100]">
        <div class="bg-white rounded-xl shadow-2xl p-6 w-full max-w-md transform transition-all">
            <h3 id="modal-title" class="text-2xl font-bold mb-4"></h3>
            <p id="modal-message" class="text-gray-700 mb-6"></p>
            <div class="flex justify-end">
                <button id="modal-close-btn"
                    class="bg-red-600 text-white px-6 py-2 rounded-lg font-semibold hover:bg-red-700 transition">
                    OK
                </button>
            </div>
        </div>
    </div>
    
    <div id="password-modal"
        class="fixed inset-0 bg-black bg-opacity-50 hidden items-center justify-center p-4 z-[100]">
        <div class="bg-white rounded-xl shadow-2xl p-6 w-full max-w-md transform transition-all">
            <h3 class="text-2xl font-bold mb-4">Change Password</h3>
            <form id="change-password-form" class="space-y-4">
                <div>
                    <input type="password" id="old-password" placeholder="Current Password" required
                        class="w-full px-5 py-3 border border-gray-300 rounded-lg focus:ring-red-500 focus:border-red-500">
                </div>
                <div>
                    <input type="password" id="new-password" placeholder="New Password" required
                        class="w-full px-5 py-3 border border-gray-300 rounded-lg focus:ring-red-500 focus:border-red-500">
                </div>
                <div>
                    <input type="password" id="confirm-new-password" placeholder="Confirm New Password" required
                        class="w-full px-5 py-3 border border-gray-300 rounded-lg focus:ring-red-500 focus:border-red-500">
                </div>
                <div class="flex justify-end space-x-4 mt-6">
                    <button type="button" id="cancel-password-change-btn"
                        class="bg-gray-400 text-white px-6 py-2 rounded-lg font-semibold hover:bg-gray-500 transition">
                        Cancel
                    </button>
                    <button type="submit"
                        class="bg-blue-600 text-white px-6 py-2 rounded-lg font-semibold hover:bg-blue-700 transition">
                        Change
                    </button>
                </div>
            </form>
        </div>
    </div>

    <!-- SCRIPT FOR ALL FUNCTIONALITY -->
    <script>
        document.addEventListener('DOMContentLoaded', () => {

            let appState = {
                loggedInUser: null,
                users: {
                    'BnM': { password: 'Qwerty@321', role: 'admin' },
                    'Delivery': { password: 'Burger321', role: 'delivery' }
                },
                aboutUsContent: `
                    <p class="text-lg text-gray-600 mb-6">
                        Welcome to **Bites n' More**, your go-to spot for delicious, high-quality fast food in Kalaburagi. Our mission is simple: to serve you happiness, one bite at a time. We believe in crafting mouth-watering meals using the freshest ingredients, all prepared with a touch of love.
                    </p>
                    <p class="text-lg text-gray-600 mb-6">
                        From our crispy, loaded French fries to our juicy, perfectly seasoned burgers, every item on our menu is designed to give you a memorable culinary experience. We're proud to offer quick and efficient service, whether you're dining in, taking away, or getting it delivered right to your doorstep within a 3km radius.
                    </p>
                    <p class="text-lg text-gray-600">
                        Join us at Bites n' More and discover why we're more than just a food joint—we're a place where great food meets great times.
                    </p>
                `,
                reviews: [
                    {
                        name: 'Anjali Gupta',
                        rating: 5,
                        comment: "Absolutely fantastic! The Tandoori Pizza was loaded with toppings and had the perfect cheesy pull. The staff is friendly and the service is quick. A must-visit spot in Kalaburagi!",
                        image: 'https://images.unsplash.com/photo-1535713875002-d1d0cf377fde?q=80&w=2960&auto=format&fit=crop'
                    },
                    {
                        name: 'Vikram Singh',
                        rating: 5,
                        comment: "Ordered from here for the first time and was super impressed. The delivery was right on time, and the food was packed neatly. The prices are very reasonable for the quality you get. The loaded fries are a game-changer!",
                        image: 'https://images.unsplash.com/photo-1507003211169-0a1dd7228f2d?q=80&w=2787&auto=format&fit=crop'
                    },
                    {
                        name: 'Sneha Patil',
                        rating: 4.5,
                        comment: "A great place to hang out with friends. The vibe is very chill and modern. Their Watermelon Mojito is so refreshing! We had a great time and will definitely be back for more.",
                        image: 'https://images.unsplash.com/photo-1494790108377-be9c29b29330?q=80&w=2787&auto=format&fit=crop'
                    },
                ],
                adminCode: 'admin123',
                deliveryCode: 'delivery456',
                deliveryPartners: [],
                categories: [
                    { id: 'appetizers', name: 'Appetizers' },
                    { id: 'main-course', name: 'Main Course' },
                    { id: 'beverages', name: 'Beverages' }
                ],
                menuItems: [
                    {
                        id: 'f1',
                        name: 'French Fries',
                        price: 30,
                        image: 'https://images.unsplash.com/photo-1585109649234-36639308246a?q=80&w=2787&auto=format&fit=crop',
                        categoryId: 'appetizers'
                    },
                    {
                        id: 'pt1',
                        name: 'Potato Twister',
                        price: 50,
                        image: 'https://images.unsplash.com/photo-1621852004184-755a4365455d?q=80&w=2787&auto=format&fit=crop',
                        categoryId: 'appetizers'
                    },
                    {
                        id: 'b1',
                        name: 'Crispy Chicken Burger',
                        price: 90,
                        image: 'https://images.unsplash.com/photo-1571091718767-18b5b1457add?q=80&w=2942&auto=format&fit=crop',
                        categoryId: 'main-course'
                    },
                    {
                        id: 'coke',
                        name: 'Coca-Cola',
                        price: 20,
                        image: 'https://images.unsplash.com/photo-1567103482594-b20de4690835?q=80&w=2835&auto=format&fit=crop',
                        categoryId: 'beverages'
                    }
                ],
                orders: [],
                cart: [],
                serviceType: null,
                tableNumber: null,
                customerInfo: null
            };

            const orderQuotes = [
                "Life is too short to miss out on a good burger.",
                "Fries: the most delicious gateway to happiness.",
                "A balanced diet is a burger in each hand.",
                "Don't cry because it's over, smile because it happened. And eat more burgers."
            ];

            const homeLink = document.getElementById('home-link');
            const logoutBtn = document.getElementById('logout-btn');
            const changePasswordBtn = document.getElementById('change-password-btn');

            const messageModal = document.getElementById('message-modal');
            const modalTitle = document.getElementById('modal-title');
            const modalMessage = document.getElementById('modal-message');
            const modalCloseBtn = document.getElementById('modal-close-btn');

            const passwordModal = document.getElementById('password-modal');
            const changePasswordForm = document.getElementById('change-password-form');
            const cancelPasswordChangeBtn = document.getElementById('cancel-password-change-btn');
            
            // =================================================================
            // UTILITY FUNCTIONS
            // =================================================================
            const showMessageModal = (title, message) => {
                modalTitle.textContent = title;
                modalMessage.textContent = message;
                messageModal.classList.remove('hidden');
                messageModal.classList.add('flex');
            };

            modalCloseBtn.addEventListener('click', () => {
                messageModal.classList.remove('flex');
                messageModal.classList.add('hidden');
            });
            
            const saveAppState = () => {
                localStorage.setItem('bitesNMoreState', JSON.stringify(appState));
            };

            const loadAppState = () => {
                const storedState = localStorage.getItem('bitesNMoreState');
                if (storedState) {
                    const parsedState = JSON.parse(storedState);
                    Object.assign(appState, parsedState);
                }
            };
            
            const logout = () => {
                appState.loggedInUser = null;
                saveAppState();
                window.location.href = 'index.html';
            };

            // =================================================================
            // ADMIN-SPECIFIC LOGIC
            // =================================================================

            const handleAddDeliveryPartner = (e) => {
                e.preventDefault();
                const username = document.getElementById('delivery-username').value;
                const password = document.getElementById('delivery-password').value;

                if (appState.users[username]) {
                    showMessageModal('Error', 'A user with this username already exists.');
                    return;
                }

                appState.users[username] = { password, role: 'delivery' };
                appState.deliveryPartners.push(username);
                saveAppState();
                renderDeliveryPartners();
                document.getElementById('add-delivery-form').reset();
                showMessageModal('Success', `${username} has been added as a delivery partner.`);
            };

            const handleDeleteDeliveryPartner = (e) => {
                const usernameToDelete = e.currentTarget.dataset.username;
                appState.deliveryPartners = appState.deliveryPartners.filter(partner => partner !== usernameToDelete);
                delete appState.users[usernameToDelete];
                saveAppState();
                renderDeliveryPartners();
                showMessageModal('Success', `${usernameToDelete} has been deleted.`);
            };

            const renderDeliveryPartners = () => {
                const deliveryList = document.getElementById('delivery-list');
                if (!deliveryList) return;

                deliveryList.innerHTML = '';
                appState.deliveryPartners.forEach(partner => {
                    const li = document.createElement('li');
                    li.className = "flex justify-between items-center bg-gray-50 p-3 rounded-md";
                    li.innerHTML = `
                        <span class="font-medium">${partner}</span>
                        <div class="space-x-2">
                            <button data-username="${partner}" class="delete-delivery-btn text-red-500 hover:text-red-700 transition">
                                <i class="fas fa-trash-alt"></i> Delete
                            </button>
                        </div>
                    `;
                    deliveryList.appendChild(li);
                });

                document.querySelectorAll('.delete-delivery-btn').forEach(button => {
                    button.addEventListener('click', handleDeleteDeliveryPartner);
                });
            };

            const handleAddCategory = (e) => {
                e.preventDefault();
                const name = document.getElementById('new-category-name').value;
                const id = name.toLowerCase().replace(/\s/g, '-');
                
                if (appState.categories.some(cat => cat.id === id)) {
                    showMessageModal('Error', 'Category already exists.');
                    return;
                }
                
                appState.categories.push({ id, name });
                saveAppState();
                renderCategoriesAdmin();
                renderAdminMenu();
                document.getElementById('add-category-form').reset();
                showMessageModal('Success', `${name} category added.`);
            };

            const renderCategoriesAdmin = () => {
                const categorySelect = document.getElementById('item-category');
                const categoryList = document.getElementById('category-list');
                
                if (!categorySelect || !categoryList) return;

                categorySelect.innerHTML = appState.categories.map(cat => `<option value="${cat.id}">${cat.name}</option>`).join('');
                
                categoryList.innerHTML = appState.categories.map(cat => `
                    <li class="flex justify-between items-center bg-gray-50 p-3 rounded-md">
                        <span class="font-medium">${cat.name}</span>
                        <button data-category-id="${cat.id}" class="delete-category-btn text-red-500 hover:text-red-700 transition">
                            <i class="fas fa-trash-alt"></i>
                        </button>
                    </li>
                `).join('');

                document.querySelectorAll('.delete-category-btn').forEach(button => {
                    button.addEventListener('click', handleDeleteCategory);
                });
            };

            const handleDeleteCategory = (e) => {
                const idToDelete = e.currentTarget.dataset.categoryId;
                appState.categories = appState.categories.filter(cat => cat.id !== idToDelete);
                appState.menuItems = appState.menuItems.filter(item => item.categoryId !== idToDelete);
                saveAppState();
                renderCategoriesAdmin();
                renderAdminMenu();
                showMessageModal('Success', 'Category and its items have been deleted.');
            };

            const handleAddMenuItem = (e) => {
                e.preventDefault();
                const name = document.getElementById('menu-name').value;
                const price = parseFloat(document.getElementById('menu-price').value);
                const image = document.getElementById('menu-image').value || 'https://placehold.co/600x400/cccccc/ffffff?text=Image+Not+Found';
                const categoryId = document.getElementById('item-category').value;

                const newItem = {
                    id: 'item-' + Date.now(),
                    name,
                    price,
                    image,
                    categoryId
                };

                appState.menuItems.push(newItem);
                saveAppState();
                renderAdminMenu();
                document.getElementById('add-menu-item-form').reset();
                showMessageModal('Success', `${name} has been added to the menu.`);
            };

            const renderAdminMenu = () => {
                const menuList = document.getElementById('menu-list');
                if (!menuList) return;

                menuList.innerHTML = '';
                appState.menuItems.forEach(item => {
                    const categoryName = appState.categories.find(cat => cat.id === item.categoryId)?.name || 'N/A';
                    const li = document.createElement('li');
                    li.className = "flex justify-between items-center bg-gray-50 p-3 rounded-md";
                    li.innerHTML = `
                        <span class="font-medium">${item.name} (${categoryName}) - ₹${item.price}</span>
                        <div class="space-x-2">
                            <button data-id="${item.id}" class="delete-menu-item-btn text-red-500 hover:text-red-700 transition">
                                <i class="fas fa-trash-alt"></i> Delete
                            </button>
                        </div>
                    `;
                    menuList.appendChild(li);
                });

                document.querySelectorAll('.delete-menu-item-btn').forEach(button => {
                    button.addEventListener('click', handleDeleteMenuItem);
                });
            };

            const handleDeleteMenuItem = (e) => {
                const idToDelete = e.currentTarget.dataset.id;
                appState.menuItems = appState.menuItems.filter(item => item.id !== idToDelete);
                saveAppState();
                renderAdminMenu();
                showMessageModal('Success', `Menu item has been deleted.`);
            };

            const handleSaveAboutUs = () => {
                const newContent = document.getElementById('about-us-textarea').value;
                appState.aboutUsContent = newContent;
                saveAppState();
                showMessageModal('Success', 'About Us content updated successfully!');
            };

            const renderAdminReviews = () => {
                const reviewsList = document.getElementById('admin-reviews-list');
                if (!reviewsList) return;

                reviewsList.innerHTML = appState.reviews.map((review, index) => `
                    <div class="bg-gray-50 p-4 rounded-lg shadow space-y-2">
                        <p class="font-bold text-lg">${review.name}</p>
                        <p class="text-sm text-gray-600">Rating: ${'⭐'.repeat(Math.floor(review.rating))} ${review.rating % 1 !== 0 ? '½' : ''} (${review.rating})</p>
                        <p class="italic text-gray-800">"${review.comment}"</p>
                        <div class="flex justify-end">
                            <button data-index="${index}" class="delete-review-btn text-red-500 hover:text-red-700 transition">
                                <i class="fas fa-trash-alt"></i> Delete
                            </button>
                        </div>
                    </div>
                `).join('');

                document.querySelectorAll('.delete-review-btn').forEach(button => {
                    button.addEventListener('click', handleDeleteReview);
                });
            };

            const handleDeleteReview = (e) => {
                const indexToDelete = e.currentTarget.dataset.index;
                appState.reviews.splice(indexToDelete, 1);
                saveAppState();
                renderAdminReviews();
                showMessageModal('Success', 'Review deleted successfully.');
            };

            const handleAddReview = (e) => {
                e.preventDefault();
                const name = document.getElementById('review-name').value;
                const rating = parseFloat(document.getElementById('review-rating').value);
                const comment = document.getElementById('review-comment').value;

                if (rating < 1 || rating > 5) {
                    showMessageModal('Error', 'Rating must be between 1 and 5.');
                    return;
                }

                appState.reviews.push({
                    name,
                    rating,
                    comment,
                    image: 'https://placehold.co/100x100/cccccc/ffffff?text=User'
                });
                saveAppState();
                renderAdminReviews();
                document.getElementById('add-review-form').reset();
                showMessageModal('Success', 'Review added successfully!');
            };

            const renderAdminOrders = () => {
                const ordersList = document.getElementById('admin-orders-list');
                if (!ordersList) return;

                if (appState.orders.length === 0) {
                    ordersList.innerHTML = '<p class="text-gray-500">No new orders yet.</p>';
                    return;
                }

                ordersList.innerHTML = appState.orders.map(order => `
                    <div class="bg-gray-50 p-4 rounded-lg shadow space-y-2">
                        <p class="font-semibold text-lg">Order ID: ${order.id}</p>
                        <p><strong>Customer:</strong> ${order.customer}</p>
                        <p><strong>Service:</strong> <span class="font-bold">${order.service}</span></p>
                        ${order.code ? `<p><strong>Code:</strong> <span class="font-bold">${order.code}</span></p>` : ''}
                        ${order.table ? `<p><strong>Table:</strong> <span class="font-bold">${order.table}</span></p>` : ''}
                        ${order.deliveryInfo ? `
                            <h4 class="font-semibold mt-4">Delivery Info:</h4>
                            <p><strong>Name:</strong> ${order.deliveryInfo.name}</p>
                            <p><strong>Phone:</strong> ${order.deliveryInfo.phone}</p>
                            <p><strong>Address:</strong> ${order.deliveryInfo.address}, ${order.deliveryInfo.landmark}</p>
                            <p><strong>Location:</strong> <button class="view-map-btn text-blue-500 hover:underline" data-lat="${order.deliveryInfo.location.lat}" data-lng="${order.deliveryInfo.location.lng}">View on Map</button></p>
                        ` : ''}
                        <div class="mt-2 pt-2 border-t border-gray-200">
                            <p class="font-semibold">Items:</p>
                            <ul class="list-disc list-inside">
                                ${order.items.map(i => `<li>${i.name} (x${i.quantity}) - ₹${i.price * i.quantity}</li>`).join('')}
                            </ul>
                        </div>
                        <div class="mt-4 pt-4 border-t border-gray-200 flex justify-between items-center">
                            <p class="font-bold text-lg">Status: <span class="text-blue-500">${order.status}</span></p>
                            <select data-id="${order.id}" class="status-select bg-white border border-gray-300 rounded-md py-1 px-2">
                                <option value="Pending" ${order.status === 'Pending' ? 'selected' : ''}>Pending</option>
                                <option value="Preparing" ${order.status === 'Preparing' ? 'selected' : ''}>Preparing</option>
                                <option value="Out for Delivery" ${order.status === 'Out for Delivery' ? 'selected' : ''}>Out for Delivery</option>
                                <option value="Completed" ${order.status === 'Completed' ? 'selected' : ''}>Completed</option>
                            </select>
                        </div>
                    </div>
                `).join('');

                document.querySelectorAll('.status-select').forEach(select => {
                    select.addEventListener('change', (e) => handleOrderAction(e.target.value)(e));
                });
                document.querySelectorAll('.view-map-btn').forEach(button => {
                    button.addEventListener('click', (e) => {
                        const lat = e.target.dataset.lat;
                        const lng = e.target.dataset.lng;
                        window.open(`https://www.google.com/maps/dir/?api=1&destination=${lat},${lng}`, '_blank');
                    });
                });
            };

            const handleOrderAction = (newStatus) => (e) => {
                const orderId = e.currentTarget.dataset.id;
                const order = appState.orders.find(o => o.id === orderId);
                if (order) {
                    order.status = newStatus;
                    saveAppState();
                    renderAdminOrders();
                    showMessageModal('Success', `Order ${orderId} has been marked as ${newStatus}.`);
                }
            };
            
            const handleChangePassword = (e) => {
                e.preventDefault();
                const oldPassword = document.getElementById('old-password').value;
                const newPassword = document.getElementById('new-password').value;
                const confirmNewPassword = document.getElementById('confirm-new-password').value;
                
                const loggedInUser = appState.loggedInUser;
                const currentUser = appState.users[loggedInUser.username];

                if (oldPassword !== currentUser.password) {
                    showMessageModal('Change Password Failed', 'Incorrect current password.');
                    return;
                }
                
                if (newPassword !== confirmNewPassword) {
                    showMessageModal('Change Password Failed', 'New passwords do not match.');
                    return;
                }
                
                if (newPassword === oldPassword) {
                    showMessageModal('Change Password Failed', 'New password must be different from the old one.');
                    return;
                }

                currentUser.password = newPassword;
                saveAppState();
                passwordModal.classList.add('hidden');
                passwordModal.classList.remove('flex');
                showMessageModal('Success!', 'Your password has been changed successfully.');
            };

            // =================================================================
            // INITIALIZATION AND EVENT LISTENERS
            // =================================================================
            
            const initAdminDashboard = () => {
                loadAppState();
                if (appState.loggedInUser?.role !== 'admin') {
                    window.location.href = 'index.html'; // Redirect to home if not admin
                    return;
                }

                document.getElementById('about-us-textarea').value = appState.aboutUsContent;
                document.getElementById('add-delivery-form').addEventListener('submit', handleAddDeliveryPartner);
                document.getElementById('add-category-form').addEventListener('submit', handleAddCategory);
                document.getElementById('add-menu-item-form').addEventListener('submit', handleAddMenuItem);
                document.getElementById('save-about-us-btn').addEventListener('click', handleSaveAboutUs);
                document.getElementById('add-review-form').addEventListener('submit', handleAddReview);
                logoutBtn.addEventListener('click', logout);
                changePasswordBtn.addEventListener('click', () => {
                    passwordModal.classList.remove('hidden');
                    passwordModal.classList.add('flex');
                    changePasswordForm.reset();
                });
                cancelPasswordChangeBtn.addEventListener('click', () => {
                    passwordModal.classList.add('hidden');
                    passwordModal.classList.remove('flex');
                });
                changePasswordForm.addEventListener('submit', handleChangePassword);
                homeLink.addEventListener('click', (e) => {
                    e.preventDefault();
                    window.location.href = 'index.html';
                });
                
                renderDeliveryPartners();
                renderCategoriesAdmin();
                renderAdminMenu();
                renderAdminOrders();
                renderAdminReviews();
            }

            initAdminDashboard();
        });
    </script>
</body>

</html>
