<!--
Madrasa Website (Bilingual: Urdu default + English)
Single-file frontend demo using Bootstrap 5, localStorage-based admin simulation.
Features:
- Urdu default (RTL) with language toggle (Urdu <-> English)
- Pages: Home, About, Courses, Gallery, Contact (single page sections)
- Scrolling announcements (admin editable)
- Admin panel (simple login, manage announcements, courses, gallery uploads, view contact messages)
- Responsive layout and accessible design

Updates:
- Prioritized 'Jameel Noori Nastaleeq' font and added 'Noto Nastaliq Urdu' web font.
- Added specific address, phone, and map link to contact section.
- Replaced all 'alert()' popups with a non-blocking toast notification system.
- Added Dark Mode toggle.
- Added scrolling marquee for announcements.
- Added Admin Logo upload/remove feature.
- Added Donation button/modal with UPI QR code and copy button.
- Updated gallery to use square aspect-ratio tiles.
- Fixed contact info LTR/RTL rendering bug.
- Replaced non-working library iframe with a link card.
-->

<!doctype html>
<html lang="ur" dir="rtl">
<head>
  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <title>دارالتعلیم والتربیہ - Darut Taleem Wat Tarbiyah</title>

  <!-- Bootstrap 5 -->
  <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/css/bootstrap.min.css" rel="stylesheet">

  <!-- Google Fonts: Poppins for English, Noto Nastaliq Urdu for fallback -->
  <link href="https://fonts.googleapis.com/css2?family=Noto+Nastaliq+Urdu:wght@400;700&family=Poppins:wght@300;400;600&display=swap" rel="stylesheet">

  <style>
    :root{
      --primary:#007A3D; /* green */
      --secondary:#F7C948; /* gold */
      --bg:#ffffff;
    }
    /* Updated font stack to prioritize user's request */
    html[dir="rtl"] body{font-family: 'Jameel Noori Nastaleeq', 'Noto Nastaliq Urdu', 'Noto Naskh Arabic', 'Noto Serif', serif;}
    html[dir="ltr"] body{font-family: 'Poppins', system-ui, -apple-system, 'Segoe UI', Roboto, 'Helvetica Neue', Arial;}

    body{background:var(--bg); color:#222; transition: background-color 0.3s, color 0.3s;}
    .navbar{background:linear-gradient(90deg,var(--primary), rgba(0,122,61,.9));}
    .navbar .nav-link, .navbar-brand{color:#fff !important}
    .hero{background: linear-gradient( rgba(0,0,0,0.25), rgba(0,0,0,0.25) ), url('https://images.unsplash.com/photo-1523942839745-7844d3d58c73?q=80&w=1770&auto=format&fit=crop&ixlib=rb-4.0.3&s=') center/cover no-repeat; color:#fff; padding:80px 0}
    .accent{color:var(--primary)}
    .card-course{border:1px solid #eee}
    
    /* Announcement bar - updated for marquee */
    .announcement-bar {
      background: var(--primary);
      color: #fff;
      padding: .25rem 0;
      font-weight: 600;
      overflow: hidden;
      white-space: nowrap;
    }
    .announcement-text {
      display: inline-block;
      padding-left: 100%; /* Start off-screen */
      animation: marquee 30s linear infinite;
    }
    /* RTL marquee */
    [dir="rtl"] .announcement-text {
      animation-name: marquee-rtl;
      padding-right: 100%;
      padding-left: 0;
    }

    @keyframes marquee {
      0% { transform: translateX(0%); }
      100% { transform: translateX(-100%); }
    }
    @keyframes marquee-rtl {
      0% { transform: translateX(0%); }
      100% { transform: translateX(100%); }
    }
    
    .footer{background:#0b5132; color:#fff; padding:20px 0}

    /* Gallery grid - updated for "perfect blocks" */
    .gallery-grid{display:grid; grid-template-columns: repeat(auto-fit,minmax(180px,1fr)); gap:12px}
    .gallery-grid img{
      width:100%; 
      height: auto; /* Changed from 160px */
      aspect-ratio: 1 / 1; /* Makes it a perfect square */
      object-fit:cover; 
      border-radius:8px
    }

    /* Admin panel */
    .admin-panel{min-height:60vh}

    /* Responsive tweaks */
    @media(min-width:992px){ .hero{padding:100px 0} }

    /* RTL friendly card headings */
    [dir="rtl"] .section-title{display:flex; align-items:center; gap:.6rem; justify-content:flex-end}
    [dir="ltr"] .section-title{display:flex; align-items:center; gap:.6rem; justify-content:flex-start}

    /* Dark Mode Styles */
    body.dark-mode {
      background-color: #121212;
      color: #e0e0e0;
    }
    body.dark-mode .card,
    body.dark-mode .modal-content,
    body.dark-mode .list-group-item {
      background-color: #1e1e1e;
      color: #e0e0e0;
      border-color: #333;
    }
    body.dark-mode .list-group-item-action:hover {
      background-color: #282828;
    }
    body.dark-mode .list-group-item.active {
      background-color: var(--primary);
      border-color: var(--primary);
    }
    body.dark-mode .form-control {
      background-color: #222;
      color: #fff;
      border-color: #444;
    }
    body.dark-mode .form-control:focus {
      background-color: #222;
      color: #fff;
      border-color: var(--primary);
      box-shadow: 0 0 0 0.25rem rgba(0,122,61,.25);
    }
    /* Override Bootstrap's light text classes */
    body.dark-mode .text-dark {
      color: #e0e0e0 !important;
    }
    body.dark-mode .text-muted {
      color: #888 !important;
    }
    body.dark-mode .btn-light {
      background-color: #333;
      color: #fff;
      border-color: #444;
    }
    body.dark-mode .modal-header,
    body.dark-mode .modal-footer {
      border-color: #333;
    }
    body.dark-mode .btn-close {
      filter: invert(1);
    }

    /* Donation Button */
    #donationButton {
      position: fixed;
      bottom: 20px;
      right: 20px; /* Adjusted for RTL/LTR in script */
      z-index: 1050;
      font-weight: bold;
      box-shadow: 0 4px 12px rgba(0,0,0,0.2);
    }
    
    #adminLogoPreview, #navbarLogo {
      height: 40px;
      width: auto;
      max-width: 150px;
      object-fit: contain;
      border-radius: 6px;
      background-color: rgba(255,255,255,0.1);
    }
    #navbarLogoContainer .fallback-logo {
        width:46px; 
        height:46px; 
        background:var(--secondary); 
        border-radius:8px; 
        display:grid; 
        place-items:center; 
        margin-inline-start:.6rem
    }
    
    /* Ensure brand title font switches properly */
    [dir="ltr"] #brandTitle { font-family: 'Poppins', sans-serif; }
    [dir="rtl"] #brandTitle { font-family: 'Jameel Noori Nastaleeq', 'Noto Nastaliq Urdu', serif; }

    /* Library card dark mode fix */
    body.dark-mode #library .card { 
      background-color: #222; 
      border-color: #444; 
    }
    
    /* Contact info LTR fix */
    #contactInfo span[dir="ltr"] {
        display: inline-block;
    }

  </style>
</head>
<body>

  <!-- Navbar -->
  <nav class="navbar navbar-expand-lg">
    <div class="container">
      <a class="navbar-brand d-flex align-items-center" href="#">
        <!-- Logo container -->
        <div id="navbarLogoContainer" class="d-flex align-items-center">
          <div class="fallback-logo">
            <span style="font-weight:700; color:var(--primary)">د</span>
          </div>
        </div>
        <div class="ms-2">
          <!-- Added IDs for i18n -->
          <div id="brandTitle" style="font-size:18px; line-height:1">دارالتعلیم والتربیہ</div>
          <small id="brandSubtitle" style="opacity:.9; font-size:12px">Darut Taleem Wat Tarbiyah</small>
        </div>
      </a>

      <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navLinks">
        <span class="navbar-toggler-icon" style="filter:invert(1)"></span>
      </button>

      <div class="collapse navbar-collapse" id="navLinks">
        <ul class="navbar-nav ms-auto mb-2 mb-lg-0">
          <!-- Added IDs for i18n -->
          <li class="nav-item"><a class="nav-link" href="#home" data-link id="navHome">صفحہ اول</a></li>
          <li class="nav-item"><a class="nav-link" href="#about" data-link id="navAbout">ہمارے بارے میں</a></li>
          <li class="nav-item"><a class="nav-link" href="#courses" data-link id="navCourses">کورسز</a></li>
          <li class="nav-item"><a class="nav-link" href="#gallery" data-link id="navGallery">گیلری</a></li>
          <li class="nav-item"><a class="nav-link" href="#library" data-link id="navLibrary">کتب خانہ</a></li>
          <li class="nav-item"><a class="nav-link" href="#contact" data-link id="navContact">رابطہ کریں</a></li>
          <li class="nav-item"><a class="nav-link btn btn-sm btn-light text-dark ms-2" href="#admin" id="openAdmin">ایڈمن</a></li>
          <li class="nav-item d-flex align-items-center ms-2">
            <select id="langToggle" class="form-select form-select-sm" style="width:auto">
              <option value="ur" selected>اردو</option>
              <option value="en">English</option>
            </select>
          </li>
          <li class="nav-item d-flex align-items-center ms-2">
            <button id="darkModeToggle" class="btn btn-sm btn-outline-light" style="padding: 0.25rem 0.5rem; line-height: 1;">
              <!-- Moon icon -->
              <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" fill="currentColor" class="bi bi-moon-fill" viewBox="0 0 16 16">
                <path d="M6 .278a.768.768 0 0 1 .08.858 7.208 7.208 0 0 0-.878 3.46c0 4.021 3.27 7.291 7.291 7.291.526 0 1.034-.063 1.518-.178.539-.111.558.611.082.858A.768.768 0 0 1 12.5 12.27a7.21 7.21 0 0 1-6.222-6.222.768.768 0 0 1 .278-.858z"/>
              </svg>
              <!-- Sun icon -->
              <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" fill="currentColor" class="bi bi-sun-fill" viewBox="0 0 16 16" style="display:none;">
                <path d="M8 12a4 4 0 1 0 0-8 4 4 0 0 0 0 8M8 0a.5.5 0 0 1 .5.5v2a.5.5 0 0 1-1 0v-2A.5.5 0 0 1 8 0m0 13a.5.5 0 0 1 .5.5v2a.5.5 0 0 1-1 0v-2A.5.5 0 0 1 8 13m-5-4a.5.5 0 0 1 .5-.5h2a.5.5 0 0 1 0 1h-2a.5.5 0 0 1-.5-.5M13 8a.5.5 0 0 1 .5-.5h2a.5.5 0 0 1 0 1h-2a.5.5 0 0 1-.5-.5m-2.121 4.879a.5.5 0 0 1-.707 0l-1.414-1.414a.5.5 0 0 1 .707-.707l1.414 1.414a.5.5 0 0 1 0 .707M4.879 4.879a.5.5 0 0 1-.707 0L2.757 3.464a.5.5 0 1 1 .707-.707l1.414 1.414a.5.5 0 0 1 0 .707m6.242 6.242a.5.5 0 0 1-.707 0l-1.414-1.414a.5.5 0 0 1 .707-.707l1.414 1.414a.5.5 0 0 1 0 .707M4.879 11.121a.5.5 0 0 1-.707 0L2.757 9.707a.5.5 0 0 1 .707-.707l1.414 1.414a.5.5 0 0 1 0 .707"/>
              </svg>
            </button>
          </li>
        </ul>
      </div>
    </div>
  </nav>

  <!-- Announcement bar -->
  <div id="announcementBar" class="announcement-bar" role="region" aria-live="polite">
    <div class="announcement-text" id="announcementContent"></div>
  </div>

  <!-- Hero -->
  <header id="home" class="hero text-center">
    <div class="container">
      <h1 id="heroTitle" class="display-5 fw-bold">دارالتعلیم والتربیہ میں خوش آمدید</h1>
      <p id="heroSubtitle" class="lead">تعلیم، تربیہ اور دین کی روشنی میں بہترین ماحول</p>
      <div class="mt-4">
        <a href="#courses" class="btn btn-outline-light btn-lg me-2">مزید جانیں</a>
        <a href="#contact" class="btn btn-light btn-lg text-dark">رابطہ کریں</a>
      </div>
    </div>
  </header>

  <main class="py-5">
    <div class="container">

      <!-- About -->
      <section id="about" class="mb-5">
        <div class="section-title mb-3">
          <h2 style="margin:0" id="aboutHeading">ہمارے بارے میں</h2>
        </div>
        <div class="row">
          <div class="col-lg-6">
            <p id="aboutText">دارالتعلیم والتربیہ ایک معروف مدرسہ ہے جہاں جدید اور دینی تعلیم کو یکجا کیا جاتا ہے۔ ہمارا مقصد طلباء کو علمی اور اخلاقی طور پر مضبوط بنانا ہے۔</p>
          </div>
          <div class="col-lg-6">
            <img src="https://images.unsplash.com/photo-1542736667-069246bdbc6d?q=80&w=1600&auto=format&fit=crop&ixlib=rb-4.0.3&s=" alt="Madrasa" class="img-fluid rounded">
          </div>
        </div>
      </section>

      <!-- Courses -->
      <section id="courses" class="mb-5">
        <div class="section-title mb-3">
          <h2 id="coursesHeading">کورسز</h2>
        </div>
        <div id="coursesList" class="row gy-3">
          <!-- Course cards injected here -->
        </div>
      </section>

      <!-- Gallery -->
      <section id="gallery" class="mb-5">
        <div class="section-title mb-3">
          <h2 id="galleryHeading">گیلری</h2>
        </div>
        <div id="galleryGrid" class="gallery-grid">
          <!-- images injected here -->
        </div>
      </section>

      <!-- Library Section - Updated to be a link card -->
      <section id="library" class="mb-5">
        <div class="section-title mb-3">
          <h2 id="libraryHeading">کتب خانہ</h2>
        </div>
        <div class="card text-center p-4" style="border: 1px solid #ccc; background-color: #f8f9fa;">
          <div class="card-body">
            <h5 class="card-title" id="libraryCardTitle">Darul Uloom Deoband - Online Books</h5>
            <p class="card-text" id="libraryCardText">The requested library cannot be embedded directly on this page due to security restrictions. You can access the full library by clicking the button below.</p>
            <a href="http://darululoom-deoband.com/books/" id="libraryCardButton" class="btn btn-primary" target="_blank" rel="noopener noreferrer">Visit Library</a>
          </div>
        </div>
      </section>

      <!-- Contact -->
      <section id="contact" class="mb-5">
        <div class="section-title mb-3">
          <h2 id="contactHeading">رابطہ کریں</h2>
        </div>
        <div class="row">
          <div class="col-lg-6">
            <form id="contactForm">
              <div class="mb-3">
                <label class="form-label" id="lblName">نام</label>
                <input type="text" class="form-control" id="contactName" required>
              </div>
              <div class="mb-3">
                <label class="form-label" id="lblEmail">ای میل</label>
                <input type="email" class="form-control" id="contactEmail" required>
              </div>
              <div class="mb-3">
                <label class="form-label" id="lblSubject">موضوع</label>
                <input type="text" class="form-control" id="contactSubject">
              </div>
              <div class="mb-3">
                <label class="form-label" id="lblMessage">پیغام</label>
                <textarea class="form-control" id="contactMessage" rows="4" required></textarea>
              </div>
              <button class="btn btn-success" type="submit" id="contactSubmit">ارسال</button>
            </form>
            <!-- Note about email functionality -->
            <small class="d-block mt-3 text-muted" id="contactFormNote">Note: This is a demo. Messages are saved to the Admin Panel (localStorage) and are not sent via email.</small>
          </div>
          <!-- Updated Contact Info with LTR fixes -->
          <div class="col-lg-6">
            <h5 id="contactInfoHeading">رابطہ کی معلومات</h5>
            <p id="contactInfo" style="line-height: 1.8;">
              <strong id="lblAddress">پتہ:</strong> <span dir="ltr">H.no: 9, 4-134/5/A/1/1, Raghava Colony, Nadeem Colony, Vali Colony, Toli Chowki, Hyderabad, Telangana 500008</span><br>
              <strong id="lblPhone">فون:</strong> <span dir="ltr"><a href="tel:0905843885" class="text-dark" style="text-decoration:none;">090584 3885</a></span><br>
              <strong id="lblContactEmail">ای میل:</strong> <span dir="ltr">info@madrasah.example</span><br>
              <strong id="lblMap">نقشہ:</strong> <a id="linkMap" href="https://maps.app.goo.gl/X85qiTVBdRNCRn8X7" target="_blank" rel="noopener noreferrer">گوگل میپس پر دیکھیں</a>
            </p>
          </div>
        </div>
      </section>

    </div>
  </main>

  <!-- Footer -->
  <footer class="footer text-center text-white">
    <div class="container">
      <div class="row">
        <div class="col-md-6 text-md-end">
          <p style="margin:0">© <span id="year"></span> دارالتعلیم والتربیہ</p>
        </div>
        <div class="col-md-6 text-md-start">
          <small>Follow us: <a href="#" class="text-white">Facebook</a> | <a href="#" class="text-white">Instagram</a></small>
        </div>
      </div>
    </div>
  </footer>

  <!-- Admin Modal / Panel (single-page simulated) -->
  <div class="modal fade" id="adminModal" tabindex="-1">
    <div class="modal-dialog modal-xl modal-dialog-scrollable">
      <div class="modal-content">
        <div class="modal-header">
          <h5 class="modal-title">ایڈمن پینل</h5>
          <button type="button" class="btn-close" data-bs-dismiss="modal"></button>
        </div>
        <div class="modal-body">

          <!-- Login view -->
          <div id="adminLoginView">
            <form id="adminLoginForm">
              <div class="mb-3">
                <label>یوزرنیم</label>
                <input class="form-control" id="adminUser" value="admin">
              </div>
              <div class="mb-3">
                <label>پاسورڈ</label>
                <input class="form-control" id="adminPass" type="password" value="password">
              </div>
              <button class="btn btn-primary">Login</button>
            </form>
          </div>

          <!-- Panel view -->
          <div id="adminPanelView" style="display:none">
            <div class="row admin-panel">
              <div class="col-lg-4">
                <div class="list-group mb-3">
                  <button class="list-group-item list-group-item-action active" data-panel="ann">Announcements</button>
                  <button class="list-group-item list-group-item-action" data-panel="courses">Courses</button>
                  <button class="list-group-item list-group-item-action" data-panel="gallery">Gallery</button>
                  <button class="list-group-item list-group-item-action" data-panel="logo">Logo</button>
                  <button class="list-group-item list-group-item-action" data-panel="messages">Messages</button>
                </div>

                <div>
                  <button id="adminLogout" class="btn btn-outline-danger btn-sm">Logout</button>
                </div>
              </div>

              <div class="col-lg-8">
                <div id="panelContent">
                  <!-- dynamic admin content injected here -->
                </div>
              </div>
            </div>
          </div>

        </div>
        <div class="modal-footer">
          <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">بند کریں</button>
        </div>
      </div>
    </div>
  </div>

  <!-- Donation Button -->
  <button id="donationButton" class="btn btn-warning" data-bs-toggle="modal" data-bs-target="#donationModal">
    <!-- SVG icon -->
    <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" fill="currentColor" class="bi bi-gift-fill" viewBox="0 0 16 16">
      <path d="M3 2.5a2.5 2.5 0 0 1 5 0 2.5 2.5 0 0 1 5 0v1.006c.54.503.885 1.254.964 2.112.098 1.068-.213 2.222-.837 2.846-.696.696-1.54 1.134-2.535 1.254h-1.02a4.01 4.01 0 0 1-3.13 1.134 4.01 4.01 0 0 1-3.13-1.134H4.83c-.996-.12-1.84-.558-2.535-1.254C1.67 8.842 1.36 7.688 1.458 6.62c.079-.858.425-1.61.964-2.112V2.5zm6-1.5a1.5 1.5 0 0 0-3 0V.5a.5.5 0 0 1 1 0v.5a.5.5 0 0 0 1 0V.5a.5.5 0 0 1 1 0v.5a.5.5 0 0 0 1 0V.5a.5.5 0 0 1 1 0v.5a1.5 1.5 0 0 0-3 0V1z"/>
      <path d="M1 6.62c0 .495.04.98.118 1.443.078.463.18 1.008.36 1.503.182.495.455.99.805 1.443.35.453.784.85 1.28 1.11.498.26.98.347 1.34.37.04.002.078.003.116.003s.076-.001.116-.003c.36-.023.842-.11 1.34-.37.496-.26.93-.657 1.28-1.11.35.453.623-.948.805-1.443.18-.495.282-1.04.36-1.503C14.96 7.6 15 7.115 15 6.62v-1.42c0-.495-.04-.98-.118-1.443-.078-.463-.18-1.008-.36-1.503C14.34 1.76 14.068 1.266 13.718.813c-.35-.453-.784-.85-1.28-1.11C11.94.26 11.458.173 11.098.15c-.04-.002-.078-.003-.116-.003s-.076.001-.116.003c-.36.023-.842.11-1.34.37-.496.26-.93.657-1.28 1.11-.35.453-.623.948-.805 1.443C1.68 4.257 1.578 4.802 1.5 5.266 1.04 6.24 1 6.125 1 6.62v1.42z"/>
    </svg>
    <span id="donationBtnText" class="ms-2">Donation</span>
  </button>

  <!-- Donation Modal -->
  <div class="modal fade" id="donationModal" tabindex="-1">
    <div class="modal-dialog modal-dialog-centered">
      <div class="modal-content">
        <div class="modal-header">
          <h5 class="modal-title" id="donationModalTitle">Donation</h5>
          <button type="button" class="btn-close" data-bs-dismiss="modal"></button>
        </div>
        <div class="modal-body text-center">
          <p id="donationModalSubtitle">Please support us by donating via UPI.</p>
          <img id="donationQR" src="" alt="UPI QR Code" class="img-fluid rounded mb-3" style="max-width: 200px;">
          <div class="input-group mb-3">
            <input type="text" id="upiIdInput" class="form-control" value="9058438854-2@okbizaxis" readonly>
            <button class="btn btn-outline-secondary" type="button" id="copyUpiButton">
              <span id="copyUpiBtnText">Copy</span>
            </button>
          </div>
          <a id="payNowLink" href="#" class="btn btn-primary" target="_blank">
            <span id="payNowBtnText">Pay Now</span>
          </a>
        </div>
      </div>
    </div>
  </div>


  <!-- Custom Toast Notification -->
  <div id="customToast" class="position-fixed bottom-0 end-0 p-3" style="z-index: 1100">
    <div class="toast align-items-center text-white bg-success border-0" role="alert" aria-live="assertive" aria-atomic="true">
      <div class="d-flex">
        <div id="toastBody" class="toast-body">
          Message sent successfully.
        </div>
        <button type="button" class="btn-close btn-close-white me-2 m-auto" data-bs-dismiss="toast" aria-label="Close"></button>
      </div>
    </div>
  </div>


  <!-- Bootstrap + Dependencies -->
  <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/js/bootstrap.bundle.min.js"></script>

  <script>
    // ----------------- i18n content -----------------
    const i18n = {
      ur: {
        brandTitle: 'دارالتعلیم والتربیہ',
        brandSubtitle: 'Darut Taleem Wat Tarbiyah',
        navHome: 'صفحہ اول',
        navAbout: 'ہمارے بارے میں',
        navCourses: 'کورسز',
        navGallery: 'گیلری',
        navLibrary: 'کتب خانہ',
        navContact: 'رابطہ کریں',
        navAdmin: 'ایڈمن',
        homeTitle: 'دارالتعلیم والتربیہ میں خوش آمدید',
        homeSubtitle: 'تعلیم، تربیہ اور دین کی روشنی میں بہترین ماحول',
        aboutHeading: 'ہمارے بارے میں',
        aboutText: 'دارالتعلیم والتربیہ ایک معروف مدرسہ ہے جہاں جدید اور دینی تعلیم کو یکجا کیا جاتا ہے۔ ہمارا مقصد طلباء کو علمی اور اخلاقی طور پر مضبوط بنانا ہے۔',
        coursesHeading: 'کورسز',
        galleryHeading: 'گیلری',
        contactHeading: 'رابطہ کریں',
        lblName: 'نام', lblEmail: 'ای میل', lblSubject: 'موضوع', lblMessage: 'پیغام', contactSubmit: 'ارسال', contactInfoHeading: 'رابطہ کی معلومات',
        lblAddress: 'پتہ:',
        lblPhone: 'فون:',
        lblContactEmail: 'ای میل:',
        lblMap: 'نقشہ:',
        linkMap: 'گوگل میپس پر دیکھیں',
        libraryHeading: 'کتب خانہ',
        libraryCardTitle: 'دارالعلوم دیوبند - آن لائن کتب',
        libraryCardText: 'درخواست کردہ کتب خانہ کو سیکورٹی پابندیوں کی وجہ سے براہ راست اس صفحہ پر نہیں دکھایا جا سکتا۔ آپ نیچے دیے گئے بٹن پر کلک کر کے مکمل کتب خانہ تک رسائی حاصل کر سکتے ہیں۔',
        libraryCardButton: 'کتب خانہ پر جائیں',
        contactFormNote: 'نوٹ: یہ ایک ڈیمو ہے۔ پیغامات کو ایڈمن پینل (لوکل اسٹوریج) میں محفوظ کیا جاتا ہے اور ای میل کے ذریعے نہیں بھیجا جاتا۔',
        donationBtnText: 'عطیہ',
        donationModalTitle: 'عطیہ',
        donationModalSubtitle: 'برائے مہربانی UPI کے ذریعے عطیہ دے کر ہماری مدد کریں۔',
        copyUpiBtnText: 'کاپی',
        payNowBtnText: 'ابھی ادا کریں۔',
        copiedToast: 'UPI ID کاپی ہو گیا!',
        adminLogo: 'لوگو'
      },
      en: {
        brandTitle: 'Darut Taleem Wat Tarbiyah',
        brandSubtitle: 'Knowledge and Upbringing',
        navHome: 'Home',
        navAbout: 'About Us',
        navCourses: 'Courses',
        navGallery: 'Gallery',
        navLibrary: 'Library',
        navContact: 'Contact Us',
        navAdmin: 'Admin',
        homeTitle: 'Welcome to Darut Taleem Wat Tarbiyah',
        homeSubtitle: 'A nurturing place for knowledge & character',
        aboutHeading: 'About Us',
        aboutText: 'Darut Taleem Wat Tarbiyah is a madrasa combining modern and religious education. Our aim is to build students academically and morally.',
        coursesHeading: 'Courses',
        galleryHeading: 'Gallery',
        contactHeading: 'Contact Us',
        lblName: 'Name', lblEmail: 'Email', lblSubject: 'Subject', lblMessage: 'Message', contactSubmit: 'Send', contactInfoHeading: 'Contact Information',
        lblAddress: 'Address:',
        lblPhone: 'Phone:',
        lblContactEmail: 'Email:',
        lblMap: 'Map:',
        linkMap: 'View on Google Maps',
        libraryHeading: 'Library',
        libraryCardTitle: 'Darul Uloom Deoband - Online Books',
        libraryCardText: 'The requested library cannot be embedded directly on this page due to security restrictions. You can access the full library by clicking the button below.',
        libraryCardButton: 'Visit Library',
        contactFormNote: 'Note: This is a demo. Messages are saved to the Admin Panel (localStorage) and are not sent via email.',
        donationBtnText: 'Donation',
        donationModalTitle: 'Donation',
        donationModalSubtitle: 'Please support us by donating via UPI.',
        copyUpiBtnText: 'Copy',
        payNowBtnText: 'Pay Now',
        copiedToast: 'UPI ID Copied!',
        adminLogo: 'Logo'
      }
    };

    // ----------------- Simple data store (localStorage) -----------------
    const store = {
      announcementsKey: 'mad_announcements_v1',
      coursesKey: 'mad_courses_v1',
      galleryKey: 'mad_gallery_v1',
      messagesKey: 'mad_messages_v1',
      logoKey: 'mad_logo_v1',

      getAnnouncements(){ return JSON.parse(localStorage.getItem(this.announcementsKey) || '[]') },
      saveAnnouncements(a){ localStorage.setItem(this.announcementsKey, JSON.stringify(a)) },
      getCourses(){ return JSON.parse(localStorage.getItem(this.coursesKey) || '[]') },
      saveCourses(a){ localStorage.setItem(this.coursesKey, JSON.stringify(a)) },
      getGallery(){ return JSON.parse(localStorage.getItem(this.galleryKey) || '[]') },
      saveGallery(a){ localStorage.setItem(this.galleryKey, JSON.stringify(a)) },
      getMessages(){ return JSON.parse(localStorage.getItem(this.messagesKey) || '[]') },
      saveMessages(a){ localStorage.setItem(this.messagesKey, JSON.stringify(a)) },
      getLogo(){ return localStorage.getItem(this.logoKey) || null },
      saveLogo(data){ localStorage.setItem(this.logoKey, data) },
      removeLogo(){ localStorage.removeItem(this.logoKey) }
    }

    // Seed initial data if empty
    if(store.getAnnouncements().length === 0){
      store.saveAnnouncements([
        {id:Date.now(), text: 'نئے داخلے جاری ہیں — مزید معلومات کے لئے رابطہ کریں'}
      ])
    }
    if(store.getCourses().length === 0){
      store.saveCourses([
        {id:1, titleUr:'حفظِ قرآن', titleEn:'Hifz of Quran', descUr:'حفظ کے خصوصی کورس کی تفصیل', descEn:'Memorization course for Quran', duration:'2 years'},
        {id:2, titleUr:'عربی زبان', titleEn:'Arabic Language', descUr:'ابتدائی تا اعلی کورس', descEn:'Beginner to advanced Arabic', duration:'1 year'}
      ])
    }

    // ----------------- DOM helpers -----------------
    const setYear = ()=> document.getElementById('year').textContent = new Date().getFullYear()
    setYear()

    // ----------------- Toast Notification Helper -----------------
    const customToastEl = document.getElementById('customToast')
    const customToast = new bootstrap.Toast(customToastEl.querySelector('.toast'))
    const toastBody = document.getElementById('toastBody')
    const toastEl = customToastEl.querySelector('.toast')

    function showToast(message, type = 'success') {
        toastBody.textContent = message
        
        // Remove old classes, add new
        toastEl.classList.remove('bg-success', 'bg-danger')
        if (type === 'danger') {
            toastEl.classList.add('bg-danger')
        } else {
            toastEl.classList.add('bg-success')
        }
        
        customToast.show()
    }

    // Render announcements in bar
    function renderAnnouncements(){
      const anns = store.getAnnouncements()
      const bar = document.getElementById('announcementContent')
      if(anns.length === 0){ bar.textContent = '' ; return }
      // Repeat the content for a seamless loop
      const text = anns.map(a=>a.text).join('  •  ')
      bar.textContent = text + '  •  ' + text + '  •  ' + text; // Repeat for longer scroll
    }
    renderAnnouncements()

    // Render Logo
    function renderLogo() {
      const logoData = store.getLogo();
      const logoContainer = document.getElementById('navbarLogoContainer');
      if (logoData) {
        logoContainer.innerHTML = `<img src="${logoData}" alt="Logo" id="navbarLogo" style="margin-inline-start:.6rem">`;
      } else {
        logoContainer.innerHTML = `
          <div class="fallback-logo">
            <span style="font-weight:700; color:var(--primary)">د</span>
          </div>`;
      }
    }
    renderLogo();


    // Render courses
    function renderCourses(){
      const container = document.getElementById('coursesList')
      container.innerHTML = ''
      const courses = store.getCourses()
      courses.forEach(c => {
        const col = document.createElement('div'); col.className = 'col-md-6 col-lg-4'
        col.innerHTML = `
          <div class="card card-course h-100">
            <div class="card-body">
              <h5 class="card-title">${c.titleUr || c.titleEn}</h5>
              <p class="card-text">${c.descUr || c.descEn}</p>
            </div>
            <div class="card-footer small text-muted">${c.duration || ''}</div>
          </div>
        `
        container.appendChild(col)
      })
    }
    renderCourses()

    // Render gallery
    function renderGallery(){
      const grid = document.getElementById('galleryGrid')
      grid.innerHTML = ''
      store.getGallery().forEach(img => {
        const imgEl = document.createElement('img')
        imgEl.src = img.data
        imgEl.alt = img.name || 'Gallery'
        grid.appendChild(imgEl)
      })
    }
    renderGallery()

    // Contact form submission
    document.getElementById('contactForm').addEventListener('submit', function(e){
      e.preventDefault()
      const msg = {
        id: Date.now(),
        name: document.getElementById('contactName').value.trim(),
        email: document.getElementById('contactEmail').value.trim(),
        subject: document.getElementById('contactSubject').value.trim(),
        message: document.getElementById('contactMessage').value.trim(),
        created: new Date().toISOString()
      }
      const msgs = store.getMessages(); msgs.unshift(msg); store.saveMessages(msgs)
      this.reset(); 
      showToast('پیغام موصول ہوگیا — ہم جلد رابطہ کریں گے', 'success')
    })

    // ----------------- Admin interactions -----------------
    const adminModal = new bootstrap.Modal(document.getElementById('adminModal'))
    document.getElementById('openAdmin').addEventListener('click',()=>{ adminModal.show() })

    document.getElementById('adminLoginForm').addEventListener('submit', function(e){
      e.preventDefault()
      const user = document.getElementById('adminUser').value
      const pass = document.getElementById('adminPass').value
      // NOTE: In production authenticate on server side!
      if(user === 'admin' && pass === 'password'){
        document.getElementById('adminLoginView').style.display = 'none'
        document.getElementById('adminPanelView').style.display = 'block'
        loadAdminPanel('ann')
      } else {
        showToast('Invalid credentials (demo: admin / password)', 'danger')
      }
    })

    document.getElementById('adminLogout').addEventListener('click', ()=>{
      document.getElementById('adminLoginView').style.display = 'block'
      document.getElementById('adminPanelView').style.display = 'none'
      // keep modal open
    })

    // Panel nav buttons
    document.querySelectorAll('[data-panel]').forEach(btn=> btn.addEventListener('click', ()=> loadAdminPanel(btn.dataset.panel) ))

    function loadAdminPanel(panel){
      const content = document.getElementById('panelContent')
      
      // Update active button state
      document.querySelectorAll('[data-panel]').forEach(b => {
        b.classList.toggle('active', b.dataset.panel === panel)
      })

      if(panel === 'ann'){
        const anns = store.getAnnouncements()
        content.innerHTML = `
          <h5>Announcements</h5>
          <form id="annForm" class="mb-3">
            <div class="mb-2"><textarea id="annText" class="form-control" rows="2" placeholder="Add announcement in Urdu or English"></textarea></div>
            <button class="btn btn-success btn-sm">Add</button>
          </form>
          <div id="annsList"></div>
        `
        document.getElementById('annForm').addEventListener('submit', function(e){
          e.preventDefault(); const text = document.getElementById('annText').value.trim(); if(!text) return;
          const arr = store.getAnnouncements(); arr.unshift({id:Date.now(), text}); store.saveAnnouncements(arr); renderAnnouncements(); loadAdminPanel('ann')
        })
        const listDiv = document.getElementById('annsList')
        listDiv.innerHTML = ''
        anns.forEach(a=>{
          const el = document.createElement('div'); el.className='card mb-2 p-2'; el.innerHTML = `
            <div class="d-flex justify-content-between align-items-center">
              <div>${a.text}</div>
              <div><button class="btn btn-sm btn-danger" data-id="${a.id}">Delete</button></div>
            </div>
          `
          listDiv.appendChild(el)
          el.querySelector('button').addEventListener('click', ()=>{
            const arr = store.getAnnouncements().filter(x=> x.id !== a.id); store.saveAnnouncements(arr); renderAnnouncements(); loadAdminPanel('ann')
          })
        })
      }

      if(panel === 'courses'){
        const courses = store.getCourses()
        content.innerHTML = `
          <h5>Courses</h5>
          <form id="courseForm" class="mb-3">
            <div class="row g-2">
              <div class="col-md-6"><input id="courseTitleUr" class="form-control" placeholder="Title (Urdu)"></div>
              <div class="col-md-6"><input id="courseTitleEn" class="form-control" placeholder="Title (English)"></div>
            </div>
            <div class="row g-2 mt-2">
              <div class="col-md-6"><input id="courseDuration" class="form-control" placeholder="Duration"></div>
              <div class="col-md-6"><input id="courseDescEn" class="form-control" placeholder="Short description (English)"></div>
            </div>
            <div class="mt-2"><textarea id="courseDescUr" class="form-control" placeholder="Short description (Urdu)"></textarea></div>
            <div class="mt-2"><button class="btn btn-success btn-sm">Add Course</button></div>
          </form>
          <div id="coursesListAdmin"></div>
        `
        document.getElementById('courseForm').addEventListener('submit', function(e){
          e.preventDefault();
          const obj = {
            id: Date.now(),
            titleUr: document.getElementById('courseTitleUr').value || '',
            titleEn: document.getElementById('courseTitleEn').value || '',
            descUr: document.getElementById('courseDescUr').value || '',
            descEn: document.getElementById('courseDescEn').value || '',
            duration: document.getElementById('courseDuration').value || ''
          }
          const arr = store.getCourses(); arr.unshift(obj); store.saveCourses(arr); renderCourses(); loadAdminPanel('courses')
        })
        const out = document.getElementById('coursesListAdmin'); out.innerHTML = ''
        courses.forEach(c=>{
          const el = document.createElement('div'); el.className='card mb-2 p-2';
          el.innerHTML = `<div class="d-flex justify-content-between align-items-start"><div><strong>${c.titleUr||c.titleEn}</strong><div class="small text-muted">${c.duration||''}</div></div><div><button class="btn btn-sm btn-danger" data-id="${c.id}">Delete</button></div></div>`
          out.appendChild(el);
          el.querySelector('button').addEventListener('click', ()=>{ const arr = store.getCourses().filter(x=> x.id !== c.id); store.saveCourses(arr); renderCourses(); loadAdminPanel('courses') })
        })
      }

      if(panel === 'gallery'){
        const gallery = store.getGallery()
        content.innerHTML = `
          <h5>Gallery</h5>
          <form id="galleryForm" class="mb-3">
            <div class="mb-2"><input id="galleryFile" type="file" accept="image/*" class="form-control"></div>
            <div class="mb-2"><input id="galleryName" class="form-control" placeholder="Image name (optional)"></div>
            <button class="btn btn-success btn-sm">Upload</button>
          </form>
          <div id="galleryAdminList" class="d-flex flex-wrap gap-2"></div>
        `
        document.getElementById('galleryForm').addEventListener('submit', function(e){
          e.preventDefault(); const f = document.getElementById('galleryFile').files[0]; 
          if(!f){ 
            showToast('Please choose an image', 'danger'); 
            return 
          }
          const reader = new FileReader(); reader.onload = function(ev){
            const arr = store.getGallery(); arr.unshift({id:Date.now(), name:document.getElementById('galleryName').value || f.name, data: ev.target.result}); store.saveGallery(arr); renderGallery(); loadAdminPanel('gallery')
          }
          reader.readAsDataURL(f)
        })
        const out = document.getElementById('galleryAdminList'); out.innerHTML = ''
        gallery.forEach(g=>{
          const el = document.createElement('div'); el.style.width='120px'; el.innerHTML = `<div style="width:120px"><img src="${g.data}" style="width:100%; height:80px; object-fit:cover; border-radius:6px"><div class="mt-1 d-flex justify-content-between"><small>${g.name}</small><button class="btn btn-sm btn-danger" data-id="${g.id}">Del</button></div></div>`
          out.appendChild(el)
          el.querySelector('button').addEventListener('click', ()=>{ const arr = store.getGallery().filter(x=> x.id !== g.id); store.saveGallery(arr); renderGallery(); loadAdminPanel('gallery') })
        })
      }

      if(panel === 'logo'){
        const logo = store.getLogo();
        content.innerHTML = `
          <h5 id="adminLogoTitle">Logo</h5>
          <p>Upload a logo to replace the default initial in the navbar.</p>
          <div class="mb-3">
            <label class="form-label">Current Logo</label>
            <div>
              ${logo ? `<img src="${logo}" id="adminLogoPreview" alt="Logo">` : '<span class="text-muted">No logo uploaded</span>'}
            </div>
          </div>
          <form id="logoForm" class="mb-3">
            <div class="mb-2"><input id="logoFile" type="file" accept="image/png, image/jpeg, image/svg+xml, image/webp" class="form-control"></div>
            <button class="btn btn-success btn-sm">Save Logo</button>
          </form>
          <button class="btn btn-outline-danger btn-sm" id="removeLogoButton" ${!logo ? 'disabled' : ''}>Remove Logo</button>
        `

        document.getElementById('logoForm').addEventListener('submit', function(e){
          e.preventDefault();
          const f = document.getElementById('logoFile').files[0];
          if(!f) {
            showToast('Please select a file', 'danger');
            return;
          }
          const reader = new FileReader();
          reader.onload = function(ev) {
            store.saveLogo(ev.target.result);
            renderLogo();
            loadAdminPanel('logo');
            showToast('Logo updated!', 'success');
          }
          reader.readAsDataURL(f);
        });

        document.getElementById('removeLogoButton').addEventListener('click', function(){
          store.removeLogo();
          renderLogo();
          loadAdminPanel('logo');
          showToast('Logo removed', 'success');
        });
      }

      if(panel === 'messages'){
        const msgs = store.getMessages()
        content.innerHTML = `
          <h5>Messages</h5>
          <div id="msgsList"></div>
        `
        const out = document.getElementById('msgsList')
        out.innerHTML = ''
        if (msgs.length === 0) {
          out.innerHTML = '<p class="text-muted">No messages yet.</p>';
          return;
        }
        msgs.forEach(m=>{
          const el = document.createElement('div'); el.className='card mb-2 p-2'; el.innerHTML = `<div><strong>${m.name} — ${m.email}</strong><div class="small text-muted">${new Date(m.created).toLocaleString()}</div><p>${m.message}</p></div>`
          out.appendChild(el)
        })
      }
    }

    // ----------------- Language switching -----------------
    const langSelect = document.getElementById('langToggle')
    const donationButton = document.getElementById('donationButton');
    
    function applyLanguage(lang){
      const root = document.documentElement
      if(lang === 'ur'){
        root.lang = 'ur'; root.dir = 'rtl'
        donationButton.style.right = '20px';
        donationButton.style.left = 'auto';
      } else { 
        root.lang = 'en'; root.dir = 'ltr' 
        donationButton.style.right = 'auto';
        donationButton.style.left = '20px';
      }

      // apply texts
      const t = i18n[lang]
      
      // Navbar
      document.getElementById('brandTitle').textContent = t.brandTitle
      document.getElementById('brandSubtitle').textContent = t.brandSubtitle
      document.getElementById('navHome').textContent = t.navHome
      document.getElementById('navAbout').textContent = t.navAbout
      document.getElementById('navCourses').textContent = t.navCourses
      document.getElementById('navGallery').textContent = t.navGallery
      document.getElementById('navLibrary').textContent = t.navLibrary
      document.getElementById('navContact').textContent = t.navContact
      document.getElementById('openAdmin').textContent = t.navAdmin

      // Page Content
      document.getElementById('heroTitle').textContent = t.homeTitle
      document.getElementById('heroSubtitle').textContent = t.homeSubtitle
      document.getElementById('aboutHeading').textContent = t.aboutHeading
      document.getElementById('aboutText').textContent = t.aboutText
      document.getElementById('coursesHeading').textContent = t.coursesHeading
      document.getElementById('galleryHeading').textContent = t.galleryHeading
      
      // Library Section
      document.getElementById('libraryHeading').textContent = t.libraryHeading
      document.getElementById('libraryCardTitle').textContent = t.libraryCardTitle
      document.getElementById('libraryCardText').textContent = t.libraryCardText
      document.getElementById('libraryCardButton').textContent = t.libraryCardButton

      document.getElementById('contactHeading').textContent = t.contactHeading
      document.getElementById('lblName').textContent = t.lblName
      document.getElementById('lblEmail').textContent = t.lblEmail
      document.getElementById('lblSubject').textContent = t.lblSubject
      document.getElementById('lblMessage').textContent = t.lblMessage
      document.getElementById('contactSubmit').textContent = t.contactSubmit
      document.getElementById('contactInfoHeading').textContent = t.contactInfoHeading
      
      document.getElementById('lblAddress').textContent = t.lblAddress
      document.getElementById('lblPhone').textContent = t.lblPhone
      document.getElementById('lblContactEmail').textContent = t.lblContactEmail
      document.getElementById('lblMap').textContent = t.lblMap
      document.getElementById('linkMap').textContent = t.linkMap
      document.getElementById('contactFormNote').textContent = t.contactFormNote

      // Donation texts
      document.getElementById('donationBtnText').textContent = t.donationBtnText
      document.getElementById('donationModalTitle').textContent = t.donationModalTitle
      document.getElementById('donationModalSubtitle').textContent = t.donationModalSubtitle
      document.getElementById('copyUpiBtnText').textContent = t.copyUpiBtnText
      document.getElementById('payNowBtnText').textContent = t.payNowBtnText

      // Admin panel
      const logoAdminBtn = document.querySelector('[data-panel="logo"]');
      if (logoAdminBtn) logoAdminBtn.textContent = t.adminLogo;
      const logoAdminTitle = document.getElementById('adminLogoTitle');
      if (logoAdminTitle) logoAdminTitle.textContent = t.adminLogo;
    }

    // default language = Urdu
    langSelect.addEventListener('change', ()=> applyLanguage(langSelect.value))
    applyLanguage('ur')

    // Smooth scroll for nav links
    document.querySelectorAll('[data-link]').forEach(a=> a.addEventListener('click', function(e){ e.preventDefault(); const id = this.getAttribute('href').slice(1); document.getElementById(id).scrollIntoView({behavior:'smooth'}) }))

    // ----------------- Dark Mode Toggle -----------------
    const darkModeToggle = document.getElementById('darkModeToggle');
    const sunIcon = darkModeToggle.querySelector('.bi-sun-fill');
    const moonIcon = darkModeToggle.querySelector('.bi-moon-fill');
    const prefersDark = window.matchMedia('(prefers-color-scheme: dark)');
    const currentTheme = localStorage.getItem('theme');

    function setDarkMode(isDark) {
      if (isDark) {
        document.body.classList.add('dark-mode');
        sunIcon.style.display = 'inline-block';
        moonIcon.style.display = 'none';
        localStorage.setItem('theme', 'dark');
      } else {
        document.body.classList.remove('dark-mode');
        sunIcon.style.display = 'none';
        moonIcon.style.display = 'inline-block';
        localStorage.setItem('theme', 'light');
      }
    }

    // Initialize theme
    if (currentTheme === 'dark') {
      setDarkMode(true);
    } else if (currentTheme === 'light') {
      setDarkMode(false);
    } else {
      // No preference saved, use system preference
      setDarkMode(prefersDark.matches);
    }

    // Listen for toggle click
    darkModeToggle.addEventListener('click', () => {
      setDarkMode(!document.body.classList.contains('dark-mode'));
    });

    // Listen for system changes
    prefersDark.addEventListener('change', (e) => {
      // Only apply if no theme is manually set
      if (!localStorage.getItem('theme')) {
        setDarkMode(e.matches);
      }
    });

    // ----------------- Donation Modal Logic -----------------
    const donationModal = new bootstrap.Modal(document.getElementById('donationModal'));
    const upiId = '9058438854-2@okbizaxis';
    const upiLink = `upi://pay?pa=${upiId}&pn=Darut%20Taleem%20Wat%20Tarbiyah&am=&cu=INR&tn=Donation`;
    const qrUrl = `https://api.qrserver.com/v1/create-qr-code/?size=200x200&data=${encodeURIComponent(upiLink)}`;
    
    document.getElementById('donationQR').src = qrUrl;
    document.getElementById('payNowLink').href = upiLink;
    document.getElementById('upiIdInput').value = upiId;

    document.getElementById('copyUpiButton').addEventListener('click', function() {
      const upiInput = document.getElementById('upiIdInput');
      // Use execCommand for broader compatibility in iframes
      try {
        upiInput.select();
        upiInput.setSelectionRange(0, 99999); // For mobile
        document.execCommand('copy');
        
        // Show "Copied!" toast
        const lang = document.getElementById('langToggle').value;
        showToast(i18n[lang].copiedToast, 'success');

      } catch (err) {
        console.error('Failed to copy UPI ID: ', err);
        showToast('Failed to copy', 'danger');
      }
    });

  </script>
</body>
</html>
