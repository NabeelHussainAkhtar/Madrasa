<!doctype html>
<html lang="ur" dir="rtl">
<head>
  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <title>دارالتعلیم والتربیہ - Darut Taleem Wat Tarbiyah</title>

  <!-- UPDATED FAVICON LINKS (with correct folder path) -->
  <link rel="apple-touch-icon" sizes="57x57" href="/favicon.ico/apple-icon-57x57.png">
  <link rel="apple-touch-icon" sizes="60x60" href="/favicon.ico/apple-icon-60x60.png">
  <link rel="apple-touch-icon" sizes="72x72" href="/favicon.ico/apple-icon-72x72.png">
  <link rel="apple-touch-icon" sizes="76x76" href="/favicon.ico/apple-icon-76x76.png">
  <link rel="apple-touch-icon" sizes="114x114" href="/favicon.ico/apple-icon-114x114.png">
  <link rel="apple-touch-icon" sizes="120x120" href="/favicon.ico/apple-icon-120x120.png">
  <link rel="apple-touch-icon" sizes="144x144" href="/favicon.ico/apple-icon-144x144.png">
  <link rel="apple-touch-icon" sizes="152x152" href="/favicon.ico/apple-icon-152x152.png">
  <link rel="apple-touch-icon" sizes="180x180" href="/favicon.ico/apple-icon-180x180.png">
  <link rel="icon" type="image/png" sizes="192x192"  href="/favicon.ico/android-icon-192x192.png">
  <link rel="icon" type="image/png" sizes="32x32" href="/favicon.ico/favicon-32x32.png">
  <link rel="icon" type="image/png" sizes="96x96" href="/favicon.ico/favicon-96x96.png">
  <link rel="icon" type="image/png" sizes="16x16" href="/favicon.ico/favicon-16x16.png">
  <link rel="manifest" href="/favicon.ico/manifest.json">
  <meta name="msapplication-TileColor" content="#007A3D">
  <meta name="msapplication-TileImage" content="/favicon.ico/ms-icon-144x144.png">
  <meta name="theme-color" content="#007A3D">
  <link rel="icon" href="/favicon.ico/favicon.ico">
  <meta name="msapplication-config" content="/favicon.ico/browserconfig.xml">

  <!-- Bootstrap 5 -->
  <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/css/bootstrap.min.css" rel="stylesheet">

  <!-- AOS Animation Library -->
  <link href="https://unpkg.com/aos@2.3.1/dist/aos.css" rel="stylesheet">

  <!-- Google Fonts: Poppins for English, Noto Nastaliq Urdu for fallback -->
  <link rel="preconnect" href="https://fonts.googleapis.com">
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
  <!-- UPDATED FONT LINK -->
  <link href="https://fonts.googleapis.com/css2?family=Almarai:wght@400;700&family=Inter:wght@300;400;600&family=Lato:wght@300;400;700&family=Noto+Naskh+Arabic:wght@400;700&family=Noto+Nastaliq+Urdu:wght@400;700&family=Open+Sans:wght@300;400;600&family=Poppins:wght@300;400;600&family=Roboto:wght@300;400;500&display=swap" rel="stylesheet">


  <style>
    :root{
      --primary:#007A3D; /* green */
      --secondary:#F7C948; /* gold */
      --bg:#ffffff;
      --card-bg: #f8f9fa;
      /* Default fonts */
      --font-ur: 'Noto Nastaliq Urdu', serif;
      --font-en: 'Poppins', sans-serif;
    }
    
    /* Dynamic Font Loading */
    html[dir="rtl"] body{font-family: var(--font-ur), 'Noto Serif', serif;}
    html[dir="ltr"] body{font-family: var(--font-en), system-ui, -apple-system, 'Segoe UI', Roboto, 'Helvetica Neue', Arial;}

    body{background:var(--bg); color:#222; transition: background-color 0.3s, color 0.3s;}
    .navbar{background:linear-gradient(90deg,var(--primary), rgba(0,122,61,.9));}
    .navbar .nav-link, .navbar-brand{color:#fff !important}
    .hero{background: linear-gradient( rgba(0,0,0,0.25), rgba(0,0,0,0.25) ), url('https://images.unsplash.com/photo-1523942839745-7844d3d58c73?q=80&w=1770&auto=format&fit=crop&ixlib=rb-4.0.3&s=') center/cover no-repeat; color:#fff; padding:80px 0}
    
    /* Animation: Hero Button Transitions */
    .hero .btn {
      transition: all 0.3s ease-in-out;
    }

    .accent{color:var(--primary)}
    
    /* Animation: Card Hover Effect */
    .card-course, .event-card, .custom-section-img {
      border:1px solid #eee;
      transition: all 0.3s ease-in-out;
    }
    .card-course:hover, .event-card:hover {
      transform: translateY(-4px);
      box-shadow: 0 4px 15px rgba(0,0,0,0.07);
    }
    
    /* Announcement bar - updated for marquee */
    .announcement-bar {
      background: var(--primary);
      color: #fff;
      padding: .25rem 0;
      font-weight: 600;
      overflow: hidden;
      white-space: nowrap;
    }
    .announcement-text {
      display: inline-block;
      padding-left: 100%; /* Start off-screen */
      animation: marquee 30s linear infinite;
    }
    /* RTL marquee */
    [dir="rtl"] .announcement-text {
      animation-name: marquee-rtl;
      padding-right: 100%;
      padding-left: 0;
    }

    @keyframes marquee {
      0% { transform: translateX(0%); }
      100% { transform: translateX(-100%); }
    }
    @keyframes marquee-rtl {
      0% { transform: translateX(0%); }
      100% { transform: translateX(100%); }
    }
    
    .footer{background:#0b5132; color:#fff; padding:20px 0}

    /* Gallery grid - UPDATED to control max size */
    .gallery-grid{
        display:grid; 
        grid-template-columns: repeat(auto-fit,minmax(300px, 350px)); 
        gap:12px;
        /* Center the grid items if they don't fill the row */
        justify-content: center; 
    }
    .gallery-grid img{
      width:100%;  
      height: auto;
      aspect-ratio: 1 / 1; /* Makes it a perfect square */
      object-fit:cover;  
      border-radius:8px;
      /* Animation: Gallery Hover */
      transition: all 0.3s ease-in-out;
    }
    .gallery-grid img:hover {
      transform: scale(1.05);
      box-shadow: 0 5px 20px rgba(0,0,0,0.1);
    }

    /* Admin panel */
    .admin-panel{min-height:60vh}

    /* Responsive tweaks */
    @media(min-width:992px){ .hero{padding:100px 0} }

    /* RTL friendly card headings - ALIGNMENT FIX */
    [dir="rtl"] .section-title { text-align: right; }
    [dir="ltr"] .section-title { text-align: left; }


    /* Quick Links Grid */
    .quick-link-card {
      background-color: var(--card-bg);
      border: 1px solid #e0e0e0;
      border-radius: 8px;
      padding: 1.5rem 1rem;
      text-align: center;
      transition: all 0.2s ease-in-out;
      text-decoration: none;
      color: #333;
      display: block;
      height: 100%;
    }
    .quick-link-card:hover {
      transform: translateY(-5px);
      box-shadow: 0 4px 12px rgba(0,0,0,0.05);
      color: var(--primary);
    }
    .quick-link-card svg {
      width: 40px;
      height: 40px;
      margin-bottom: 0.75rem;
      color: var(--primary);
      transition: all 0.2s ease-in-out; /* Add transition to SVG */
    }
    .quick-link-card:hover svg {
      transform: scale(1.1); /* Animate SVG on hover */
    }
    .quick-link-card h5 {
      font-weight: 600;
      font-size: 1.1rem;
      margin: 0;
    }
    [dir="rtl"] .quick-link-card h5 {
      font-family: var(--font-ur), 'Noto Serif', serif;
      font-size: 1.4rem;
    }


    /* Dark Mode Styles */
    body.dark-mode {
      --bg: #121212;
      --card-bg: #1e1e1e;
      color: #e0e0e0;
    }
    body.dark-mode .card,
    body.dark-mode .modal-content,
    body.dark-mode .list-group-item {
      background-color: #1e1e1e;
      color: #e0e0e0;
      border-color: #333;
    }
    /* Animation: Dark mode card hover */
    body.dark-mode .card-course:hover, 
    body.dark-mode .event-card:hover {
      box-shadow: 0 4px 15px rgba(255,255,255,0.05);
    }
    body.dark-mode .quick-link-card {
      color: #e0e0e0;
      border-color: #333;
    }
    body.dark-mode .quick-link-card:hover {
      box-shadow: 0 4px 12px rgba(255,255,255,0.05);
    }
    body.dark-mode .list-group-item-action:hover {
      background-color: #282828;
    }
    body.dark-mode .list-group-item.active {
      background-color: var(--primary);
      border-color: var(--primary);
    }
    body.dark-mode .form-control {
      background-color: #222;
      color: #fff;
      border-color: #444;
    }
    body.dark-mode .form-control:focus {
      background-color: #222;
      color: #fff;
      border-color: var(--primary);
      box-shadow: 0 0 0 0.25rem rgba(0,122,61,.25);
    }
    /* Override Bootstrap's light text classes */
    body.dark-mode .text-dark {
      color: #e0e0e0 !important;
    }
    body.dark-mode .text-muted {
      color: #888 !important;
    }
    body.dark-mode .btn-light {
      background-color: #333;
      color: #fff;
      border-color: #444;
    }
    body.dark-mode .modal-header,
    body.dark-mode .modal-footer {
      border-color: #333;
    }
    body.dark-mode .btn-close {
      filter: invert(1);
    }
    
    #adminLogoPreview, #navbarLogo {
      height: 40px;
      width: auto;
      max-width: 150px;
      object-fit: contain;
      border-radius: 6px;
      background-color: rgba(255,255,255,0.1);
    }
    #navbarLogoContainer .fallback-logo {
        width:46px;  
        height:46px;  
        background:var(--secondary);  
        border-radius:8px;  
        display:grid;  
        place-items:center;  
        margin-inline-start:.6rem
    }
    
    /* Ensure brand title font switches properly */
    [dir="ltr"] #brandTitle { font-family: var(--font-en), sans-serif; }
    [dir="rtl"] #brandTitle { font-family: var(--font-ur), serif; }

    /* Library card dark mode fix */
    body.dark-mode #library .card,
    body.dark-mode #donationPaymentInfo {  
      background-color: #222;  
      border-color: #444;  
    }
    
    /* Contact info LTR fix */
    #contactInfo span[dir="ltr"] {
        display: inline-block;
    }

    /* Admin image previews */
    .admin-preview-img {
      max-width: 100px;
      height: auto;
      border-radius: 6px;
      margin-top: 10px;
    }

    /* Event Card */
    .event-card {
      background-color: var(--card-bg);
      /* border: 1px solid #e0e0e0; */ /* Handled by card-course */
      border-radius: 8px;
      padding: 1.5rem;
      display: flex;
      gap: 1.5rem;
    }
    .event-card-date {
      flex-shrink: 0;
      background-color: var(--primary);
      color: #fff;
      border-radius: 8px;
      width: 70px;
      height: 70px;
      text-align: center;
      padding: 0.5rem;
    }
    .event-card-date .day {
      font-size: 1.75rem;
      font-weight: 700;
      display: block;
      line-height: 1.1;
    }
    .event-card-date .month {
      font-size: 0.9rem;
      display: block;
      text-transform: uppercase;
    }
    .event-card-body {
      flex-grow: 1;
    }
    .event-card-body h5 {
      font-weight: 700;
      font-size: 1.25rem;
    }
    [dir="rtl"] .event-card-body h5 {
      font-family: var(--font-ur), serif;
      font-size: 1.5rem;
    }

    /* Custom Section */
    .custom-section-img {
      width: 100%;
      height: auto;
      max-height: 400px;
      object-fit: cover;
      border-radius: 8px;
    }
    
    /* Admin Icon Style */
    #adminIcon {
      width: 20px;
      height: 20px;
      fill: #fff;
      vertical-align: text-bottom;
      margin-inline-end: 4px; /* margin-right in LTR, margin-left in RTL */
    }

  </style>
</head>
<body>

  <!-- Navbar -->
  <nav class="navbar navbar-expand-lg">
    <div class="container">
      <a class="navbar-brand d-flex align-items-center" href="#">
        <!-- Logo container -->
        <div id="navbarLogoContainer" class="d-flex align-items-center">
          <div class="fallback-logo">
            <span style="font-weight:700; color:var(--primary)">د</span>
          </div>
        </div>
        <div class="ms-2">
          <!-- Added IDs for i18n -->
          <div id="brandTitle" style="font-size:18px; line-height:1">دارالتعلیم والتربیہ</div>
          <small id="brandSubtitle" style="opacity:.9; font-size:12px">Darut Taleem Wat Tarbiyah</small>
        </div>
      </a>

      <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navLinks">
        <span class="navbar-toggler-icon" style="filter:invert(1)"></span>
      </button>

      <div class="collapse navbar-collapse" id="navLinks">
        <ul class="navbar-nav ms-auto mb-2 mb-lg-0">
          <!-- Added IDs for i18n -->
          <li class="nav-item"><a class="nav-link" href="#home" data-link id="navHome">صفحہ اول</a></li>
          <li class="nav-item"><a class="nav-link" href="#about" data-link id="navAbout">ہمارے بارے میں</a></li>
          <li class="nav-item"><a class="nav-link" href="#courses" data-link id="navCourses">کورسز</a></li>
          <li class="nav-item"><a class="nav-link" href="#events" data-link id="navEvents">پروگرام</a></li>
          <li class="nav-item"><a class="nav-link" href="#gallery" data-link id="navGallery">گیلری</a></li>
          <li class="nav-item"><a class="nav-link" href="#library" data-link id="navLibrary">کتب خانہ</a></li>
          <li class="nav-item"><a class="nav-link" href="#donation" data-link id="navDonation">عطیہ</a></li>
          <li class="nav-item"><a class="nav-link" href="#contact" data-link id="navContact">رابطہ کریں</a></li>
          <!-- UPDATED ADMIN LINK WITH SVG -->
          <li class="nav-item">
            <a class="nav-link btn btn-sm btn-light text-dark ms-2 d-flex align-items-center" href="#admin" id="openAdmin">
              <svg id="adminIcon" viewBox="0 0 20 20" xmlns="http://www.w3.org/2000/svg" fill="currentColor">
                <rect x="0" fill="none" width="20" height="20"/>
                <g>
                <path d="M18 12h-2.18c-.17.7-.44 1.35-.81 1.93l1.54 1.54-2.1 2.1-1.54-1.54c-.58.36-1.23.63-1.91.79V19H8v-2.18c-.68-.16-1.33-.43-1.91-.79l-1.54 1.54-2.12-2.12 1.54-1.54c-.36-.58-.63-1.23-.79-1.91H1V9.03h2.17c.16-.7.44-1.35.8-1.94L2.43 5.55l2.1-2.1 1.54 1.54c.58-.37 1.24-.64 1.93-.81V2h3v2.18c.68.16 1.33.43 1.91.79l1.54-1.54 2.12 2.12-1.54 1.54c.36.59.64 1.24.8 1.94H18V12zm-8.5 1.5c1.66 0 3-1.34 3-3s-1.34-3-3-3-3 1.34-3 3 1.34 3 3 3z"/>
                </g>
              </svg>
              <span id="navAdminText">ایڈمن</span>
            </a>
          </li>
          <li class="nav-item d-flex align-items-center ms-2">
            <select id="langToggle" class="form-select form-select-sm" style="width:auto">
              <option value="ur" selected>اردو</option>
              <option value="en">English</option>
            </select>
          </li>
          <li class="nav-item d-flex align-items-center ms-2">
            <button id="darkModeToggle" class="btn btn-sm btn-outline-light" style="padding: 0.25rem 0.5rem; line-height: 1;">
              <!-- Moon icon -->
              <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" fill="currentColor" class="bi bi-moon-fill" viewBox="0 0 16 16">
                <path d="M6 .278a.768.768 0 0 1 .08.858 7.208 7.208 0 0 0-.878 3.46c0 4.021 3.27 7.291 7.291 7.291.526 0 1.034-.063 1.518-.178.539-.111.558.611.082.858A.768.768 0 0 1 12.5 12.27a7.21 7.21 0 0 1-6.222-6.222.768.768 0 0 1 .278-.858z"/>
              </svg>
              <!-- Sun icon -->
              <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" fill="currentColor" class="bi bi-sun-fill" viewBox="0 0 16 16" style="display:none;">
                <path d="M8 12a4 4 0 1 0 0-8 4 4 0 0 0 0 8M8 0a.5.5 0 0 1 .5.5v2a.5.5 0 0 1-1 0v-2A.5.5 0 0 1 8 0m0 13a.5.5 0 0 1 .5.5v2a.5.5 0 0 1-1 0v-2A.5.5 0 0 1 8 13m-5-4a.5.5 0 0 1 .5-.5h2a.5.5 0 0 1 0 1h-2a.5.5 0 0 1-.5-.5M13 8a.5.5 0 0 1 .5-.5h2a.5.5 0 0 1 0 1h-2a.5.5 0 0 1-.5-.5m-2.121 4.879a.5.5 0 0 1-.707 0l-1.414-1.414a.5.5 0 0 1 .707-.707l1.414 1.414a.5.5 0 0 1 0 .707M4.879 4.879a.5.5 0 0 1-.707 0L2.757 3.464a.5.5 0 1 1 .707-.707l1.414 1.414a.5.5 0 0 1 0 .707m6.242 6.242a.5.5 0 0 1-.707 0l-1.414-1.414a.5.5 0 0 1 .707-.707l1.414 1.414a.5.5 0 0 1 0 .707M4.879 11.121a.5.5 0 0 1-.707 0L2.757 9.707a.5.5 0 0 1 .707-.707l1.414 1.414a.5.5 0 0 1 0 .707"/>
              </svg>
            </button>
          </li>
        </ul>
      </div>
    </div>
  </nav>

  <!-- Announcement bar -->
  <div id="announcementBar" class="announcement-bar" role="region" aria-live="polite">
    <div class="announcement-text" id="announcementContent">Loading announcements...</div>
  </div>

  <!-- Hero -->
  <header id="home" class="hero text-center" data-aos="fade-in" data-aos-duration="1000">
    <div class="container">
      <h1 id="heroTitle" class="display-5 fw-bold">...</h1>
      <p id="heroSubtitle" class="lead">...</p>
      <div class="mt-4">
        <a href="#courses" class="btn btn-outline-light btn-lg me-2" id="heroBtn1">...</a>
        <a href="#contact" class="btn btn-light btn-lg text-dark" id="heroBtn2">...</a>
      </div>
    </div>
  </header>

  <!-- Quick Links Section -->
  <section id="quick-links" class="py-5" data-aos="fade-up">
    <div class="container">
      <div class="row gy-4">
        <!-- Online Donation -->
        <div class="col-lg-3 col-md-4 col-6" data-aos="fade-up" data-aos-delay="100">
          <a href="#donation" class="quick-link-card" data-link>
            <!-- REPLACED SVG -->
            <svg version="1.1" id="Layer_1" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" x="0px" y="0px" viewBox="0 0 512 512" xml:space="preserve">
              <g><g><g>
                <path d="M93.871,435.2c2.185,0,4.36-0.836,6.033-2.5c3.328-3.337,3.328-8.738,0-12.066l-68.745-68.71 c-0.58-0.503-14.089-12.553-14.089-36.19v-128c0-9.412,7.654-17.067,17.067-17.067c9.412,0,17.067,7.654,17.067,17.067v67.55 c0,4.719,3.814,8.533,8.533,8.533c4.71,0,8.533-3.814,8.533-8.533v-67.55c0-18.825-15.317-34.133-34.133-34.133 c-18.825,0-34.133,15.309-34.133,34.133v128c0,31.863,19.268,48.495,19.567,48.7L87.838,432.7 C89.502,434.364,91.686,435.2,93.871,435.2z"/>
                <path d="M196.271,460.8H59.738c-4.719,0-8.533,3.823-8.533,8.533v34.133c0,4.71,3.814,8.533,8.533,8.533 c4.71,0,8.533-3.823,8.533-8.533v-25.6h119.467v25.6c0,4.71,3.814,8.533,8.533,8.533c4.71,0,8.533-3.823,8.533-8.533v-34.133 C204.804,464.623,200.981,460.8,196.271,460.8z"/>
                <path d="M51.725,307.029c0.35,8.585,4.087,16.853,10.513,23.27l42.667,42.667c3.328,3.336,8.73,3.336,12.066,0 c3.328-3.337,3.328-8.738,0-12.066l-42.675-42.675c-3.388-3.379-5.342-7.603-5.521-11.887c-0.171-4.215,1.382-8.09,4.497-11.204 c3.106-3.115,7.006-4.659,11.204-4.497c4.284,0.179,8.508,2.142,11.896,5.53l60.126,60.109 c0.58,0.512,14.174,12.919,14.174,36.258V435.2c0,4.71,3.814,8.533,8.533,8.533c4.71,0,8.533-3.823,8.533-8.533v-42.667 c0-31.403-19.191-48.401-19.567-48.7L108.437,284.1c-6.417-6.426-14.686-10.163-23.262-10.513 c-9.011-0.358-17.493,2.995-23.97,9.481C54.72,289.545,51.358,298.061,51.725,307.029z"/>
                <path d="M344.273,343.415c-0.811,0.717-20.002,17.715-20.002,49.118V435.2c0,4.71,3.814,8.533,8.533,8.533 c4.71,0,8.533-3.823,8.533-8.533v-42.667c0-23.339,13.585-35.746,14.566-36.634l59.725-59.733 c3.388-3.388,7.612-5.35,11.904-5.53c4.292-0.145,8.09,1.391,11.196,4.497c2.953,2.953,4.514,6.613,4.514,10.598 c0,4.497-1.971,8.934-5.547,12.501L395.029,360.9c-3.328,3.328-3.328,8.73,0,12.066c3.337,3.336,8.738,3.336,12.066,0 l42.667-42.658c6.793-6.784,10.539-15.514,10.547-24.576c0-8.482-3.371-16.529-9.515-22.664 c-6.477-6.485-15.087-9.83-23.962-9.481c-8.584,0.35-16.845,4.087-23.27,10.513L344.273,343.415z"/>
                <path d="M409.596,93.867C409.596,42.103,367.492,0,315.738,0c-36.361,0-69.768,21.291-85.129,54.255 c-1.988,4.275-0.145,9.353,4.13,11.341c4.267,1.997,9.344,0.137,11.341-4.13c12.57-26.974,39.91-44.399,69.658-44.399 c42.342,0,76.791,34.449,76.791,76.8c0,50.099-50.97,129.707-136.525,177.971c-85.564-48.265-136.533-127.872-136.533-177.971 c0-42.351,34.449-76.8,76.8-76.8c10.692,0,21.035,2.15,30.746,6.4c4.318,1.886,9.353-0.077,11.238-4.395 c1.894-4.318-0.077-9.344-4.395-11.238C221.982,2.637,209.327,0,196.271,0c-51.763,0-93.867,42.103-93.867,93.867 c0,55.1,52.395,142.251,149.513,195.226c1.271,0.691,2.68,1.041,4.087,1.041c1.408,0,2.807-0.35,4.087-1.041 C357.201,236.117,409.596,148.975,409.596,93.867z"/>
                <path d="M477.862,153.6c-18.816,0-34.133,15.309-34.133,34.133v67.55c0,4.719,3.823,8.533,8.533,8.533 c4.71,0,8.533-3.814,8.533-8.533v-67.55c0-9.412,7.654-17.067,17.067-17.067s17.067,7.654,17.067,17.067v128 c0,23.637-13.508,35.686-14.566,36.634l-68.267,68.267c-3.328,3.328-3.328,8.73,0,12.066c1.664,1.664,3.849,2.5,6.033,2.5 s4.369-0.836,6.033-2.5l67.738-67.78c0.819-0.691,20.096-17.323,20.096-49.186v-128C511.996,168.909,496.687,153.6,477.862,153.6 z"/>
                <path d="M452.262,460.8H315.738c-4.719,0-8.533,3.823-8.533,8.533v34.133c0,4.71,3.814,8.533,8.533,8.533 c4.71,0,8.533-3.823,8.533-8.533v-25.6h119.458v25.6c0,4.71,3.823,8.533,8.533,8.533c4.71,0,8.533-3.823,8.533-8.533v-34.133 C460.796,464.623,456.973,460.8,452.262,460.8z"/>
                <path d="M330.014,53.641c11.989,4.258,21.692,13.969,25.958,25.992c1.246,3.499,4.531,5.683,8.038,5.683 c0.947,0,1.911-0.162,2.859-0.495c4.437-1.579,6.758-6.46,5.188-10.897c-6.05-17.067-19.294-30.319-36.335-36.369 c-4.437-1.562-9.318,0.751-10.897,5.188C323.255,47.189,325.568,52.062,330.014,53.641z"/>
              </g></g></g>
            </svg>
            <h5 id="qLinkDonation">آن لائن عطیہ</h5>
          </a>
        </div>
        <!-- Online Fatwa -->
        <div class="col-lg-3 col-md-4 col-6" data-aos="fade-up" data-aos-delay="200">
          <a href="#contact" class="quick-link-card" data-link>
            <!-- REPLACED SVG -->
            <svg viewBox="0 0 1000 1000" xmlns="http://www.w3.org/2000/svg" fill="currentColor">
              <path d="M287 435q-42 0-74.5 18.5t-51 52.5-18.5 77 18.5 76.5 51.5 52 74 18.5q38 0 67-15l-92-92h74l60 59q16-18 24-39 11-26 11-60 0-43-18.5-77T361 453.5 287 435zm590-328h-57q-10 0-19.5-5T786 89l-39-72q-6-8-14.5-12.5t-18-4.5T696 4.5 682 17l-39 72q-6 8-15 13t-19 5h-58q-33 0-61 16.5t-44.5 45T429 230v56H123q-34 0-62 16.5T16.5 347 0 408v362q0 33 16.5 61.5t44.5 45 62 16.5h69q11 0 20 5t15 13l26 72q6 8 14.5 12.5t18.5 4.5 18.5-4.5T318 983l27-72q6-8 15-13t19-5h70q33 0 61-16.5t44.5-45T572 770v-56h305q34 0 62-16.5t44.5-44.5 16.5-61V230q0-33-16.5-61.5t-44.5-45-62-16.5zM426 786l-29-30q-46 30-110 30-58 0-104.5-26.5t-73-73T83 583t26.5-103.5 73-73.5 104-27T391 406t73.5 73.5T491 583q0 82-54 140l63 63h-74zm503-194q0 21-15.5 36T877 643H571v-52h14l42-94h168l41 94h64L715 177 571 482v-74q0-35-19-65.5T500 297v-67q0-21 15-36t36-15h70q22 0 34.5-7t20.5-21q6-9 14-31 7-18 11-26.5t13.5-8.5 12.5 8l10 27q10 28 15 36 8 13 19.5 18t36.5 5h69q21 0 36.5 15t15.5 36v362zM652 440l60-132 59 132H652z"/>
            </svg>
            <h5 id="qLinkFatwa">آن لائن فتویٰ</h5>
          </a>
        </div>
        <!-- Library -->
        <div class="col-lg-3 col-md-4 col-6" data-aos="fade-up" data-aos-delay="300">
          <a href="#library" class="quick-link-card" data-link>
            <!-- REPLACED SVG -->
            <svg version="1.1" id="Layer_1" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" x="0px" y="0px" viewBox="0 0 512 512" xml:space="preserve" fill="currentColor">
              <polygon points="186.268,406.163 186.268,466.42 143.084,443.174 99.9,466.42 99.9,406.163 99.9,373.801 99.9,332.98 186.268,332.98 186.268,373.878 " fill="#F95428"/>
              <g>
                <path d="M455.241,332.98c1.627,13.973,5.295,27.752,10.99,40.899H186.268V332.98H99.9v40.821 c-9.556-0.478-18.699-3.306-26.68-8.071c-8.807-5.23-16.22-12.798-21.269-22.135c-4.662-8.601-6.986-18.092-6.986-27.571 c0-9.492,2.325-18.984,6.986-27.571c0.142-0.258,0.284-0.517,0.439-0.775c10.215-18.222,29.495-29.521,50.429-29.521H466.23 c-4.145,9.556-7.206,19.461-9.195,29.521c-0.749,3.771-1.356,7.58-1.795,11.39c-0.672,5.63-1.007,11.3-1.007,16.956 C454.233,321.693,454.569,327.349,455.241,332.98z" fill="#F7B239"/>
                <path d="M56.754,152.688c0.672-5.63,1.007-11.287,1.007-16.956c0-5.656-0.336-11.326-1.007-16.956 c-1.614-13.973-5.282-27.765-10.99-40.911h174.597h188.828c21.218,0,40.744,11.623,50.868,30.283 c4.662,8.601,6.986,18.092,6.986,27.584c0,9.479-2.324,18.971-6.986,27.571c-5.062,9.337-12.475,16.904-21.269,22.135 c-8.807,5.243-18.984,8.149-29.599,8.149H220.361H45.764C51.472,180.44,55.14,166.661,56.754,152.688z" fill="#F7B239"/>
              </g>
              <path d="M460.057,108.147c-10.125-18.661-29.65-30.283-50.868-30.283h-48.425 c21.218,0,40.744,11.623,50.868,30.283c4.662,8.601,6.986,18.092,6.986,27.584c0,9.479-2.324,18.971-6.986,27.571 c-5.062,9.337-12.475,16.904-21.269,22.135c-8.807,5.243-18.984,8.149-29.599,8.149h48.425c10.615,0,20.792-2.906,29.599-8.149 c8.794-5.23,16.207-12.798,21.269-22.135c4.662-8.601,6.986-18.092,6.986-27.571C467.044,126.24,464.719,116.748,460.057,108.147z" fill="#E09B2D"/>
              <g>
                <path d="M497.585,378.605c2.919,2.919,4.727,6.961,4.727,11.416c0,8.924-7.232,16.142-16.142,16.142H186.268 v-32.285h105.365H466.23h19.939C490.625,373.878,494.654,375.686,497.585,378.605z" fill="#2BA5F7"/>
                <path d="M497.585,230.598c2.919,2.931,4.727,6.961,4.727,11.416c0,8.911-7.232,16.142-16.142,16.142H466.23 H291.634H102.818c-21.231,0-40.756,11.623-50.868,30.296c-4.662,8.588-6.986,18.08-6.986,27.571 c0,9.479,2.325,18.971,6.986,27.571c5.049,9.337,12.462,16.904,21.269,22.135c7.981,4.765,17.124,7.593,26.68,8.071v32.362h-0.065 c-24.885,0-47.433-10.086-63.743-26.396c-16.31-16.323-26.409-38.845-26.409-63.743c0-49.796,40.369-90.152,90.152-90.152h312.337 h73.997C490.625,225.871,494.654,227.679,497.585,230.598z" fill="#2BA5F7"/>
              </g>
              <path d="M412.172,45.579c49.783,0,90.139,40.356,90.139,90.152c0,24.898-10.086,47.42-26.396,63.743 c-16.31,16.31-38.858,26.396-63.743,26.396H99.835h-74.01c-8.911,0-16.142-7.219-16.142-16.142c0-4.455,1.808-8.497,4.727-11.416 s6.961-4.727,11.416-4.727h19.939h174.597h188.828c10.615,0,20.791-2.906,29.599-8.149c8.794-5.23,16.207-12.798,21.269-22.135 c4.662-8.601,6.986-18.092,6.986-27.571c0-9.492-2.324-18.984-6.986-27.584c-10.125-18.661-29.65-30.283-50.868-30.283H220.361 H45.765H25.825c-8.911,0-16.142-7.232-16.142-16.142c0-4.455,1.808-8.484,4.727-11.416c2.919-2.919,6.961-4.727,11.416-4.727 C25.825,45.579,412.172,45.579,412.172,45.579z" fill="#F95428"/>
              <g>
                <path d="M466.23,258.156c-4.145,9.556-7.206,19.461-9.195,29.521H52.389 c10.215-18.222,29.496-29.521,50.429-29.521H466.23z" fill="#E09B2D"/>
                <path d="M45.777,77.864c4.145,9.556,7.206,19.461,9.195,29.521h404.646 c-10.215-18.222-29.495-29.521-50.429-29.521H45.777z" fill="#E09B2D"/>
                <path d="M99.9,332.98v40.821c-9.556-0.478-18.699-3.306-26.68-8.071c-8.807-5.23-16.22-12.798-21.269-22.135 c-1.86-3.409-3.332-6.974-4.442-10.615L99.9,332.98L99.9,332.98z" fill="#E09B2D"/>
              </g>
              <g>
                <path d="M157.368,425.207c-5.349,0-9.685-4.337-9.685-9.685v-24.537c0-5.349,4.337-9.685,9.685-9.685 s9.685,4.337,9.685,9.685v24.537C167.054,420.871,162.717,425.207,157.368,425.207z" fill="#FFFFFF"/>
                <circle cx="157.37" cy="362.883" r="9.685" fill="#FFFFFF"/>
              </g>
              <g>
                <path d="M472.77,267.844h13.402c14.241,0,25.828-11.586,25.828-25.828c0-6.879-2.681-13.361-7.578-18.281 c-4.889-4.867-11.371-7.547-18.25-7.547h-14.996C495.909,198,512,168.713,512,135.726c0-55.048-44.786-99.834-99.834-99.834H25.832 c-14.242,0-25.828,11.586-25.828,25.828S11.59,87.548,25.832,87.548H39.24c11.716,30.943,11.716,65.412,0,96.355H25.832 c-14.242,0-25.828,11.586-25.828,25.828s11.586,25.828,25.828,25.828h14.996C16.092,253.75,0,283.039,0,316.026 c0,26.647,10.385,51.717,29.245,70.592c16.565,16.565,37.932,26.583,60.966,28.771v51.033c0,3.409,1.792,6.567,4.717,8.314 c2.928,1.749,6.556,1.83,9.558,0.214l38.596-20.773l38.596,20.773c1.435,0.772,3.013,1.157,4.591,1.157 c1.721,0,3.44-0.458,4.968-1.371c2.926-1.749,4.717-4.906,4.717-8.314v-50.571h290.216c14.241,0,25.828-11.586,25.828-25.828 c0-6.901-2.686-13.388-7.578-18.28c-4.889-4.867-11.371-7.548-18.25-7.548h-13.402c-3.952-10.419-6.618-21.267-7.91-32.36 c-0.624-5.226-0.94-10.546-0.94-15.809s0.316-10.582,0.943-15.836C466.154,289.111,468.82,278.26,472.77,267.844z M65.084,162.371 h99.376c5.349,0,9.685-4.337,9.685-9.685S169.808,143,164.459,143H67.211c0.226-4.845,0.226-9.697,0-14.541h47.955 c5.349,0,9.685-4.337,9.685-9.685s-4.337-9.685-9.685-9.685H65.084c-1.259-7.273-3.009-14.475-5.308-21.538h349.408 c17.693,0,33.924,9.664,42.355,25.218c7.794,14.376,7.794,31.541,0,45.918c-8.432,15.555-24.662,25.218-42.355,25.218H59.776 C62.074,176.843,63.825,169.642,65.084,162.371z M25.832,216.189c-3.56,0-6.457-2.897-6.457-6.457s2.897-6.457,6.457-6.457h383.352 c24.808,0,47.563-13.548,59.385-35.358c10.927-20.156,10.927-44.224,0-64.38c-11.823-21.81-34.577-35.358-59.385-35.358H45.768 H25.832c-3.56,0-6.457-2.897-6.457-6.457s2.897-6.457,6.457-6.457h386.335c44.367,0,80.463,36.096,80.463,80.463 c0,44.35-36.069,80.435-80.413,80.462H25.832z M42.945,372.924c-15.202-15.214-23.574-35.422-23.574-56.898 c0-44.353,36.07-80.439,80.418-80.466h312.378c0.017,0,0.034-0.001,0.05-0.001h73.956c1.721,0,3.35,0.677,4.552,1.874 c1.228,1.233,1.905,2.862,1.905,4.583c0,3.56-2.897,6.457-6.457,6.457H102.821c-24.815,0-47.571,13.553-59.38,35.36 c-5.339,9.833-8.16,20.965-8.16,32.193c0,11.213,2.82,22.342,8.153,32.178c5.785,10.699,14.376,19.64,24.823,25.843 c6.758,4.034,14.222,6.83,21.955,8.302v13.54C72.362,393.776,55.843,385.821,42.945,372.924z M176.586,450.21l-28.911-15.561 c-1.433-0.771-3.012-1.157-4.591-1.157s-3.157,0.386-4.591,1.157l-28.91,15.561V342.666h67.003V450.21z M490.74,385.455 c1.218,1.218,1.889,2.841,1.889,4.568c0,3.56-2.897,6.457-6.457,6.457H195.957v-12.914h290.216 C487.894,383.566,489.521,384.243,490.74,385.455z M195.957,364.195v-21.529h31.639c5.349,0,9.685-4.336,9.685-9.685 s-4.337-9.685-9.685-9.685h-41.325H99.897c-5.349,0-9.685,4.337-9.685,9.685v29.508c-4.218-1.144-8.283-2.839-12.045-5.086 c-7.457-4.427-13.575-10.795-17.7-18.423c-3.804-7.019-5.815-14.957-5.815-22.955c0-8.009,2.011-15.946,5.818-22.96 c8.424-15.557,24.653-25.222,42.35-25.222h349.396c-2.299,7.043-4.079,14.242-5.345,21.539h-50.034 c-5.349,0-9.685,4.337-9.685,9.685c0,5.349,4.337,9.685,9.685,9.685h47.902c-0.116,2.427-0.19,4.854-0.19,7.272 s0.074,4.844,0.19,7.269h-97.194c-5.349,0-9.685,4.337-9.685,9.685s4.337,9.685,9.685,9.685h99.326 c1.267,7.296,3.046,14.489,5.344,21.529L195.957,364.195L195.957,364.195z" fill="#333333"/>
                <circle cx="197.984" cy="152.682" r="9.685" fill="#333333"/>
              </g>
            </svg>
            <h5 id="qLinkBooks">کتب خانہ</h5>
          </a>
        </div>
        <!-- Gallery -->
        <div class="col-lg-3 col-md-4 col-6" data-aos="fade-up" data-aos-delay="400">
          <a href="#gallery" class="quick-link-card" data-link>
            <!-- REPLACED SVG -->
            <svg viewBox="0 0 24 24" fill="currentColor" xmlns="http://www.w3.org/2000/svg">
              <path d="M2.58078 19.0112L2.56078 19.0312C2.29078 18.4413 2.12078 17.7713 2.05078 17.0312C2.12078 17.7613 2.31078 18.4212 2.58078 19.0112Z" fill="currentColor"/>
              <path d="M9.00109 10.3811C10.3155 10.3811 11.3811 9.31553 11.3811 8.00109C11.3811 6.68666 10.3155 5.62109 9.00109 5.62109C7.68666 5.62109 6.62109 6.68666 6.62109 8.00109C6.62109 9.31553 7.68666 10.3811 9.00109 10.3811Z" fill="currentColor"/>
              <path d="M16.19 2H7.81C4.17 2 2 4.17 2 7.81V16.19C2 17.28 2.19 18.23 2.56 19.03C3.42 20.93 5.26 22 7.81 22H16.19C19.83 22 22 19.83 22 16.19V13.9V7.81C22 4.17 19.83 2 16.19 2ZM20.37 12.5C19.59 11.83 18.33 11.83 17.55 12.5L13.39 16.07C12.61 16.74 11.35 16.74 10.57 16.07L10.23 15.79C9.52 15.17 8.39 15.11 7.59 15.65L3.85 18.16C3.63 17.6 3.5 16.95 3.5 16.19V7.81C3.5 4.99 4.99 3.5 7.81 3.5H16.19C19.01 3.5 20.5 4.99 20.5 7.81V12.61L20.37 12.5Z" fill="currentColor"/>
            </svg>
            <h5 id="qLinkGallery">گیلری</h5>
          </a>
        </div>
      </div>
    </div>
  </section>

  <main class="py-5">
    <div class="container">

      <!-- About -->
      <section id="about" class="mb-5" data-aos="fade-up">
        <div class="section-title mb-3">
          <h2 id="aboutHeading">...</h2>
        </div>
        <div class="row gy-4 align-items-center">
          <div class="col-lg-6" data-aos="fade-right" data-aos-delay="100">
            <p id="aboutText">...</p>
          </div>
          <div class="col-lg-6" data-aos="fade-left" data-aos-delay="100">
            <img id="aboutImage" src="https://images.unsplash.com/photo-1542736667-069246bdbc6d?q=80&w=1600&auto=format&fit=crop&ixlib=rb-4.0.3&s=" alt="Madrasa" class="img-fluid rounded">
          </div>
        </div>
      </section>

      <!-- Courses -->
      <section id="courses" class="mb-5" data-aos="fade-up">
        <div class="section-title mb-3">
          <h2 id="coursesHeading">کورسز</h2>
        </div>
        <div id="coursesList" class="row gy-3">
          <!-- Course cards injected here -->
        </div>
      </section>

      <!-- Events -->
      <section id="events" class="mb-5" data-aos="fade-up">
        <div class="section-title mb-3">
          <h2 id="eventsHeading">پروگرام</h2>
        </div>
        <div id="eventsList" class="row gy-4">
          <!-- Event cards injected here -->
        </div>
      </section>

      <!-- Custom Sections Container -->
      <div id="customSectionsContainer" data-aos="fade-up">
        <!-- Custom sections injected here -->
      </div>

      <!-- Gallery -->
      <section id="gallery" class="mb-5" data-aos="fade-up">
        <div class="section-title mb-3">
          <h2 id="galleryHeading">گیلری</h2>
        </div>
        <div id="galleryGrid" class="gallery-grid">
          <!-- images injected here -->
        </div>
      </section>

      <!-- Library Section - Updated to be a link card -->
      <section id="library" class="mb-5" data-aos="fade-up">
        <div class="section-title mb-3">
          <h2 id="libraryHeading">کتب خانہ</h2>
        </div>
        <div class="card text-center p-4" style="background-color: var(--card-bg);">
          <div class="card-body">
            <h5 class="card-title" id="libraryCardTitle">Darul Uloom Deoband - Online Books</h5>
            <p class="card-text" id="libraryCardText">The requested library cannot be embedded directly on this page due to security restrictions. You can access the full library by clicking the button below.</p>
            <a href="http://darululoom-deoband.com/books/" id="libraryCardButton" class="btn btn-primary" target="_blank" rel="noopener noreferrer">Visit Library</a>
          </div>
        </div>
      </section>

      <!-- Donation Section -->
      <section id="donation" class="mb-5" data-aos="fade-up">
        <div class="section-title mb-3">
          <h2 id="donationHeading">عطیہ فارم</h2>
        </div>
        <div class="row">
          <div class="col-lg-8">
            <form id="donationForm">
              <div class="row">
                <!-- Donation Amount -->
                <div class="col-md-6 mb-3">
                  <label for="donationAmount" class="form-label" id="lblDonationAmount">Donation Amount (Indian Rupees)</label>
                  <input type="number" class="form-control" id="donationAmount" placeholder="Enter numeric value" required>
                </div>
                <!-- Donation Type -->
                <div class="col-md-6 mb-3">
                  <label for="donationType" class="form-label" id="lblDonationType">Donation Type</label>
                  <select class="form-select" id="donationType">
                    <option value="General" id="optDonationGeneral">General Donation</option>
                    <option value="Zakat" id="optDonationZakat">Zakat</option>
                    <option value="Sadqa" id="optDonationSadqa">Sadqa</option>
                    <option value="Construction" id="optDonationConstruction">Construction</option>
                    <option value="Other" id="optDonationOther">Other</option>
                  </select>
                </div>
                <!-- Other Donation Type (Hidden by default) -->
                <div class="col-md-12 mb-3" id="otherDonationTypeContainer" style="display: none;">
                  <label for="otherDonationType" class="form-label" id="lblOtherDonationType">Other Donation Type</label>
                  <input type="text" class="form-control" id="otherDonationType" placeholder="Specify, if other donation type">
                </div>
                <!-- Name -->
                <div class="col-md-6 mb-3">
                  <label for="donationName" class="form-label" id="lblDonationName">Name</label>
                  <input type="text" class="form-control" id="donationName" placeholder="Enter Full Name" required>
                </div>
                <!-- Phone -->
                <div class="col-md-6 mb-3">
                  <label for="donationPhone" class="form-label" id="lblDonationPhone">Mobile / Phone No.</label>
                  <input type="tel" class="form-control" id="donationPhone" placeholder="10 digits only" pattern="[0-9]{10}" required>
                </div>
                <!-- Address -->
                <div class="col-12 mb-3">
                  <label for="donationAddress" class="form-label" id="lblDonationAddress">Complete Address</label>
                  <textarea class="form-control" id="donationAddress" rows="3" placeholder="Including Pin within India" required></textarea>
                </div>
                <!-- Email -->
                <div class="col-md-6 mb-3">
                  <label for="donationEmail" class="form-label" id="lblDonationEmail">Email ID</label>
                  <input type="email" class="form-control" id="donationEmail" placeholder="Valid Email Address" required>
                </div>
                <!-- Document ID -->
                <div class="col-md-6 mb-3">
                  <label for="donationDocId" class="form-label" id="lblDonationDocId">Document ID (Aadhaar/PAN) No.</label>
                  <input type="text" class="form-control" id="donationDocId" placeholder="Valid Document No." required>
                </div>
              </div>
              <button class="btn btn-success btn-lg" type="submit" id="donationSubmit">Donate Now</button>
            </form>
          </div>
          <div class="col-lg-4">
            <!-- Payment Info Container -->
            <div id="donationPaymentInfo" class="text-center p-3 rounded" style="background-color: var(--card-bg); border: 1px solid #ddd; display: none;">
              <h5 id="donationPaymentTitle">Complete Your Donation</h5>
              <p id="donationPaymentSubtitle">Please support us by donating via UPI.</p>
              <img id="donationQR" src="" alt="UPI QR Code" class="img-fluid rounded mb-3" style="max-width: 200px;">
              <div class="input-group mb-3">
                <input type="text" id="upiIdInput" class="form-control" value="your-upi-id@ok" readonly>
                <button class="btn btn-outline-secondary" type="button" id="copyUpiButton">
                  <span id="copyUpiBtnText">Copy</span>
                </button>
              </div>
              <a id="payNowLink" href="#" class="btn btn-primary" target="_blank">
                <span id="payNowBtnText">Pay Now</span>
              </a>
            </div>
          </div>
        </div>
      </section>

      <!-- Contact -->
      <section id="contact" class="mb-5" data-aos="fade-up">
        <div class="section-title mb-3">
          <h2 id="contactHeading">رابطہ کریں</h2>
        </div>
        <div class="row">
          <div class="col-lg-6">
            <form id="contactForm">
              <div class="mb-3">
                <label class="form-label" id="lblName">نام</label>
                <input type="text" class="form-control" id="contactName" required>
              </div>
              <div class="mb-3">
                <label class="form-label" id="lblEmail">ای میل</label>
                <input type="email" class="form-control" id="contactEmail" required>
              </div>
              <div class="mb-3">
                <label class="form-label" id="lblSubject">موضوع</label>
                <input type="text" class="form-control" id="contactSubject">
              </div>
              <div class="mb-3">
                <label class="form-label" id="lblMessage">پیغام</label>
                <textarea class="form-control" id="contactMessage" rows="4" required></textarea>
              </div>
              <button class="btn btn-success" type="submit" id="contactSubmit">ارسال</button>
            </form>
            <!-- Note about email functionality -->
            <small class="d-block mt-3 text-muted" id="contactFormNote">Note: This is a demo. Messages are saved to your Firebase Admin Panel (Firestore) and are not sent via email.</small>
          </div>
          <!-- Updated Contact Info with LTR fixes -->
          <div class="col-lg-6">
            <h5 id="contactInfoHeading">رابطہ کی معلومات</h5>
            <p id="contactInfo" style="line-height: 1.8;">
              <strong id="lblAddress">پتہ:</strong> <span dir="ltr">H.no: 9, 4-134/5/A/1/1, Raghava Colony, Nadeem Colony, Vali Colony, Toli Chowki, Hyderabad, Telangana 500008</span><br>
              <strong id="lblPhone">فون:</strong> <span dir="ltr"><a href="tel:0905843885" class="text-dark" style="text-decoration:none;">090584 3885</a></span><br>
              <strong id="lblContactEmail">ای میل:</strong> <span dir="ltr"><a id="contactEmailLink" href="mailto:madrasadaruttaleemwattarbiyah@gmail.com" class="text-dark" style="text-decoration:none;">madrasadaruttaleemwattarbiyah@gmail.com</a></span><br>
              <strong id="lblMap">نقشہ:</strong> <a id="linkMap" href="https://maps.app.goo.gl/X85qiTVBdRNCRn8X7" target="_blank" rel="noopener noreferrer">گوگل میپس پر دیکھیں</a>
            </p>
          </div>
        </div>
      </section>

    </div>
  </main>

  <!-- Footer -->
  <footer class="footer text-center text-white">
    <div class="container">
      <div class="row">
        <div class="col-md-6 text-md-end">
          <p style="margin:0">© <span id="year"></span> دارالتعلیم والتربیہ</p>
        </div>
        <div class="col-md-6 text-md-start">
          <small>Follow us: <a href="#" class="text-white">Facebook</a> | <a href="#" class="text-white">Instagram</a></small>
        </div>
      </div>
    </div>
  </footer>

  <!-- Admin Modal / Panel (single-page simulated) -->
  <div class="modal fade" id="adminModal" tabindex="-1">
    <div class="modal-dialog modal-xl modal-dialog-scrollable">
      <div class="modal-content">
        <div class="modal-header">
          <h5 class="modal-title">ایڈمن پینل</h5>
          <button type="button" class="btn-close" data-bs-dismiss="modal"></button>
        </div>
        <div class="modal-body">

          <!-- Login view -->
          <div id="adminLoginView">
            <form id="adminLoginForm">
              <div class="mb-3">
                <label id="lblAdminEmail">Email</label>
                <input class="form-control" id="adminUser" value="admin@madrasa.com">
              </div>
              <div class="mb-3">
                <label id="lblAdminPass">Password</label>
                <input class="form-control" id="adminPass" type="password" value="password">
              </div>
              <button class="btn btn-primary">Login</button>
            </form>
          </div>

          <!-- Panel view -->
          <div id="adminPanelView" style="display:none">
            <div class="row admin-panel">
              <div class="col-lg-3">
                <div class="list-group mb-3">
                  <button class="list-group-item list-group-item-action active" data-panel="ann">Announcements</button>
                  <button class="list-group-item list-group-item-action" data-panel="hero">Homepage (Hero)</button>
                  <button class="list-group-item list-group-item-action" data-panel="about">About Us</button>
                  <button class="list-group-item list-group-item-action" data-panel="courses">Courses</button>
                  <button class="list-group-item list-group-item-action" data-panel="events">Events</button>
                  <button class="list-group-item list-group-item-action" data-panel="customSections">Custom Sections</button>
                  <button class="list-group-item list-group-item-action" data-panel="gallery">Gallery</button>
                  <button class="list-group-item list-group-item-action" data-panel="logo">Logo</button>
                  <button class="list-group-item list-group-item-action" data-panel="donation">Donation Settings</button>
                  <button class="list-group-item list-group-item-action" data-panel="fonts">Font Settings</button>
                  <button class="list-group-item list-group-item-action" data-panel="messages">Messages</button>
                  <button class="list-group-item list-group-item-action" data-panel="donations" id="adminNavDonations">Donations</button>
                </div>

                <div>
                  <button id="adminLogout" class="btn btn-outline-danger btn-sm">Logout</button>
                </div>
              </div>

              <div class="col-lg-9">
                <div id="panelContent">
                  <!-- dynamic admin content injected here -->
                </div>
              </div>
            </div>
          </div>

        </div>
        <div class="modal-footer">
          <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">بند کریں</button>
        </div>
      </div>
    </div>
  </div>

  <!-- Custom Toast Notification -->
  <div id="customToast" class="position-fixed bottom-0 end-0 p-3" style="z-index: 1100">
    <div class="toast align-items-center text-white bg-success border-0" role="alert" aria-live="assertive" aria-atomic="true">
      <div class="d-flex">
        <div id="toastBody" class="toast-body">
          Message sent successfully.
        </div>
        <button type="button" class="btn-close btn-close-white me-2 m-auto" data-bs-dismiss="toast" aria-label="Close"></button>
      </div>
    </div>
  </div>


  <!-- Bootstrap + Dependencies -->
  <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/js/bootstrap.bundle.min.js"></script>

  <!-- AOS Animation Library JS -->
  <script src="https://unpkg.com/aos@2.3.1/dist/aos.js"></script>

  <!-- ADD FIREBASE SDKs (Modular) -->
  <script type="module">
    // Import the functions you need from the SDKs you need
    import { initializeApp } from "https://www.gstatic.com/firebasejs/9.22.1/firebase-app.js";
    import { 
      getFirestore, collection, getDocs, onSnapshot, doc, getDoc, 
      addDoc, setDoc, deleteDoc, updateDoc, query, where, orderBy 
    } from "https://www.gstatic.com/firebasejs/9.22.1/firebase-firestore.js";
    import { 
      getAuth, signInWithEmailAndPassword, onAuthStateChanged, signOut 
    } from "https://www.gstatic.com/firebasejs/9.22.1/firebase-auth.js";
    
    // Your web app's Firebase configuration
    const firebaseConfig = {
      apiKey: "AIzaSyANp3lRfm2eruX3Y3M9_T5GIyfN6bRp0j8",
      authDomain: "madrasa-website-12926.firebaseapp.com",
      projectId: "madrasa-website-12926",
      storageBucket: "madrasa-website-12926.firebasestorage.app",
      messagingSenderId: "202677366743",
      appId: "1:202677366743:web:41109ec3d872be8472a592",
      measurementId: "G-N1Y5J2ELS4"
    };

    // Initialize Firebase
    const app = initializeApp(firebaseConfig);
    const db = getFirestore(app);
    const auth = getAuth(app);

    // ----------------- i18n content -----------------
    const i18n = {
      ur: {
        brandTitle: 'دارالتعلیم والتربیہ',
        brandSubtitle: 'Darut Taleem Wat Tarbiyah',
        navHome: 'صفحہ اول',
        navAbout: 'ہمارے بارے میں',
        navCourses: 'کورسز',
        navEvents: 'پروگرام',
        navGallery: 'گیلری',
        navLibrary: 'کتب خانہ',
        navDonation: 'عطیہ',
        navContact: 'رابطہ کریں',
        navAdmin: 'ایڈمن',
        heroBtn1: 'مزید جانیں',
        heroBtn2: 'رابطہ کریں',
        qLinkDonation: 'آن لائن عطیہ',
        qLinkFatwa: 'آن لائن فتویٰ',
        qLinkBooks: 'کتب خانہ',
        qLinkGallery: 'گیلری',
        eventsHeading: 'پروگرام',
        coursesHeading: 'کورسز',
        galleryHeading: 'گیلری',
        contactHeading: 'رابطہ کریں',
        lblName: 'نام', lblEmail: 'ای میل', lblSubject: 'موضوع', lblMessage: 'پیغام', contactSubmit: 'ارسال', contactInfoHeading: 'رابطہ کی معلومات',
        lblAddress: 'پتہ:',
        lblPhone: 'فون:',
        lblContactEmail: 'ای میل:',
        lblMap: 'نقشہ:',
        linkMap: 'گوگل میپس پر دیکھیں',
        libraryHeading: 'کتب خانہ',
        libraryCardTitle: 'دارالعلوم دیوبند - آن لائن کتب',
        libraryCardText: 'درخواست کردہ کتب خانہ کو سیکورٹی پابندیوں کی وجہ سے براہ راست اس صفحہ پر نہیں دکھایا جا سکتا۔ آپ نیچے دیے گئے بٹن پر کلک کر کے مکمل کتب خانہ تک رسائی حاصل کر سکتے ہیں۔',
        libraryCardButton: 'کتب خانہ پر جائیں',
        contactFormNote: 'نوٹ: یہ ایک ڈیمو ہے۔ پیغامات کو ایڈمن پینل (فائربیس) میں محفوظ کیا جاتا ہے اور ای میل کے ذریعے نہیں بھیجا جاتا۔',
        donationHeading: 'عطیہ فارم',
        lblDonationAmount: 'رقمِ عطیہ (ہندوستانی روپیے)',
        lblDonationType: 'عطیہ کی قسم',
        optDonationGeneral: 'عام عطیہ',
        optDonationZakat: 'زکوٰۃ',
        optDonationSadqa: 'صدقہ',
        optDonationConstruction: 'تعمیر',
        optDonationOther: 'دیگر',
        lblOtherDonationType: 'دیگر عطیہ کی قسم',
        lblDonationName: 'نام',
        lblDonationPhone: 'موبائل / فون نمبر',
        lblDonationAddress: 'مکمل پتہ',
        lblDonationEmail: 'ای میل آئی ڈی',
        lblDonationDocId: 'دستاویز آئی ڈی (آدھار/پین) نمبر',
        donationSubmit: 'ابھی عطیہ دیں',
        donationPaymentTitle: 'اپنا عطیہ مکمل کریں۔',
        donationPaymentSubtitle: 'برائے مہربانی UPI کے ذریعے عطیہ دے کر ہماری مدد کریں۔',
        copyUpiBtnText: 'کاپی',
        payNowBtnText: 'ابھی ادا کریں۔',
        copiedToast: 'UPI ID کاپی ہو گیا!',
        adminLogo: 'لوگو',
        adminDonations: 'عطیات',
        adminHomepage: 'Homepage (Hero)',
        adminAbout: 'About Us',
        adminDonationSettings: 'Donation Settings',
        adminEvents: 'Events',
        adminCustomSections: 'Custom Sections',
        adminFontSettings: 'Font Settings',
        lblAdminEmail: 'ای میل',
        lblAdminPass: 'پاسورڈ',
      },
      en: {
        brandTitle: 'Darut Taleem Wat Tarbiyah',
        brandSubtitle: 'Knowledge and Upbringing',
        navHome: 'Home',
        navAbout: 'About Us',
        navCourses: 'Courses',
        navEvents: 'Events',
        navGallery: 'Gallery',
        navLibrary: 'Library',
        navDonation: 'Donation',
        navContact: 'Contact Us',
        navAdmin: 'Admin',
        heroBtn1: 'Learn More',
        heroBtn2: 'Contact Us',
        qLinkDonation: 'Online Donation',
        qLinkFatwa: 'Online Fatwa',
        qLinkBooks: 'Library',
        qLinkGallery: 'Gallery',
        eventsHeading: 'Events',
        coursesHeading: 'Courses',
        galleryHeading: 'Gallery',
        contactHeading: 'Contact Us',
        lblName: 'Name', lblEmail: 'Email', lblSubject: 'Subject', lblMessage: 'Message', contactSubmit: 'Send', contactInfoHeading: 'Contact Information',
        lblAddress: 'Address:',
        lblPhone: 'Phone:',
        lblContactEmail: 'Email:',
        lblMap: 'Map:',
        linkMap: 'View on Google Maps',
        libraryHeading: 'Library',
        libraryCardTitle: 'Darul Uloom Deoband - Online Books',
        libraryCardText: 'The requested library cannot be embedded directly on this page due to security restrictions. You can access the full library by clicking the button below.',
        libraryCardButton: 'Visit Library',
        contactFormNote: 'Note: This is a demo. Messages are saved to your Firebase Admin Panel (Firestore) and are not sent via email.',
        donationHeading: 'Donation Form',
        lblDonationAmount: 'Donation Amount (Indian Rupees)',
        lblDonationType: 'Donation Type',
        optDonationGeneral: 'General Donation',
        optDonationZakat: 'Zakat',
        optDonationSadqa: 'Sadqa',
        optDonationConstruction: 'Construction',
        optDonationOther: 'Other',
        lblOtherDonationType: 'Other Donation Type',
        lblDonationName: 'Name',
        lblDonationPhone: 'Mobile / Phone No.',
        lblDonationAddress: 'Complete Address',
        lblDonationEmail: 'Email ID',
        lblDonationDocId: 'Document ID (Aadhaar/PAN) No.',
        donationSubmit: 'Donate Now',
        donationPaymentTitle: 'Complete Your Donation',
        donationPaymentSubtitle: 'Please support us by donating via UPI.',
        copyUpiBtnText: 'Copy',
        payNowBtnText: 'Pay Now',
        copiedToast: 'UPI ID Copied!',
        adminLogo: 'Logo',
        adminDonations: 'Donations',
        adminHomepage: 'Homepage (Hero)',
        adminAbout: 'About Us',
        adminDonationSettings: 'Donation Settings',
        adminEvents: 'Events',
        adminCustomSections: 'Custom Sections',
        adminFontSettings: 'Font Settings',
        lblAdminEmail: 'Email',
        lblAdminPass: 'Password',
      }
    };
    
    // NEW: Font options
    const fontOptions = {
      ur: [
        { name: 'Jameel Noori Nastaleeq', value: "'Jameel Noori Nastaleeq', 'Noto Nastaliq Urdu', serif" },
        { name: 'Noto Nastaliq Urdu', value: "'Noto Nastaliq Urdu', serif" },
        { name: 'Noto Naskh Arabic', value: "'Noto Naskh Arabic', sans-serif" },
        { name: 'Almarai', value: "'Almarai', sans-serif" }
      ],
      en: [
        { name: 'Poppins', value: "'Poppins', sans-serif" },
        { name: 'Roboto', value: "'Roboto', sans-serif" },
        { name: 'Open Sans', value: "'Open Sans', sans-serif" },
        { name: 'Lato', value: "'Lato', sans-serif" },
        { name: 'Inter', value: "'Inter', sans-serif" }
      ]
    };

    // ----------------- Simple data store (Now in-memory) -----------------
    // We use this to hold dynamic config loaded from Firestore
    const siteData = {
      lang: 'ur',
      config: {
        heroTitleUr: "دارالتعلیم والتربیہ میں خوش آمدید",
        heroTitleEn: "Welcome to Darut Taleem Wat Tarbiyah",
        heroSubtitleUr: "تعلیم، تربیہ اور دین کی روشنی میں بہترین ماحول",
        heroSubtitleEn: "A nurturing place for knowledge & character",
        aboutTextUr: "دارالتعلیم والتربیہ ایک معروف مدرسہ ہے...",
        aboutTextEn: "Darut Taleem Wat Tarbiyah is a madrasa...",
        aboutImage: "https://images.unsplash.com/photo-1542736667-069246bdbc6d?q=80&w=1600&auto=format&fit=crop&ixlib=rb-4.0.3&s=",
        upiId: "your-upi-id@ok",
        fontUr: "'Jameel Noori Nastaleeq', 'Noto Nastaliq Urdu', serif",
        fontEn: "'Poppins', sans-serif"
      },
      logo: null
    };


    // ----------------- DOM helpers -----------------
    const setYear = ()=> document.getElementById('year').textContent = new Date().getFullYear()
    setYear()

    // ----------------- Toast Notification Helper -----------------
    const customToastEl = document.getElementById('customToast')
    const customToast = new bootstrap.Toast(customToastEl.querySelector('.toast'))
    const toastBody = document.getElementById('toastBody')
    const toastEl = customToastEl.querySelector('.toast')

    function showToast(message, type = 'success') {
        toastBody.textContent = message
        
        // Remove old classes, add new
        toastEl.classList.remove('bg-success', 'bg-danger')
        if (type === 'danger') {
            toastEl.classList.add('bg-danger')
        } else {
            toastEl.classList.add('bg-success')
        }
        
        customToast.show()
    }
    
    // ----------------- Base64 Image Resizer -----------------
    // Converts a file to a base64 string, with resizing
    function fileToResizedBase64(file, options = {}) {
      return new Promise((resolve, reject) => {
        const { maxWidth = 800, maxHeight = 800, quality = 0.8 } = options;
        
        const reader = new FileReader();
        reader.onload = (e) => {
          const img = new Image();
          img.onload = () => {
            let width = img.width;
            let height = img.height;

            if (width > height) {
              if (width > maxWidth) {
                height = Math.round((height * maxWidth) / width);
                width = maxWidth;
              }
            } else {
              if (height > maxHeight) {
                width = Math.round((width * maxHeight) / height);
                height = maxHeight;
              }
            }

            const canvas = document.createElement('canvas');
            canvas.width = width;
            canvas.height = height;
            const ctx = canvas.getContext('2d');
            ctx.drawImage(img, 0, 0, width, height);
            
            // Get the data URL
            const dataUrl = canvas.toDataURL(file.type, quality);
            
            // Check file size (Firestore limit is 1MiB)
            // 1,048,576 bytes. Base64 is ~33% larger, so limit to ~750KB.
            if (dataUrl.length > 1048576 * 0.75) {
              reject(new Error(`Image is too large after compression (size ${dataUrl.length} bytes). Please use a smaller image.`));
            } else {
              resolve(dataUrl);
            }
          };
          img.onerror = reject;
          img.src = e.target.result;
        };
        reader.onerror = reject;
        reader.readAsDataURL(file);
      });
    }

    // ----------------- Render Dynamic Content -----------------

    // Render announcements in bar (Real-time)
    function renderAnnouncements(){
      const bar = document.getElementById('announcementContent');
      onSnapshot(collection(db, "announcements"), (snapshot) => {
        const anns = [];
        snapshot.forEach(doc => anns.push(doc.data()));
        
        if(anns.length === 0){ bar.textContent = '' ; return }
        const text = anns.map(a=>a.text).join('   •   ');
        bar.textContent = text + '   •   ' + text + '   •   ' + text; // Repeat for longer scroll
      });
    }

    // Render Logo (Real-time)
    function renderLogo() {
      const logoContainer = document.getElementById('navbarLogoContainer');
      const fallbackLogo = `
        <div class="fallback-logo">
          <span style="font-weight:700; color:var(--primary)">د</span>
        </div>`;
      
      onSnapshot(doc(db, "siteConfig", "logo"), (docSnap) => {
        if (docSnap.exists() && docSnap.data().logoData) {
          siteData.logo = docSnap.data().logoData;
          logoContainer.innerHTML = `<img src="${siteData.logo}" alt="Logo" id="navbarLogo" style="margin-inline-start:.6rem">`;
        } else {
          siteData.logo = null;
          logoContainer.innerHTML = fallbackLogo;
        }
      });
    }

    // Render Homepage (Hero)
    function renderHomepage() {
      document.getElementById('heroTitle').textContent = siteData.lang === 'ur' ? siteData.config.heroTitleUr : siteData.config.heroTitleEn;
      document.getElementById('heroSubtitle').textContent = siteData.lang === 'ur' ? siteData.config.heroSubtitleUr : siteData.config.heroSubtitleEn;
    }

    // Render About Us
    function renderAbout() {
      document.getElementById('aboutHeading').textContent = siteData.lang === 'ur' ? i18n.ur.adminAbout : i18n.en.adminAbout;
      document.getElementById('aboutText').textContent = siteData.lang === 'ur' ? siteData.config.aboutTextUr : siteData.config.aboutTextEn;
      document.getElementById('aboutImage').src = siteData.config.aboutImage;
    }
    
    // Render Donation Settings
    function renderDonationSettings() {
      const upiId = siteData.config.upiId || 'your-upi-id@ok';
      const upiLink = `upi://pay?pa=${upiId}&pn=Darut%20Taleem%20Wat%20Tarbiyah&am=&cu=INR&tn=Donation`;
      const qrUrl = `https://api.qrserver.com/v1/create-qr-code/?size=200x200&data=${encodeURIComponent(upiLink)}`;
      
      document.getElementById('donationQR').src = qrUrl;
      document.getElementById('payNowLink').href = upiLink;
      document.getElementById('upiIdInput').value = upiId;
    }
    
    // Render Fonts
    function renderFonts() {
      document.documentElement.style.setProperty('--font-ur', siteData.config.fontUr);
      document.documentElement.style.setProperty('--font-en', siteData.config.fontEn);
    }
    
    // Load and Render all Site Config data
    async function renderSiteConfig() {
      const docRef = doc(db, "siteConfig", "main");
      const docSnap = await getDoc(docRef);
      if (docSnap.exists()) {
        // Merge fetched config with defaults
        siteData.config = { ...siteData.config, ...docSnap.data() };
      }
      // Now render all components that depend on this config
      renderHomepage();
      renderAbout();
      renderDonationSettings();
      renderFonts();
      
      // Also apply language
      applyLanguage(siteData.lang);
    }

    // Render courses
    async function renderCourses(){
      const container = document.getElementById('coursesList');
      container.innerHTML = '<p>Loading courses...</p>';
      
      const snapshot = await getDocs(collection(db, "courses"));
      
      container.innerHTML = '';
      if (snapshot.empty) {
        container.innerHTML = '<p>No courses added yet.</p>';
        return;
      }
      
      snapshot.forEach(doc => {
        const c = doc.data();
        const col = document.createElement('div'); 
        col.className = 'col-md-6 col-lg-4';
        col.setAttribute('data-aos', 'fade-up'); // Add AOS tag
        col.innerHTML = `
          <div class="card card-course h-100">
            <div class="card-body">
              <h5 class="card-title">${siteData.lang === 'ur' ? c.titleUr : c.titleEn}</h5>
              <p class="card-text">${siteData.lang === 'ur' ? c.descUr : c.descEn}</p>
            </div>
            <div class="card-footer small text-muted">${c.duration || ''}</div>
          </div>
        `;
        container.appendChild(col);
      });
    }

    // Render events
    async function renderEvents(){
      const container = document.getElementById('eventsList');
      container.innerHTML = '<p>Loading events...</p>';
      
      const snapshot = await getDocs(collection(db, "events"));
      
      container.innerHTML = '';
      if (snapshot.empty) {
        container.innerHTML = '<p>No events scheduled.</p>';
        return;
      }
      
      const lang = siteData.lang;
      const months = lang === 'ur' 
        ? ["جنوری", "فروری", "مارچ", "اپریل", "مئی", "جون", "جولائی", "اگست", "ستمبر", "اکتوبر", "نومبر", "دسمبر"]
        : ["JAN", "FEB", "MAR", "APR", "MAY", "JUN", "JUL", "AUG", "SEP", "OCT", "NOV", "DEC"];

      snapshot.forEach(doc => {
        const event = doc.data();
        const eventDate = new Date(event.date);
        const day = eventDate.getDate();
        const month = months[eventDate.getMonth()];

        const col = document.createElement('div'); 
        col.className = 'col-md-6';
        col.setAttribute('data-aos', 'fade-up'); // Add AOS tag
        col.innerHTML = `
          <div class="event-card h-100">
            <div class="event-card-date">
              <span class="day">${day}</span>
              <span class="month">${month}</span>
            </div>
            <div class="event-card-body">
              <h5>${lang === 'ur' ? event.titleUr : event.titleEn}</h5>
              <p>${lang === 'ur' ? event.descUr : event.descEn}</p>
            </div>
          </div>
        `;
        container.appendChild(col);
      });
    }
    
    // Render Custom Sections
    async function renderCustomSections() {
      const container = document.getElementById('customSectionsContainer');
      container.innerHTML = '';
      
      const snapshot = await getDocs(collection(db, "customSections"));
      
      if (snapshot.empty) {
        return;
      }
      
      const lang = siteData.lang;
      snapshot.forEach(doc => {
        const section = doc.data();
        const sectionEl = document.createElement('section');
        sectionEl.className = 'mb-5';
        sectionEl.setAttribute('data-aos', 'fade-up'); // Add AOS tag
        
        // Image position logic
        const imgCol = `<div class="col-lg-6"><img src="${section.imageData}" alt="${lang === 'ur' ? section.titleUr : section.titleEn}" class="custom-section-img"></div>`;
        const textCol = `
          <div class="col-lg-6">
            <h3>${lang === 'ur' ? section.titleUr : section.titleEn}</h3>
            <p>${lang === 'ur' ? section.textUr : section.textEn}</p>
          </div>
        `;
        
        const rowContent = section.imagePosition === 'right' 
          ? `${textCol} ${imgCol}` 
          : `${imgCol} ${textCol}`;

        sectionEl.innerHTML = `
          <div class="section-title mb-3">
            <h2>${lang === 'ur' ? section.titleUr : section.titleEn}</h2>
          </div>
          <div classs="row gy-4 align-items-center">
            ${rowContent}
          </div>
        `;
        // This is a bug in the original code, classs="row" should be class="row"
        // Fixing it now:
        sectionEl.querySelector('[classs="row gy-4 align-items-center"]').setAttribute('class', 'row gy-4 align-items-center');
        
        container.appendChild(sectionEl);
      });
    }

    // Render gallery
    async function renderGallery(){
      const grid = document.getElementById('galleryGrid');
      grid.innerHTML = '<p>Loading gallery...</p>';
      
      const snapshot = await getDocs(collection(db, "gallery"));
      
      grid.innerHTML = '';
      if (snapshot.empty) {
        grid.innerHTML = '<p>No images in gallery yet.</p>';
        return;
      }

      snapshot.forEach(doc => {
        const img = doc.data();
        const imgEl = document.createElement('img');
        imgEl.src = img.imageData;
        imgEl.alt = img.name || 'Gallery';
        imgEl.setAttribute('data-aos', 'fade-up'); // Add AOS tag
        grid.appendChild(imgEl);
      });
    }

    // Contact form submission
    document.getElementById('contactForm').addEventListener('submit', async function(e){
      e.preventDefault();
      const name = document.getElementById('contactName').value.trim();
      const email = document.getElementById('contactEmail').value.trim();
      const subject = document.getElementById('contactSubject').value.trim();
      const message = document.getElementById('contactMessage').value.trim();
      
      try {
        await addDoc(collection(db, "messages"), {
          name, email, subject, message,
          created: new Date().toISOString()
        });
        this.reset();
        showToast('پیغام موصول ہوگیا — ہم جلد رابطہ کریں گے', 'success');
      } catch (error) {
        console.error("Error adding message: ", error);
        showToast('Error sending message. Please try again.', 'danger');
      }
    });

    // ----------------- Donation Form Logic -----------------
    const donationTypeSelect = document.getElementById('donationType');
    const otherDonationTypeContainer = document.getElementById('otherDonationTypeContainer');
    
    donationTypeSelect.addEventListener('change', function() {
      otherDonationTypeContainer.style.display = (this.value === 'Other') ? 'block' : 'none';
    });
    
    document.getElementById('donationForm').addEventListener('submit', async function(e) {
      e.preventDefault();
      
      let donationType = donationTypeSelect.value;
      if (donationType === 'Other') {
        donationType = document.getElementById('otherDonationType').value.trim() || 'Other';
      }

      const donation = {
        amount: document.getElementById('donationAmount').value,
        type: donationType,
        name: document.getElementById('donationName').value.trim(),
        phone: document.getElementById('donationPhone').value.trim(),
        address: document.getElementById('donationAddress').value.trim(),
        email: document.getElementById('donationEmail').value.trim(),
        docId: document.getElementById('donationDocId').value.trim(),
        created: new Date().toISOString()
      };
      
      try {
        // Save donation request
        await addDoc(collection(db, "donations"), donation);
        
        // Show payment info
        document.getElementById('donationPaymentInfo').style.display = 'block';
        showToast('Form submitted. Please complete the payment.', 'success');
        
      } catch (error) {
        console.error("Error saving donation: ", error);
        showToast('Error saving submission. Please try again.', 'danger');
      }
    });
    
    // Copy UPI button
    document.getElementById('copyUpiButton').addEventListener('click', function() {
      const upiInput = document.getElementById('upiIdInput');
      try {
        upiInput.select();
        upiInput.setSelectionRange(0, 99999); // For mobile
        document.execCommand('copy');
        
        const lang = siteData.lang;
        showToast(i18n[lang].copiedToast, 'success');

      } catch (err) {
        console.error('Failed to copy UPI ID: ', err);
        showToast('Failed to copy', 'danger');
      }
    });

    // ----------------- Admin interactions -----------------
    const adminModalEl = document.getElementById('adminModal');
    const adminModal = new bootstrap.Modal(adminModalEl);
    const adminButton = document.getElementById('openAdmin');
    
    adminButton.addEventListener('click',(e)=>{ 
      e.preventDefault();
      adminModal.show();
    });
    
    // Fix modal focus bug (aria-hidden warning)
    adminModalEl.addEventListener('hidden.bs.modal', () => {
      adminButton.focus();
    });

    // Admin Login
    document.getElementById('adminLoginForm').addEventListener('submit', async function(e){
      e.preventDefault();
      const email = document.getElementById('adminUser').value;
      const pass = document.getElementById('adminPass').value;
      
      try {
        await signInWithEmailAndPassword(auth, email, pass);
        // On success, onAuthStateChanged will handle panel switching
        showToast('Login successful!', 'success');
      } catch (error) {
        console.error("Login failed:", error.message);
        showToast(error.message, 'danger');
      }
    });

    // Admin Logout
    document.getElementById('adminLogout').addEventListener('click', ()=>{
      signOut(auth);
      showToast('Logged out.', 'success');
    });

    // Auth state brain
    onAuthStateChanged(auth, user => {
      if (user) {
        // User is LOGGED IN
        document.getElementById('adminLoginView').style.display = 'none';
        document.getElementById('adminPanelView').style.display = 'block';
        loadAdminPanel('ann'); // Load default panel
      } else {
        // User is LOGGED OUT
        document.getElementById('adminLoginView').style.display = 'block';
        document.getElementById('adminPanelView').style.display = 'none';
      }
    });

    // Panel nav buttons
    document.querySelectorAll('[data-panel]').forEach(btn=> btn.addEventListener('click', ()=> loadAdminPanel(btn.dataset.panel) ))
    
    // Main Admin Panel Loader
    async function loadAdminPanel(panel){
      const content = document.getElementById('panelContent');
      content.innerHTML = `<h5>Loading ${panel}...</h5>`;
      
      // Update active button state
      document.querySelectorAll('[data-panel]').forEach(b => {
        b.classList.toggle('active', b.dataset.panel === panel)
      });

      // --- Announcements Panel ---
      if(panel === 'ann'){
        const snapshot = await getDocs(collection(db, "announcements"));
        let listHtml = '';
        snapshot.forEach(snapshotDoc => { // Renamed doc to snapshotDoc
          const a = snapshotDoc.data();
          listHtml += `
            <div class="card mb-2 p-2">
              <div class="d-flex justify-content-between align-items-center">
                <div>${a.text}</div>
                <div><button class="btn btn-sm btn-danger" data-id="${snapshotDoc.id}">Delete</button></div>
              </div>
            </div>
          `;
        });
        
        content.innerHTML = `
          <h5>Announcements</h5>
          <form id="annForm" class="mb-3">
            <div class="mb-2"><textarea id="annText" class="form-control" rows="2" placeholder="Add announcement in Urdu or English"></textarea></div>
            <button class="btn btn-success btn-sm">Add</button>
          </form>
          <div id="annsList">${listHtml}</div>
        `;
        
        document.getElementById('annForm').addEventListener('submit', async function(e){
          e.preventDefault(); 
          const text = document.getElementById('annText').value.trim(); 
          if(!text) return;
          try {
            await addDoc(collection(db, "announcements"), { text });
            showToast('Announcement added!', 'success');
            loadAdminPanel('ann');
          } catch(err) { showToast(err.message, 'danger'); }
        });
        
        document.getElementById('annsList').addEventListener('click', async (e) => {
          if (e.target.dataset.id) {
            if (!confirm('Are you sure you want to delete this?')) return;
            try {
              await deleteDoc(doc(db, "announcements", e.target.dataset.id)); // doc() is available
              showToast('Deleted!', 'success');
              loadAdminPanel('ann');
            } catch(err) { showToast(err.message, 'danger'); }
          }
        });
      }

      // --- Homepage (Hero) Panel ---
      if(panel === 'hero'){
        content.innerHTML = `
          <h5>Homepage (Hero)</h5>
          <form id="heroForm">
            <div class="mb-3">
              <label class="form-label">Hero Title (Urdu)</label>
              <input type="text" id="heroTitleUr" class="form-control" value="${siteData.config.heroTitleUr}">
            </div>
            <div class="mb-3">
              <label class="form-label">Hero Title (English)</label>
              <input type="text" id="heroTitleEn" class="form-control" value="${siteData.config.heroTitleEn}">
            </div>
            <div class="mb-3">
              <label class="form-label">Hero Subtitle (Urdu)</label>
              <input type="text" id="heroSubtitleUr" class="form-control" value="${siteData.config.heroSubtitleUr}">
            </div>
            <div class="mb-3">
              <label class="form-label">Hero Subtitle (English)</label>
              <input type="text" id="heroSubtitleEn" class="form-control" value="${siteData.config.heroSubtitleEn}">
            </div>
            <button class="btn btn-primary">Save Settings</button>
          </form>
        `;
        
        document.getElementById('heroForm').addEventListener('submit', async (e) => {
          e.preventDefault();
          const newConfig = {
            heroTitleUr: document.getElementById('heroTitleUr').value,
            heroTitleEn: document.getElementById('heroTitleEn').value,
            heroSubtitleUr: document.getElementById('heroSubtitleUr').value,
            heroSubtitleEn: document.getElementById('heroSubtitleEn').value
          };
          try {
            await setDoc(doc(db, "siteConfig", "main"), newConfig, { merge: true });
            // Update local state and re-render
            siteData.config = { ...siteData.config, ...newConfig };
            renderHomepage();
            showToast('Homepage updated!', 'success');
          } catch(err) { showToast(err.message, 'danger'); }
        });
      }
      
      // --- About Us Panel ---
      if(panel === 'about'){
        content.innerHTML = `
          <h5>About Us</h5>
          <form id="aboutForm">
            <div class="mb-3">
              <label class="form-label">About Text (Urdu)</label>
              <textarea id="aboutTextUr" class="form-control" rows="4">${siteData.config.aboutTextUr}</textarea>
            </div>
            <div class="mb-3">
              <label class="form-label">About Text (English)</label>
              <textarea id="aboutTextEn" class="form-control" rows="4">${siteData.config.aboutTextEn}</textarea>
            </div>
            <div class="mb-3">
              <label class="form-label">About Image</label>
              <input type="file" id="aboutImageFile" class="form-control" accept="image/png, image/jpeg, image/webp">
              <small>Upload new image, or leave blank to keep current one.</small>
              <img src="${siteData.config.aboutImage}" class="admin-preview-img" id="aboutImgPreview">
            </div>
            <button class="btn btn-primary">Save Settings</button>
          </form>
        `;
        
        document.getElementById('aboutForm').addEventListener('submit', async (e) => {
          e.preventDefault();
          
          let newImageData = siteData.config.aboutImage;
          const file = document.getElementById('aboutImageFile').files[0];
          
          try {
            if (file) {
              showToast('Compressing image...', 'success');
              newImageData = await fileToResizedBase64(file, { maxWidth: 1024, maxHeight: 1024 });
            }
            
            const newConfig = {
              aboutTextUr: document.getElementById('aboutTextUr').value,
              aboutTextEn: document.getElementById('aboutTextEn').value,
              aboutImage: newImageData
            };
            
            await setDoc(doc(db, "siteConfig", "main"), newConfig, { merge: true });
            // Update local state and re-render
            siteData.config = { ...siteData.config, ...newConfig };
            renderAbout();
            document.getElementById('aboutImgPreview').src = newImageData;
            showToast('About Us updated!', 'success');
            
          } catch(err) { showToast(err.message, 'danger'); }
        });
      }

      // --- Courses Panel ---
      if(panel === 'courses'){
        const snapshot = await getDocs(collection(db, "courses"));
        let listHtml = '';
        snapshot.forEach(snapshotDoc => {
          const c = snapshotDoc.data();
          listHtml += `
            <div class="card mb-2 p-2">
              <div class="d-flex justify-content-between align-items-start">
                <div><strong>${c.titleUr || c.titleEn}</strong><div class="small text-muted">${c.duration || ''}</div></div>
                <div><button class="btn btn-sm btn-danger" data-id="${snapshotDoc.id}">Delete</button></div>
              </div>
            </div>`;
        });
        
        content.innerHTML = `
          <h5>Courses</h5>
          <form id="courseForm" class="mb-3">
            <div class="row g-2">
              <div class="col-md-6"><input id="courseTitleUr" class="form-control" placeholder="Title (Urdu)"></div>
              <div class="col-md-6"><input id="courseTitleEn" class="form-control" placeholder="Title (English)"></div>
            </div>
            <div class="row g-2 mt-2">
              <div class="col-md-6"><input id="courseDuration" class="form-control" placeholder="Duration"></div>
              <div class="col-md-6"><input id="courseDescEn" class="form-control" placeholder="Short description (English)"></div>
            </div>
            <div class="mt-2"><textarea id="courseDescUr" class="form-control" placeholder="Short description (Urdu)"></textarea></div>
            <div class="mt-2"><button class="btn btn-success btn-sm">Add Course</button></div>
          </form>
          <div id="coursesListAdmin">${listHtml}</div>
        `;
        
        document.getElementById('courseForm').addEventListener('submit', async function(e){
          e.preventDefault();
          const course = {
            titleUr: document.getElementById('courseTitleUr').value || '',
            titleEn: document.getElementById('courseTitleEn').value || '',
            descUr: document.getElementById('courseDescUr').value || '',
            descEn: document.getElementById('courseDescEn').value || '',
            duration: document.getElementById('courseDuration').value || ''
          };
          try {
            await addDoc(collection(db, "courses"), course);
            showToast('Course added!', 'success');
            renderCourses();
            loadAdminPanel('courses');
          } catch(err) { showToast(err.message, 'danger'); }
        });

        document.getElementById('coursesListAdmin').addEventListener('click', async (e) => {
          if (e.target.dataset.id) {
            if (!confirm('Are you sure you want to delete this?')) return;
            try {
              await deleteDoc(doc(db, "courses", e.target.dataset.id));
              showToast('Deleted!', 'success');
              renderCourses();
              loadAdminPanel('courses');
            } catch(err) { showToast(err.message, 'danger'); }
          }
        });
      }

      // --- Events Panel ---
      if(panel === 'events'){
        const snapshot = await getDocs(collection(db, "events"));
        let listHtml = '';
        snapshot.forEach(snapshotDoc => {
          const e = snapshotDoc.data();
          listHtml += `
            <div class="card mb-2 p-2">
              <div class="d-flex justify-content-between align-items-start">
                <div><strong>${e.titleUr || e.titleEn}</strong><div class="small text-muted">${e.date}</div></div>
                <div><button class="btn btn-sm btn-danger" data-id="${snapshotDoc.id}">Delete</button></div>
              </div>
            </div>`;
        });

        content.innerHTML = `
          <h5>Events</h5>
          <form id="eventForm" class="mb-3">
            <div class="row g-2">
              <div class="col-md-6"><input id="eventTitleUr" class="form-control" placeholder="Event Title (Urdu)" required></div>
              <div class="col-md-6"><input id="eventTitleEn" class="form-control" placeholder="Event Title (English)"></div>
            </div>
            <div class="row g-2 mt-2">
              <div class="col-md-6"><input id="eventDate" type="date" class="form-control" required></div>
            </div>
            <div class="mt-2"><textarea id="eventDescUr" class="form-control" placeholder="Short description (Urdu)"></textarea></div>
            <div class="mt-2"><textarea id="eventDescEn" class="form-control" placeholder="Short description (English)"></textarea></div>
            <div class="mt-2"><button class="btn btn-success btn-sm">Add Event</button></div>
          </form>
          <div id="eventsListAdmin">${listHtml}</div>
        `;
        
        document.getElementById('eventForm').addEventListener('submit', async function(e){
          e.preventDefault();
          const event = {
            titleUr: document.getElementById('eventTitleUr').value || '',
            titleEn: document.getElementById('eventTitleEn').value || '',
            descUr: document.getElementById('eventDescUr').value || '',
            descEn: document.getElementById('eventDescEn').value || '',
            date: document.getElementById('eventDate').value
          };
          try {
            await addDoc(collection(db, "events"), event);
            showToast('Event added!', 'success');
            renderEvents();
            loadAdminPanel('events');
          } catch(err) { showToast(err.message, 'danger'); }
        });
        
        document.getElementById('eventsListAdmin').addEventListener('click', async (e) => {
          if (e.target.dataset.id) {
            if (!confirm('Are you sure you want to delete this?')) return;
            try {
              await deleteDoc(doc(db, "events", e.target.dataset.id));
              showToast('Event deleted!', 'success');
              renderEvents();
              loadAdminPanel('events');
            } catch(err) { showToast(err.message, 'danger'); }
          }
        });
      }
      
      // --- Custom Sections Panel ---
      if (panel === 'customSections') {
        const snapshot = await getDocs(collection(db, "customSections"));
        let listHtml = '';
        snapshot.forEach(snapshotDoc => {
          const s = snapshotDoc.data();
          listHtml += `
            <div class="card mb-2 p-2">
              <div class="d-flex justify-content-between align-items-start">
                <div>
                  <strong>${s.titleUr || s.titleEn}</strong>
                  <img src="${s.imageData}" style="width: 50px; height: 50px; object-fit: cover; margin-left: 10px;">
                </div>
                <div><button class="btn btn-sm btn-danger" data-id="${snapshotDoc.id}">Delete</button></div>
              </div>
            </div>`;
        });

        content.innerHTML = `
          <h5>Custom Homepage Sections</h5>
          <form id="customSectionForm" class="mb-3">
            <div class="row g-2">
              <div class="col-md-6"><input id="csTitleUr" class="form-control" placeholder="Title (Urdu)" required></div>
              <div class="col-md-6"><input id="csTitleEn" class="form-control" placeholder="Title (English)"></div>
            </div>
            <div class="mt-2"><textarea id="csTextUr" class="form-control" placeholder="Text (Urdu)"></textarea></div>
            <div class="mt-2"><textarea id="csTextEn" class="form-control" placeholder="Text (English)"></textarea></div>
            <div class="row g-2 mt-2">
              <div class="col-md-6">
                <label class="form-label">Image</label>
                <input type="file" id="csFile" class="form-control" accept="image/png, image/jpeg, image/webp" required>
                <small>Image will be resized to ~800px width.</small>
              </div>
              <div class="col-md-6">
                <label class="form-label">Image Position</label>
                <select id="csImgPos" class="form-select">
                  <option value="left" selected>Left</option>
                  <option value="right">Right</option>
                </select>
              </div>
            </div>
            <div class="mt-2"><button class="btn btn-success btn-sm">Add Section</button></div>
          </form>
          <div id="customSectionsListAdmin">${listHtml}</div>
        `;

        document.getElementById('customSectionForm').addEventListener('submit', async function(e){
          e.preventDefault();
          const file = document.getElementById('csFile').files[0];
          if (!file) {
            showToast('Please select an image.', 'danger');
            return;
          }
          
          try {
            showToast('Uploading image...', 'success');
            const imageData = await fileToResizedBase64(file, { maxWidth: 800 });
            
            const section = {
              titleUr: document.getElementById('csTitleUr').value || '',
              titleEn: document.getElementById('csTitleEn').value || '',
              textUr: document.getElementById('csTextUr').value || '',
              textEn: document.getElementById('csTextEn').value || '',
              imagePosition: document.getElementById('csImgPos').value,
              imageData: imageData
            };
            
            await addDoc(collection(db, "customSections"), section);
            showToast('Section added!', 'success');
            renderCustomSections();
            loadAdminPanel('customSections');
            
          } catch(err) { showToast(err.message, 'danger'); }
        });

        document.getElementById('customSectionsListAdmin').addEventListener('click', async (e) => {
          if (e.target.dataset.id) {
            if (!confirm('Are you sure you want to delete this?')) return;
            try {
              await deleteDoc(doc(db, "customSections", e.target.dataset.id));
              showToast('Section deleted!', 'success');
              renderCustomSections();
              loadAdminPanel('customSections');
            } catch(err) { showToast(err.message, 'danger'); }
          }
        });
      }

      // --- Gallery Panel ---
      if(panel === 'gallery'){
        const snapshot = await getDocs(collection(db, "gallery"));
        let listHtml = '';
        snapshot.forEach(snapshotDoc => {
          const g = snapshotDoc.data();
          listHtml += `
            <div class="d-inline-block text-center me-2 mb-2">
              <img src="${g.imageData}" style="width:100px; height:100px; object-fit:cover; border-radius:6px">
              <button class="btn btn-sm btn-danger mt-1" data-id="${snapshotDoc.id}">Delete</button>
            </div>`;
        });
        
        content.innerHTML = `
          <h5>Gallery</h5>
          <form id="galleryForm" class="mb-3">
            <div class="mb-2"><input id="galleryFile" type="file" accept="image/*" class="form-control" required></div>
            <div class="mb-2"><input id="galleryName" class="form-control" placeholder="Image name (optional)"></div>
            <small>Note: Images will be compressed and resized to 800x800. Please use JPG/PNG files under 750KB.</small>
            <div class="mt-2"><button class="btn btn-success btn-sm">Upload</button></div>
          </form>
          <div id="galleryAdminList">${listHtml}</div>
        `;
        
        document.getElementById('galleryForm').addEventListener('submit', async function(e){
          e.preventDefault(); 
          const file = document.getElementById('galleryFile').files[0];
          if(!file){ return }
          
          try {
            showToast('Uploading image...', 'success');
            const imageData = await fileToResizedBase64(file, { maxWidth: 800, maxHeight: 800 });
            const name = document.getElementById('galleryName').value || file.name;
            
            await addDoc(collection(db, "gallery"), { imageData, name });
            
            showToast('Image added!', 'success');
            renderGallery();
            loadAdminPanel('gallery');
            
          } catch(err) { showToast(err.message, 'danger'); }
        });
        
        document.getElementById('galleryAdminList').addEventListener('click', async (e) => {
          if (e.target.dataset.id) {
            if (!confirm('Are you sure you want to delete this?')) return;
            try {
              await deleteDoc(doc(db, "gallery", e.target.dataset.id));
              showToast('Image deleted!', 'success');
              renderGallery();
              loadAdminPanel('gallery');
            } catch(err) { showToast(err.message, 'danger'); }
          }
        });
      }

      // --- Logo Panel ---
      if(panel === 'logo'){
        content.innerHTML = `
          <h5 id="adminLogoTitle">Logo</h5>
          <p>Upload a logo to replace the default initial in the navbar. Use a PNG with a transparent background.</p>
          <div class="mb-3">
            <label class="form-label">Current Logo</label>
            <div>
              ${siteData.logo ? `<img src="${siteData.logo}" id="adminLogoPreview" alt="Logo">` : '<span class="text-muted">No logo uploaded</span>'}
            </div>
          </div>
          <form id="logoForm" class="mb-3">
            <div class="mb-2">
              <input id="logoFile" type="file" accept="image/png, image/jpeg, image/svg+xml, image/webp" class="form-control">
              <small>Logo will be resized to 100px height.</small>
            </div>
            <button class="btn btn-success btn-sm">Save Logo</button>
          </form>
          <button class="btn btn-outline-danger btn-sm" id="removeLogoButton" ${!siteData.logo ? 'disabled' : ''}>Remove Logo</button>
        `;

        document.getElementById('logoForm').addEventListener('submit', async function(e){
          e.preventDefault();
          const file = document.getElementById('logoFile').files[0];
          if(!file) { return }
          
          try {
            showToast('Uploading logo...', 'success');
            const logoData = await fileToResizedBase64(file, { maxHeight: 100 });
            
            await setDoc(doc(db, "siteConfig", "logo"), { logoData });
            
            showToast('Logo updated!', 'success');
            // renderLogo() is called by onSnapshot, so it updates automatically
            loadAdminPanel('logo');
            
          } catch(err) { showToast(err.message, 'danger'); }
        });

        document.getElementById('removeLogoButton').addEventListener('click', async function(){
          if (!confirm('Are you sure you want to remove the logo?')) return;
          try {
            await deleteDoc(doc(db, "siteConfig", "logo"));
            showToast('Logo removed', 'success');
            // renderLogo() is called by onSnapshot, so it updates automatically
            loadAdminPanel('logo');
          } catch(err) { showToast(err.message, 'danger'); }
        });
      }
      
      // --- Donation Settings Panel ---
      if (panel === 'donation') {
        content.innerHTML = `
          <h5>Donation Settings</h5>
          <form id="donationSettingsForm">
            <div class="mb-3">
              <label class="form-label">UPI ID</label>
              <input type="text" id="upiId" class="form-control" value="${siteData.config.upiId}">
              <small>Example: 123456789@okaxis</small>
            </div>
            <button class="btn btn-primary">Save Settings</button>
          </form>
        `;
        
        document.getElementById('donationSettingsForm').addEventListener('submit', async (e) => {
          e.preventDefault();
          const newConfig = {
            upiId: document.getElementById('upiId').value
          };
          try {
            await setDoc(doc(db, "siteConfig", "main"), newConfig, { merge: true });
            // Update local state and re-render
            siteData.config = { ...siteData.config, ...newConfig };
            renderDonationSettings();
            showToast('Donation settings updated!', 'success');
          } catch(err) { showToast(err.message, 'danger'); }
        });
      }
      
      // --- Font Settings Panel ---
      if (panel === 'fonts') {
        let urOptionsHtml = fontOptions.ur.map(font => 
          `<option value="${font.value}" ${siteData.config.fontUr === font.value ? 'selected' : ''}>${font.name}</option>`
        ).join('');
        
        let enOptionsHtml = fontOptions.en.map(font => 
          `<option value="${font.value}" ${siteData.config.fontEn === font.value ? 'selected' : ''}>${font.name}</option>`
        ).join('');

        content.innerHTML = `
          <h5>Font Settings</h5>
          <form id="fontSettingsForm">
            <div class="mb-3">
              <label class="form-label">Urdu Font</label>
              <select id="fontUrSelect" class="form-select">${urOptionsHtml}</select>
            </div>
            <div class="mb-3">
              <label class="form-label">English Font</label>
              <select id="fontEnSelect" class="form-select">${enOptionsHtml}</select>
            </div>
            <button class="btn btn-primary">Save Settings</button>
          </form>
        `;
        
        document.getElementById('fontSettingsForm').addEventListener('submit', async (e) => {
          e.preventDefault();
          const newConfig = {
            fontUr: document.getElementById('fontUrSelect').value,
            fontEn: document.getElementById('fontEnSelect').value
          };
          try {
            await setDoc(doc(db, "siteConfig", "main"), newConfig, { merge: true });
            // Update local state and re-render
            siteData.config = { ...siteData.config, ...newConfig };
            renderFonts();
            showToast('Font settings updated!', 'success');
          } catch(err) { showToast(err.message, 'danger'); }
        });
      }

      // --- Messages Panel ---
      if(panel === 'messages'){
        const snapshot = await getDocs(collection(db, "messages"));
        let listHtml = '';
        snapshot.forEach(doc => {
          const m = doc.data();
          listHtml += `
            <div class="card mb-2 p-2">
              <div>
                <strong>${m.name} — ${m.email}</strong>
                <div class="small text-muted">${new Date(m.created).toLocaleString()}</div>
                <p class="mb-1 mt-1"><strong>Subject:</strong> ${m.subject || 'N/A'}</p>
                <p>${m.message}</p>
              </div>
            </div>`;
        });
        
        content.innerHTML = `
          <h5>Messages</h5>
          <small>These are messages from your contact form.</small>
          <div id="msgsList" class="mt-3">${listHtml}</div>
        `;
      }
      
      // --- Donations Panel ---
      if(panel === 'donations'){
        const snapshot = await getDocs(collection(db, "donations"));
        let listHtml = '';
        snapshot.forEach(doc => {
          const d = doc.data();
          listHtml += `
            <div class="card mb-2 p-2">
              <div class="d-flex justify-content-between">
                <strong>${d.name} (₹${d.amount})</strong>
                <span class="badge bg-primary">${d.type}</span>
              </div>
              <div class="small text-muted">${new Date(d.created).toLocaleString()}</div>
              <p class="mb-1 mt-2">
                <strong>Phone:</strong> ${d.phone}<br>
                <strong>Email:</strong> ${d.email}<br>
                <strong>Address:</strong> ${d.address}<br>
                <strong>Doc ID:</strong> ${d.docId}
              </p>
            </div>`;
        });
        
        content.innerHTML = `
          <h5 id="adminDonationsTitle">Donations</h5>
          <small>These are donation form submissions.</small>
          <div id="donationsList" class="mt-3">${listHtml}</div>
        `;
      }
    }

    // ----------------- Language switching -----------------
    const langSelect = document.getElementById('langToggle')
    
    function applyLanguage(lang){
      siteData.lang = lang; // Store current language
      const root = document.documentElement
      if(lang === 'ur'){
        root.lang = 'ur'; root.dir = 'rtl'
      } else {  
        root.lang = 'en'; root.dir = 'ltr'  
      }

      // apply texts
      const t = i18n[lang]
      
      // Navbar
      document.getElementById('brandTitle').textContent = t.brandTitle
      document.getElementById('brandSubtitle').textContent = t.brandSubtitle
      document.getElementById('navHome').textContent = t.navHome
      document.getElementById('navAbout').textContent = t.navAbout
      document.getElementById('navCourses').textContent = t.navCourses
      document.getElementById('navEvents').textContent = t.navEvents
      document.getElementById('navGallery').textContent = t.navGallery
      document.getElementById('navLibrary').textContent = t.navLibrary
      document.getElementById('navDonation').textContent = t.navDonation
      document.getElementById('navContact').textContent = t.navContact
      document.getElementById('navAdminText').textContent = t.navAdmin; // Updated admin text
      
      // Hero (Dynamic)
      renderHomepage();
      document.getElementById('heroBtn1').textContent = t.heroBtn1;
      document.getElementById('heroBtn2').textContent = t.heroBtn2;

      // Quick Links
      document.getElementById('qLinkDonation').textContent = t.qLinkDonation
      document.getElementById('qLinkFatwa').textContent = t.qLinkFatwa
      document.getElementById('qLinkBooks').textContent = t.qLinkBooks
      document.getElementById('qLinkGallery').textContent = t.qLinkGallery

      // Dynamic Content
      renderAbout(); // Renders About Us text in correct language
      renderSiteConfig(); // Re-applies all config
      
      // Static Content
      document.getElementById('coursesHeading').textContent = t.coursesHeading
      document.getElementById('eventsHeading').textContent = t.eventsHeading
      document.getElementById('galleryHeading').textContent = t.galleryHeading
      
      // Library Section
      document.getElementById('libraryHeading').textContent = t.libraryHeading
      document.getElementById('libraryCardTitle').textContent = t.libraryCardTitle
      document.getElementById('libraryCardText').textContent = t.libraryCardText
      document.getElementById('libraryCardButton').textContent = t.libraryCardButton

      // Donation Section
      document.getElementById('donationHeading').textContent = t.donationHeading
      document.getElementById('lblDonationAmount').textContent = t.lblDonationAmount
      document.getElementById('lblDonationType').textContent = t.lblDonationType
      document.getElementById('optDonationGeneral').textContent = t.optDonationGeneral
      document.getElementById('optDonationZakat').textContent = t.optDonationZakat
      document.getElementById('optDonationSadqa').textContent = t.optDonationSadqa
      document.getElementById('optDonationConstruction').textContent = t.optDonationConstruction
      document.getElementById('optDonationOther').textContent = t.optDonationOther
      document.getElementById('lblOtherDonationType').textContent = t.lblOtherDonationType
      document.getElementById('lblDonationName').textContent = t.lblDonationName
      document.getElementById('lblDonationPhone').textContent = t.lblDonationPhone
      document.getElementById('lblDonationAddress').textContent = t.lblDonationAddress
      document.getElementById('lblDonationEmail').textContent = t.lblDonationEmail
      document.getElementById('lblDonationDocId').textContent = t.lblDonationDocId
      document.getElementById('donationSubmit').textContent = t.donationSubmit
      document.getElementById('donationPaymentTitle').textContent = t.donationPaymentTitle
      document.getElementById('donationPaymentSubtitle').textContent = t.donationPaymentSubtitle
      document.getElementById('copyUpiBtnText').textContent = t.copyUpiBtnText
      document.getElementById('payNowBtnText').textContent = t.payNowBtnText

      // Contact
      document.getElementById('contactHeading').textContent = t.contactHeading
      document.getElementById('lblName').textContent = t.lblName
      document.getElementById('lblEmail').textContent = t.lblEmail
      document.getElementById('lblSubject').textContent = t.lblSubject
      document.getElementById('lblMessage').textContent = t.lblMessage
      document.getElementById('contactSubmit').textContent = t.contactSubmit
      document.getElementById('contactInfoHeading').textContent = t.contactInfoHeading
      
      document.getElementById('lblAddress').textContent = t.lblAddress
      document.getElementById('lblPhone').textContent = t.lblPhone
      document.getElementById('lblContactEmail').textContent = t.lblContactEmail
      document.getElementById('lblMap').textContent = t.lblMap
      document.getElementById('linkMap').textContent = t.linkMap
      document.getElementById('contactFormNote').textContent = t.contactFormNote

      // Admin panel
      document.getElementById('adminNavDonations').textContent = t.adminDonations;
      document.querySelector('[data-panel="logo"]').textContent = t.adminLogo;
      document.querySelector('[data-panel="hero"]').textContent = t.adminHomepage;
      document.querySelector('[data-panel="about"]').textContent = t.adminAbout;
      document.querySelector('[data-panel="donation"]').textContent = t.adminDonationSettings;
      document.querySelector('[data-panel="events"]').textContent = t.adminEvents;
      document.querySelector('[data-panel="customSections"]').textContent = t.adminCustomSections;
      document.querySelector('[data-panel="fonts"]').textContent = t.adminFontSettings;
      document.getElementById('lblAdminEmail').textContent = t.lblAdminEmail;
      document.getElementById('lblAdminPass').textContent = t.lblAdminPass;
      
      // Re-render dynamic lists with new language
      renderCourses();
      renderEvents();
      renderCustomSections();
    }

    // default language = Urdu
    langSelect.addEventListener('change', ()=> applyLanguage(langSelect.value))
    applyLanguage('ur')

    // Smooth scroll for nav links
    document.querySelectorAll('[data-link]').forEach(a=> a.addEventListener('click', function(e){ e.preventDefault(); const id = this.getAttribute('href').slice(1); document.getElementById(id).scrollIntoView({behavior:'smooth'}) }))

    // ----------------- Dark Mode Toggle -----------------
    const darkModeToggle = document.getElementById('darkModeToggle');
    const sunIcon = darkModeToggle.querySelector('.bi-sun-fill');
    const moonIcon = darkModeToggle.querySelector('.bi-moon-fill');
    const prefersDark = window.matchMedia('(prefers-color-scheme: dark)');
    const currentTheme = localStorage.getItem('theme');

    function setDarkMode(isDark) {
      if (isDark) {
        document.body.classList.add('dark-mode');
        sunIcon.style.display = 'inline-block';
        moonIcon.style.display = 'none';
        localStorage.setItem('theme', 'dark');
      } else {
        document.body.classList.remove('dark-mode');
        sunIcon.style.display = 'none';
        moonIcon.style.display = 'inline-block';
        localStorage.setItem('theme', 'light');
      }
    }

    // Initialize theme
    if (currentTheme === 'dark') {
      setDarkMode(true);
    } else if (currentTheme === 'light') {
      setDarkMode(false);
    } else {
      // No preference saved, use system preference
      setDarkMode(prefersDark.matches);
    }

    // Listen for toggle click
    darkModeToggle.addEventListener('click', () => {
      setDarkMode(!document.body.classList.contains('dark-mode'));
    });

    // Listen for system changes
    prefersDark.addEventListener('change', (e) => {
      // Only apply if no theme is manually set
      if (!localStorage.getItem('theme')) {
        setDarkMode(e.matches);
      }
    });

    // ----------------- Initial Data Load -----------------
    // Load all data from Firestore and render the page
    function loadAllData() {
      renderSiteConfig(); // This also calls renderHomepage, renderAbout, etc.
      renderAnnouncements();
      renderLogo();
      renderCourses();
      renderEvents();
      renderCustomSections();
      renderGallery();
      
      // Initialize animations AFTER data has started loading
      AOS.init({
        duration: 800,
        once: true,
        offset: 50,
      });
    }
    
    loadAllData();

  </script>
</body>
</html>
