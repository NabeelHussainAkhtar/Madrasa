<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Bites n' More</title>
    <!-- Tailwind CSS -->
    <script src="https://cdn.tailwindcss.com"></script>
    <!-- Google Fonts - Inter for text, Pacifico for logo -->
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;600;700&family=Pacifico&display=swap"
        rel="stylesheet">
    <!-- Font Awesome for icons -->
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <!-- Google Sign-In Library -->
    <script src="https://accounts.google.com/gsi/client" async defer></script>
    <style>
        /* Custom styles for the app */
        body {
            font-family: 'Inter', sans-serif;
            background-color: #f7f7f7;
            scroll-behavior: smooth;
        }

        .logo-font {
            font-family: 'Pacifico', cursive;
        }

        .hero-bg {
            background-image: linear-gradient(rgba(0, 0, 0, 0.6), rgba(0, 0, 0, 0.6)), url('https://images.unsplash.com/photo-1550547660-d9450f859349?q=80&w=2787&auto=format&fit=crop');
            background-size: cover;
            background-position: center;
        }

        .menu-card-image {
            height: 200px;
            object-fit: cover;
        }

        .review-image {
            aspect-ratio: 1 / 1;
            object-fit: cover;
        }

        /* Utility classes for login/admin pages */
        .page-container {
            min-height: calc(100vh - 8rem);
        }

        .menu-category-btn.active {
            @apply bg-red-600 text-white;
        }

        .login-popup {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background-color: rgba(0, 0, 0, 0.5);
            display: flex;
            align-items: center;
            justify-content: center;
            z-index: 200;
        }
        
        /* CSS for the new login/signup component */
        @import url('https://fonts.googleapis.com/css?family=Montserrat:400,800');

        #login-container * {
            box-sizing: border-box;
        }

        #login-container h1 {
            font-weight: bold;
            margin: 0;
        }

        #login-container h2 {
            text-align: center;
        }

        #login-container p {
            font-size: 14px;
            font-weight: 100;
            line-height: 20px;
            letter-spacing: 0.5px;
            margin: 20px 0 30px;
        }

        #login-container span {
            font-size: 12px;
        }

        #login-container a {
            color: #333;
            font-size: 14px;
            text-decoration: none;
            margin: 15px 0;
        }

        #login-container button {
            border-radius: 20px;
            border: 1px solid #FF4B2B;
            background-color: #FF4B2B;
            color: #FFFFFF;
            font-size: 12px;
            font-weight: bold;
            padding: 12px 45px;
            letter-spacing: 1px;
            text-transform: uppercase;
            transition: transform 80ms ease-in;
        }

        #login-container button:active {
            transform: scale(0.95);
        }

        #login-container button:focus {
            outline: none;
        }

        #login-container button.ghost {
            background-color: transparent;
            border-color: #FFFFFF;
        }

        #login-container form {
            background-color: #FFFFFF;
            display: flex;
            align-items: center;
            justify-content: center;
            flex-direction: column;
            padding: 0 50px;
            height: 100%;
            text-align: center;
        }

        #login-container input {
            background-color: #eee;
            border: none;
            padding: 12px 15px;
            margin: 8px 0;
            width: 100%;
        }

        #login-container .login-card {
            background-color: #fff;
            border-radius: 10px;
            box-shadow: 0 14px 28px rgba(0, 0, 0, 0.25),
                0 10px 10px rgba(0, 0, 0, 0.22);
            position: relative;
            overflow: hidden;
            width: 768px;
            max-width: 90%;
            min-height: 480px;
        }

        #login-container .form-container {
            position: absolute;
            top: 0;
            height: 100%;
            transition: all 0.6s ease-in-out;
        }

        #login-container .sign-in-container {
            left: 0;
            width: 50%;
            z-index: 2;
        }

        #login-container.right-panel-active .sign-in-container {
            transform: translateX(100%);
        }

        #login-container .sign-up-container {
            left: 0;
            width: 50%;
            opacity: 0;
            z-index: 1;
        }

        #login-container.right-panel-active .sign-up-container {
            transform: translateX(100%);
            opacity: 1;
            z-index: 5;
            animation: show 0.6s;
        }

        @keyframes show {
            0%,
            49.99% {
                opacity: 0;
                z-index: 1;
            }
            50%,
            100% {
                opacity: 1;
                z-index: 5;
            }
        }

        #login-container .overlay-container {
            position: absolute;
            top: 0;
            left: 50%;
            width: 50%;
            height: 100%;
            overflow: hidden;
            transition: transform 0.6s ease-in-out;
            z-index: 100;
        }

        #login-container.right-panel-active .overlay-container {
            transform: translateX(-100%);
        }

        #login-container .overlay {
            background: #FF416C;
            background: -webkit-linear-gradient(to right, #FF4B2B, #FF416C);
            background: linear-gradient(to right, #FF4B2B, #FF416C);
            background-repeat: no-repeat;
            background-size: cover;
            background-position: 0 0;
            color: #FFFFFF;
            position: relative;
            left: -100%;
            height: 100%;
            width: 200%;
            transform: translateX(0);
            transition: transform 0.6s ease-in-out;
        }

        #login-container.right-panel-active .overlay {
            transform: translateX(50%);
        }

        #login-container .overlay-panel {
            position: absolute;
            display: flex;
            align-items: center;
            justify-content: center;
            flex-direction: column;
            padding: 0 40px;
            text-align: center;
            top: 0;
            height: 100%;
            width: 50%;
            transform: translateX(0);
            transition: transform 0.6s ease-in-out;
        }

        #login-container .overlay-left {
            transform: translateX(-20%);
        }

        #login-container.right-panel-active .overlay-left {
            transform: translateX(0);
        }

        #login-container .overlay-right {
            right: 0;
            transform: translateX(0);
        }

        #login-container.right-panel-active .overlay-right {
            transform: translateX(20%);
        }

        #login-container .social-container {
            margin: 20px 0;
        }

        #login-container .social-container a {
            border: 1px solid #DDDDDD;
            border-radius: 50%;
            display: inline-flex;
            justify-content: center;
            align-items: center;
            margin: 0 5px;
            height: 40px;
            width: 40px;
        }
        
        @media (max-width: 768px) {
            #login-container .form-container {
                width: 100%;
                z-index: 5;
            }
            #login-container .overlay-container {
                display: none;
            }
            #login-container .sign-up-container {
                opacity: 1;
            }
            #login-container.right-panel-active .sign-up-container {
                transform: none;
                z-index: 1;
            }
            #login-container .sign-in-container {
                transform: translateX(100%);
            }
            #login-container.right-panel-active .sign-in-container {
                transform: none;
                z-index: 2;
            }
        }
    </style>
</head>

<body class="bg-gray-50 text-gray-800">
    <!-- Header -->
    <header class="bg-white shadow-md sticky top-0 z-50">
        <nav class="container mx-auto px-6 py-3 flex justify-between items-center">
            <a href="#" id="home-link" class="flex items-center space-x-2">
                <div id="logo-container">
                    <!-- Default SVG Logo -->
                    <svg class="h-10 w-10 text-red-600" width="24" height="24" viewBox="0 0 24 24" fill="none"
                        xmlns="http://www.w3.org/2000/svg">
                        <path
                            d="M12 2C6.48 2 2 6.48 2 12C2 17.52 6.48 22 12 22C17.52 22 22 17.52 22 12C22 6.48 17.52 2 12 2ZM16.83 15.42C16.5 15.75 16.03 16 15.5 16H8.5C7.97 16 7.5 15.75 7.17 15.42C6.55 14.8 6.25 13.97 6.5 13.2L8.28 7.38C8.55 6.56 9.25 6 10.12 6H13.88C14.75 6 15.45 6.56 15.72 7.38L17.5 13.2C17.75 13.97 17.45 14.8 16.83 15.42Z"
                            fill="#EF4444" />
                        <path d="M12 4C9.79 4 8 5.79 8 8V10H16V8C16 5.79 14.21 4 12 4Z" fill="#FBBF24" />
                    </svg>
                </div>
                <span class="text-2xl font-bold text-red-600 logo-font">BnM</span>
            </a>
            <div class="flex items-center space-x-6">
                 <!-- Navigation links visible to customers/public -->
                <div id="public-nav" class="hidden md:flex space-x-6 items-center">
                    <a href="#menu" class="text-gray-600 hover:text-red-600 transition duration-300">Menu</a>
                    <a href="#about" class="text-gray-600 hover:text-red-600 transition duration-300">About Us</a>
                    <a href="#contact" class="text-gray-600 hover:text-red-600 transition duration-300">Contact</a>
                </div>
                <button id="order-online-btn"
                    class="bg-yellow-400 text-gray-900 font-semibold px-4 py-2 rounded-full hover:bg-yellow-500 transition duration-300">
                    Order Online
                </button>
                <div id="auth-buttons" class="flex space-x-4">
                    <button id="change-password-btn"
                        class="hidden bg-blue-600 text-white font-semibold px-4 py-2 rounded-full hover:bg-blue-700 transition duration-300">
                        Change Password
                    </button>
                    <button id="login-btn"
                        class="bg-red-600 text-white font-semibold px-4 py-2 rounded-full hover:bg-red-700 transition duration-300">
                        Login
                    </button>
                    <button id="logout-btn"
                        class="hidden bg-gray-500 text-white font-semibold px-4 py-2 rounded-full hover:bg-gray-600 transition duration-300">
                        Logout
                    </button>
                </div>
            </div>
        </nav>
    </header>

    <!-- Main Content Container -->
    <main id="main-content" class="page-container"></main>

    <!-- Footer -->
    <footer class="bg-gray-900 text-white">
        <div class="container mx-auto px-6 py-8">
            <div class="flex flex-col md:flex-row justify-between items-center">
                <div class="mb-4 md:mb-0 text-center md:text-left">
                    <h3 class="text-xl font-bold">BnM</h3>
                    <p class="text-gray-400">© 2024 All Rights Reserved.</p>
                    <p class="text-xs text-gray-500 mt-2">Developed with ❤️ by Nabeel Hussain Akhtar</p>
                </div>
                <div class="flex space-x-4">
                    <a href="#" class="text-gray-400 hover:text-white"><i class="fab fa-facebook-f fa-lg"></i></a>
                    <a href="https://www.instagram.com/bites_n_more_glb/" target="_blank"
                        class="text-gray-400 hover:text-white"><i class="fab fa-instagram fa-lg"></i></a>
                    <a href="#" class="text-gray-400 hover:text-white"><i class="fab fa-twitter fa-lg"></i></a>
                </div>
            </div>
        </div>
    </footer>

    <!-- MODALS AND POPUPS -->
    <!-- "Item Added" Popup -->
    <div id="cart-popup"
        class="fixed bottom-0 left-1/2 -translate-x-1/2 translate-y-full opacity-0 bg-gray-800 text-white p-4 rounded-lg shadow-2xl flex items-center justify-between w-11/12 max-w-md z-50">
        <p id="popup-text" class="flex-grow">Item added to cart!</p>
        <button id="popup-view-cart-btn"
            class="font-bold bg-yellow-400 text-gray-900 px-4 py-2 rounded-full ml-4">View Cart</button>
    </div>

    <!-- Message Modal -->
    <div id="message-modal"
        class="fixed inset-0 bg-black bg-opacity-50 hidden items-center justify-center p-4 z-[100]">
        <div class="bg-white rounded-xl shadow-2xl p-6 w-full max-w-md transform transition-all">
            <h3 id="modal-title" class="text-2xl font-bold mb-4"></h3>
            <p id="modal-message" class="text-gray-700 mb-6"></p>
            <div class="flex justify-end">
                <button id="modal-close-btn"
                    class="bg-red-600 text-white px-6 py-2 rounded-lg font-semibold hover:bg-red-700 transition">
                    OK
                </button>
            </div>
        </div>
    </div>

    <!-- Password Change Modal -->
    <div id="password-modal"
        class="fixed inset-0 bg-black bg-opacity-50 hidden items-center justify-center p-4 z-[100]">
        <div class="bg-white rounded-xl shadow-2xl p-6 w-full max-w-md transform transition-all">
            <h3 class="text-2xl font-bold mb-4">Change Password</h3>
            <form id="change-password-form" class="space-y-4">
                <div>
                    <input type="password" id="old-password" placeholder="Current Password" required
                        class="w-full px-5 py-3 border border-gray-300 rounded-lg focus:ring-red-500 focus:border-red-500">
                </div>
                <div>
                    <input type="password" id="new-password" placeholder="New Password" required
                        class="w-full px-5 py-3 border border-gray-300 rounded-lg focus:ring-red-500 focus:border-red-500">
                </div>
                <div>
                    <input type="password" id="confirm-new-password" placeholder="Confirm New Password" required
                        class="w-full px-5 py-3 border border-gray-300 rounded-lg focus:ring-red-500 focus:border-red-500">
                </div>
                <div class="flex justify-end space-x-4 mt-6">
                    <button type="button" id="cancel-password-change-btn"
                        class="bg-gray-400 text-white px-6 py-2 rounded-lg font-semibold hover:bg-gray-500 transition">
                        Cancel
                    </button>
                    <button type="submit"
                        class="bg-blue-600 text-white px-6 py-2 rounded-lg font-semibold hover:bg-blue-700 transition">
                        Change
                    </button>
                </div>
            </form>
        </div>
    </div>

    <!-- Order Summary Modal -->
    <div id="order-summary-modal"
        class="fixed inset-0 bg-black bg-opacity-50 hidden items-center justify-center p-4 z-[100]">
        <div class="bg-white rounded-xl shadow-2xl p-6 w-full max-w-md transform transition-all">
            <h3 id="summary-title" class="text-2xl font-bold mb-4 text-center"></h3>
            <p id="summary-message" class="text-gray-700 mb-6 text-center"></p>
            <div id="summary-details" class="space-y-2 mb-6"></div>
            <p id="summary-quote" class="text-gray-500 text-center italic mb-6"></p>
            <div class="flex justify-end">
                <button id="summary-close-btn"
                    class="bg-red-600 text-white px-6 py-2 rounded-lg font-semibold hover:bg-red-700 transition">
                    Close
                </button>
            </div>
        </div>
    </div>

    <!-- Login Modal -->
    <div id="login-modal" class="login-popup hidden">
        <div id="login-container" class="login-card">
            <div class="form-container sign-up-container">
                <form id="signup-form">
                    <h1 class="text-3xl font-bold mb-4">Create Account</h1>
                    <div class="social-container">
                        <a href="#" class="social"><i class="fab fa-facebook-f"></i></a>
                        <a href="#" class="social"><i class="fab fa-google-plus-g"></i></a>
                        <a href="#" class="social"><i class="fab fa-linkedin-in"></i></a>
                    </div>
                    <span>or use your email for registration</span>
                    <input type="text" id="signup-username" placeholder="Username" required />
                    <input type="password" id="signup-password" placeholder="Password" required />
                    <input type="password" id="signup-confirm-password" placeholder="Confirm Password" required />
                    <input type="password" id="signup-code" placeholder="Unique Code (Optional)" />
                    <button type="submit">Sign Up</button>
                </form>
            </div>
            <div class="form-container sign-in-container">
                <form id="login-form">
                    <h1 class="text-3xl font-bold mb-4">Sign in</h1>
                    <div class="social-container">
                        <a href="#" class="social"><i class="fab fa-facebook-f"></i></a>
                        <a href="#" class="social"><i class="fab fa-google-plus-g"></i></a>
                        <a href="#" class="social"><i class="fab fa-linkedin-in"></i></a>
                    </div>
                    <span>or use your account</span>
                    <input type="text" id="username" placeholder="Username" required />
                    <input type="password" id="password" placeholder="Password" required />
                    <a href="#">Forgot your password?</a>
                    <button type="submit">Sign In</button>
                </form>
            </div>
            <div class="overlay-container">
                <div class="overlay">
                    <div class="overlay-panel overlay-left">
                        <h1 class="text-3xl font-bold">Welcome Back!</h1>
                        <p>To keep connected with us please login with your personal info</p>
                        <button class="ghost" id="signIn">Sign In</button>
                    </div>
                    <div class="overlay-panel overlay-right">
                        <h1 class="text-3xl font-bold">Hello, Friend!</h1>
                        <p>Enter your personal details and start your journey with us</p>
                        <button class="ghost" id="signUp">Sign Up</button>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- SCRIPT FOR ALL FUNCTIONALITY -->
    <script>
        document.addEventListener('DOMContentLoaded', () => {

            // =================================================================
            // CORE APPLICATION STATE
            // =================================================================
            let appState = {
                currentView: '',
                loggedInUser: null,
                previousView: null, // Track the view before login
                users: {
                    'happy': { password: 'burger', role: 'customer' },
                    'BnM': { password: 'Qwerty@321', role: 'admin' },
                    'Delivery': { password: 'Burger321', role: 'delivery' }
                },
                aboutUsContent: `
                    <p class="text-lg text-gray-600 mb-6">
                        Welcome to **Bites n' More**, your go-to spot for delicious, high-quality fast food in Kalaburagi. Our mission is simple: to serve you happiness, one bite at a time. We believe in crafting mouth-watering meals using the freshest ingredients, all prepared with a touch of love.
                    </p>
                    <p class="text-lg text-gray-600 mb-6">
                        From our crispy, loaded French fries to our juicy, perfectly seasoned burgers, every item on our menu is designed to give you a memorable culinary experience. We're proud to offer quick and efficient service, whether you're dining in, taking away, or getting it delivered right to your doorstep within a 3km radius.
                    </p>
                    <p class="text-lg text-gray-600">
                        Join us at Bites n' More and discover why we're more than just a food joint—we're a place where great food meets great times.
                    </p>
                `,
                reviews: [
                    {
                        name: 'Anjali Gupta',
                        rating: 5,
                        comment: "Absolutely fantastic! The Tandoori Pizza was loaded with toppings and had the perfect cheesy pull. The staff is friendly and the service is quick. A must-visit spot in Kalaburagi!",
                        image: 'https://images.unsplash.com/photo-1535713875002-d1d0cf377fde?q=80&w=2960&auto=format&fit=crop'
                    },
                    {
                        name: 'Vikram Singh',
                        rating: 5,
                        comment: "Ordered from here for the first time and was super impressed. The delivery was right on time, and the food was packed neatly. The prices are very reasonable for the quality you get. The loaded fries are a game-changer!",
                        image: 'https://images.unsplash.com/photo-1507003211169-0a1dd7228f2d?q=80&w=2787&auto=format&fit=crop'
                    },
                    {
                        name: 'Sneha Patil',
                        rating: 4.5,
                        comment: "A great place to hang out with friends. The vibe is very chill and modern. Their Watermelon Mojito is so refreshing! We had a great time and will definitely be back for more.",
                        image: 'https://images.unsplash.com/photo-1494790108377-be9c29b29330?q=80&w=2787&auto=format&fit=crop'
                    },
                ],
                adminCode: 'admin123',
                deliveryCode: 'delivery456',
                deliveryPartners: [],
                categories: [
                    { id: 'appetizers', name: 'Appetizers' },
                    { id: 'main-course', name: 'Main Course' },
                    { id: 'beverages', name: 'Beverages' }
                ],
                menuItems: [
                    {
                        id: 'f1',
                        name: 'French Fries',
                        price: 30,
                        image: 'https://images.unsplash.com/photo-1585109649234-36639308246a?q=80&w=2787&auto=format&fit=crop',
                        categoryId: 'appetizers'
                    },
                    {
                        id: 'pt1',
                        name: 'Potato Twister',
                        price: 50,
                        image: 'https://images.unsplash.com/photo-1621852004184-755a4365455d?q=80&w=2787&auto=format&fit=crop',
                        categoryId: 'appetizers'
                    },
                    {
                        id: 'b1',
                        name: 'Crispy Chicken Burger',
                        price: 90,
                        image: 'https://images.unsplash.com/photo-1571091718767-18b5b1457add?q=80&w=2942&auto=format&fit=crop',
                        categoryId: 'main-course'
                    },
                    {
                        id: 'coke',
                        name: 'Coca-Cola',
                        price: 20,
                        image: 'https://images.unsplash.com/photo-1567103482594-b20de4690835?q=80&w=2835&auto=format&fit=crop',
                        categoryId: 'beverages'
                    }
                ],
                orders: [],
                cart: [],
                serviceType: null,
                tableNumber: null,
                customerInfo: null
            };

            const orderQuotes = [
                "Life is too short to miss out on a good burger.",
                "Fries: the most delicious gateway to happiness.",
                "A balanced diet is a burger in each hand.",
                "Don't cry because it's over, smile because it happened. And eat more burgers."
            ];

            // =================================================================
            // DOM ELEMENTS
            // =================================================================
            const mainContent = document.getElementById('main-content');
            const loginBtn = document.getElementById('login-btn');
            const logoutBtn = document.getElementById('logout-btn');
            const changePasswordBtn = document.getElementById('change-password-btn');
            const orderOnlineBtn = document.getElementById('order-online-btn');
            const homeLink = document.getElementById('home-link');
            const publicNav = document.getElementById('public-nav');

            const messageModal = document.getElementById('message-modal');
            const modalTitle = document.getElementById('modal-title');
            const modalMessage = document.getElementById('modal-message');
            const modalCloseBtn = document.getElementById('modal-close-btn');

            const passwordModal = document.getElementById('password-modal');
            const changePasswordForm = document.getElementById('change-password-form');
            const cancelPasswordChangeBtn = document.getElementById('cancel-password-change-btn');

            const orderSummaryModal = document.getElementById('order-summary-modal');
            const summaryTitle = document.getElementById('summary-title');
            const summaryMessage = document.getElementById('summary-message');
            const summaryDetails = document.getElementById('summary-details');
            const summaryQuote = document.getElementById('summary-quote');
            const summaryCloseBtn = document.getElementById('summary-close-btn');
            
            const loginModal = document.getElementById('login-modal');
            const loginForm = document.getElementById('login-form');
            const signupForm = document.getElementById('signup-form');
            const loginContainer = document.getElementById('login-container');


            // =================================================================
            // GOOGLE SIGN-IN INTEGRATION
            // =================================================================
            window.handleCredentialResponse = (response) => {
                const credential = response.credential;
                const base64Url = credential.split('.')[1];
                const base64 = base64Url.replace(/-/g, '+').replace(/_/g, '/');
                const jsonPayload = decodeURIComponent(atob(base64).split('').map(function(c) {
                    return '%' + ('00' + c.charCodeAt(0).toString(16)).slice(-2);
                }).join(''));

                const user = JSON.parse(jsonPayload);
                const username = user.email;

                if (!appState.users[username]) {
                    appState.users[username] = {
                        password: '', 
                        role: 'customer',
                        googleId: user.sub
                    };
                    showMessageModal('Success!', 'Google account linked successfully!');
                }
                setLoggedInUser(username, appState.users[username].role);
                saveAppState();
            };

            const renderGoogleSignInButton = () => {
                const googleButtonContainer = document.getElementById('g_id_onload');
                if (googleButtonContainer) {
                    google.accounts.id.initialize({
                        client_id: "882053891586-7rsl93dmfqcit8ahdmntj6aifl76aobq.apps.googleusercontent.com",
                        callback: window.handleCredentialResponse,
                        ux_mode: "popup"
                    });
                    google.accounts.id.renderButton(
                        googleButtonContainer, {
                            type: "standard",
                            size: "large",
                            theme: "outline",
                            text: "signin_with",
                            shape: "pill"
                        }
                    );
                }
            };
            
            // =================================================================
            // UTILITY FUNCTIONS
            // =================================================================
            const showMessageModal = (title, message) => {
                modalTitle.textContent = title;
                modalMessage.textContent = message;
                messageModal.classList.remove('hidden');
                messageModal.classList.add('flex');
            };

            modalCloseBtn.addEventListener('click', () => {
                messageModal.classList.remove('flex');
                messageModal.classList.add('hidden');
            });

            const showOrderSummaryModal = (title, message, details, quote) => {
                summaryTitle.textContent = title;
                summaryMessage.textContent = message;
                summaryDetails.innerHTML = details;
                summaryQuote.textContent = quote;
                orderSummaryModal.classList.remove('hidden');
                orderSummaryModal.classList.add('flex');
            };

            summaryCloseBtn.addEventListener('click', () => {
                orderSummaryModal.classList.remove('flex');
                orderSummaryModal.classList.add('hidden');
                renderView('customer-website');
            });
            
            const showLoginModal = () => {
                loginModal.classList.remove('hidden');
            };
            
            const hideLoginModal = () => {
                loginModal.classList.add('hidden');
            };

            const saveAppState = () => {
                localStorage.setItem('bitesNMoreState', JSON.stringify(appState));
            };

            const loadAppState = () => {
                const storedState = localStorage.getItem('bitesNMoreState');
                if (storedState) {
                    const parsedState = JSON.parse(storedState);
                    appState.loggedInUser = parsedState.loggedInUser;
                    appState.deliveryPartners = parsedState.deliveryPartners || [];
                    appState.menuItems = parsedState.menuItems || [];
                    appState.orders = parsedState.orders || [];
                    appState.cart = parsedState.cart || [];
                    appState.categories = parsedState.categories || appState.categories;
                    appState.users = { ...appState.users, ...(parsedState.users || {}) };
                    appState.aboutUsContent = parsedState.aboutUsContent || appState.aboutUsContent;
                    appState.reviews = parsedState.reviews || appState.reviews;
                }
            };

            const setLoggedInUser = (username, role) => {
                appState.loggedInUser = { username, role };
                saveAppState();
                updateUIForUser();
            };

            const logout = () => {
                appState.loggedInUser = null;
                saveAppState();
                updateUIForUser();
                renderView('customer-website');
                showMessageModal('Logged Out', 'You have been successfully logged out.');
            };

            const updateUIForUser = () => {
                const isLoggedIn = appState.loggedInUser !== null;
                
                loginBtn.classList.toggle('hidden', isLoggedIn);
                logoutBtn.classList.toggle('hidden', !isLoggedIn);
                changePasswordBtn.classList.toggle('hidden', !isLoggedIn);
                
                if (isLoggedIn && (appState.loggedInUser.role === 'admin' || appState.loggedInUser.role === 'delivery')) {
                    publicNav.classList.add('hidden');
                    orderOnlineBtn.classList.add('hidden');
                    if (window.location.pathname !== '/admin.html') {
                         window.location.href = 'admin.html';
                    }
                } else {
                    publicNav.classList.remove('hidden');
                    orderOnlineBtn.classList.remove('hidden');
                    if (appState.currentView !== 'customer-website' && appState.currentView !== 'cart') {
                       renderView('customer-website');
                    }
                }
            };
            
            const renderView = (viewName) => {
                appState.currentView = viewName;
                mainContent.innerHTML = '';
                
                if (!appState.loggedInUser && (viewName === 'admin-dashboard' || viewName === 'delivery-dashboard')) {
                    renderView('customer-website');
                    return;
                }

                const views = {
                    'customer-website': renderCustomerWebsite,
                    'admin-dashboard': renderAdminDashboard,
                    'delivery-dashboard': renderDeliveryDashboard,
                    'cart': renderCartPage
                };

                const renderFunction = views[viewName] || renderCustomerWebsite;
                renderFunction();
            };

            const renderCustomerWebsite = () => {
                mainContent.innerHTML = `
                    <section class="hero-bg text-white">
                        <div class="container mx-auto px-6 py-24 md:py-32 text-center">
                            <h1 class="text-4xl md:text-6xl font-bold leading-tight mb-4">We Serve You Happiness.</h1>
                            <p class="text-lg md:text-xl mb-8 max-w-2xl mx-auto">Delicious food delivered to your door within a 3km radius. Quick, fresh, and always satisfying!</p>
                            <div class="flex justify-center space-x-4">
                                <a href="#menu" class="bg-red-600 text-white font-bold py-3 px-8 rounded-full hover:bg-red-700 transition duration-300">View Menu</a>
                                <a href="#about" class="bg-white text-red-600 font-bold py-3 px-8 rounded-full hover:bg-gray-100 transition duration-300">About Us</a>
                            </div>
                        </div>
                    </section>
                    <section id="menu" class="py-16 md:py-24 bg-white">
                        <div class="container mx-auto px-6">
                            <div class="text-center mb-12">
                                <h2 class="text-3xl md:text-4xl font-bold text-gray-900">Our Delicious Menu</h2>
                                <p class="text-gray-600 mt-2">Crafted with love, just for you.</p>
                            </div>
                            <!-- Category Slider -->
                            <div class="flex space-x-4 overflow-x-auto pb-4 mb-8">
                                <button data-category-id="all" class="menu-category-btn px-6 py-2 rounded-full border border-gray-300 text-gray-600 font-medium whitespace-nowrap active">All</button>
                                ${appState.categories.map(cat => `
                                    <button data-category-id="${cat.id}" class="menu-category-btn px-6 py-2 rounded-full border border-gray-300 text-gray-600 font-medium whitespace-nowrap">${cat.name}</button>
                                `).join('')}
                            </div>
                            <div id="menu-grid" class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-8">
                                <!-- Menu items will be dynamically generated here -->
                            </div>
                        </div>
                    </section>
                    <section id="about" class="py-16 md:py-24 bg-gray-50">
                        <div class="container mx-auto px-6">
                            <div class="text-center mb-12">
                                <h2 class="text-3xl md:text-4xl font-bold text-gray-900">About Bites n' More</h2>
                                <p class="text-gray-600 mt-2">More than just a food joint.</p>
                            </div>
                            <div class="max-w-4xl mx-auto text-center">
                                ${appState.aboutUsContent}
                            </div>
                        </div>
                    </section>
                    <section id="contact" class="py-16 md:py-24 bg-white">
                        <div class="container mx-auto px-6">
                            <div class="text-center mb-12">
                                <h2 class="text-3xl md:text-4xl font-bold text-gray-900">Get in Touch</h2>
                                <p class="text-gray-600 mt-2">We'd love to hear from you!</p>
                            </div>
                            <div class="grid md:grid-cols-2 gap-12 items-start">
                                <div class="bg-white p-8 rounded-lg shadow-lg">
                                    <h3 class="text-2xl font-bold mb-6">Send Us a Message</h3>
                                    <form id="contact-form" class="space-y-6">
                                        <div>
                                            <label for="contact-name" class="block text-sm font-medium text-gray-700">Your Name</label>
                                            <input type="text" name="contact-name" id="contact-name" required class="mt-1 block w-full px-4 py-3 bg-gray-50 border border-gray-300 rounded-md shadow-sm focus:outline-none focus:ring-red-500 focus:border-red-500">
                                        </div>
                                        <div>
                                            <label for="contact-email" class="block text-sm font-medium text-gray-700">Your Email</label>
                                            <input type="email" name="contact-email" id="contact-email" required class="mt-1 block w-full px-4 py-3 bg-gray-50 border border-gray-300 rounded-md shadow-sm focus:outline-none focus:ring-red-500 focus:border-red-500">
                                        </div>
                                        <div>
                                            <label for="contact-message" class="block text-sm font-medium text-gray-700">Message</label>
                                            <textarea name="contact-message" id="contact-message" rows="4" required class="mt-1 block w-full px-4 py-3 bg-gray-50 border border-gray-300 rounded-md shadow-sm focus:outline-none focus:ring-red-500 focus:border-red-500"></textarea>
                                        </div>
                                        <div>
                                            <button type="submit" class="w-full bg-red-600 text-white font-bold py-3 px-6 rounded-lg hover:bg-red-700 transition duration-300">Send Message</button>
                                        </div>
                                    </form>
                                </div>
                                <div>
                                    <div class="rounded-lg overflow-hidden shadow-lg mb-6">
                                        <iframe src="https://www.google.com/maps/embed?pb=!1m18!1m12!1m3!1d3805.518661858548!2d76.82999931487766!3d17.32700098801938!2m3!1f0!2f0!3f0!3m2!1i1024!2i768!4f13.1!3m3!1m2!1s0x3bc901e0b0000001%3A0x8932c8635c2b554b!2sBites%20n'%20More!5e0!3m2!1sen!2sin!4v1663333333333!5m2!1sen!2sin" width="100%" height="300" style="border:0;" allowfullscreen="" loading="lazy" referrerpolicy="no-referrer-when-downgrade"></iframe>
                                    </div>
                                    <div class="bg-white p-8 rounded-lg shadow-lg">
                                        <div class="space-y-4">
                                            <p class="flex items-start text-lg"><i class="fas fa-map-marker-alt text-red-500 w-6 mr-2 mt-1"></i> <span>BITES N' MORE, Yadullah Colony Main Rd, Yadulla Colony, Kalaburagi, Karnataka 585104</span></p>
                                            <div class="flex items-start text-lg"><i class="fas fa-phone-alt text-red-500 w-6 mr-2 mt-1"></i>
                                                <div>
                                                    <p>+91 87226 66555</p>
                                                    <p>+91 72042 84207</p>
                                                    <p>+91 81977 67686</p>
                                                </div>
                                            </div>
                                            <p class="flex items-start text-lg"><i class="fas fa-envelope text-red-500 w-6 mr-2 mt-1"></i> <span>order@bitesnmore.com</span></p>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </section>
                `;
                renderMenuItems();
            };

            const renderAdminDashboard = () => {
                mainContent.innerHTML = `
                    <div class="container mx-auto px-6 py-12">
                        <h2 class="text-4xl font-bold mb-8 text-gray-900">Admin Dashboard</h2>
                        <div class="grid grid-cols-1 lg:grid-cols-2 gap-12">
                            <!-- Section 1: Manage Delivery Partners -->
                            <div class="bg-white p-8 rounded-xl shadow-lg">
                                <h3 class="text-2xl font-bold text-red-600 mb-6">Manage Delivery Partners</h3>
                                <form id="add-delivery-form" class="space-y-4 mb-8">
                                    <input type="text" id="delivery-username" placeholder="New Partner Username" required class="w-full px-4 py-2 border rounded-md">
                                    <input type="password" id="delivery-password" placeholder="Password" required class="w-full px-4 py-2 border rounded-md">
                                    <button type="submit" class="w-full bg-green-600 text-white py-2 rounded-md font-semibold hover:bg-green-700 transition">Add Partner</button>
                                </form>
                                <div>
                                    <h4 class="text-xl font-semibold mb-4">Current Partners</h4>
                                    <ul id="delivery-list" class="space-y-2"></ul>
                                </div>
                            </div>

                            <!-- Section 2: Manage Categories & Menu Items -->
                            <div class="bg-white p-8 rounded-xl shadow-lg">
                                <h3 class="text-2xl font-bold text-red-600 mb-6">Manage Menu</h3>
                                <div class="space-y-4 mb-8">
                                    <h4 class="text-xl font-semibold">Categories</h4>
                                    <form id="add-category-form" class="flex space-x-2">
                                        <input type="text" id="new-category-name" placeholder="New Category Name" required class="flex-grow px-4 py-2 border rounded-md">
                                        <button type="submit" class="bg-blue-600 text-white py-2 px-4 rounded-md font-semibold hover:bg-blue-700 transition">Add</button>
                                    </form>
                                    <ul id="category-list" class="space-y-2"></ul>
                                </div>
                                <div class="space-y-4 mb-8">
                                    <h4 class="text-xl font-semibold">Menu Items</h4>
                                    <form id="add-menu-item-form" class="space-y-4">
                                        <select id="item-category" class="w-full px-4 py-2 border rounded-md" required></select>
                                        <input type="text" id="menu-name" placeholder="Item Name" required class="w-full px-4 py-2 border rounded-md">
                                        <input type="number" id="menu-price" placeholder="Price" required class="w-full px-4 py-2 border rounded-md">
                                        <input type="url" id="menu-image" placeholder="Image URL" class="w-full px-4 py-2 border rounded-md">
                                        <button type="submit" class="w-full bg-blue-600 text-white py-2 rounded-md font-semibold hover:bg-blue-700 transition">Add Menu Item</button>
                                    </form>
                                    <ul id="menu-list" class="space-y-4"></ul>
                                </div>
                            </div>

                            <!-- Section 3: Manage About Us & Reviews -->
                            <div class="bg-white p-8 rounded-xl shadow-lg lg:col-span-2">
                                <h3 class="text-2xl font-bold text-red-600 mb-6">Manage Content</h3>
                                <div class="mb-8">
                                    <h4 class="text-xl font-semibold mb-4">About Us Content</h4>
                                    <textarea id="about-us-textarea" class="w-full p-4 border rounded-md resize-y" rows="8">${appState.aboutUsContent.trim()}</textarea>
                                    <button id="save-about-us-btn" class="mt-4 bg-purple-600 text-white py-2 px-6 rounded-md font-semibold hover:bg-purple-700 transition">Save About Us</button>
                                </div>
                                <div>
                                    <h4 class="text-xl font-semibold mb-4">Customer Reviews</h4>
                                    <div id="admin-reviews-list" class="space-y-4"></div>
                                    <form id="add-review-form" class="mt-8 space-y-4">
                                        <h5 class="font-semibold">Add New Review</h5>
                                        <input type="text" id="review-name" placeholder="Customer Name" required class="w-full px-4 py-2 border rounded-md">
                                        <input type="number" id="review-rating" placeholder="Rating (1-5)" min="1" max="5" step="0.5" required class="w-full px-4 py-2 border rounded-md">
                                        <textarea id="review-comment" placeholder="Review Comment" required class="w-full p-4 border rounded-md resize-y" rows="3"></textarea>
                                        <button type="submit" class="w-full bg-green-600 text-white py-2 rounded-md font-semibold hover:bg-green-700 transition">Add Review</button>
                                    </form>
                                </div>
                            </div>

                            <!-- Section 4: View Orders -->
                            <div class="bg-white p-8 rounded-xl shadow-lg lg:col-span-2">
                                <h3 class="text-2xl font-bold text-red-600 mb-6">View All Orders</h3>
                                <div id="admin-orders-list" class="space-y-4">
                                    <p class="text-gray-500">No new orders yet.</p>
                                </div>
                            </div>

                            <!-- Section 5: Payment Gateway (Placeholder) -->
                            <div class="bg-white p-8 rounded-xl shadow-lg lg:col-span-2">
                                <h3 class="text-2xl font-bold text-red-600 mb-6">Payment Gateway API</h3>
                                <p class="text-gray-600 mb-4">This section would allow you to configure payment gateway API keys.</p>
                                <div class="space-y-4">
                                    <div>
                                        <label for="api-key" class="block text-sm font-medium text-gray-700">API Key</label>
                                        <input type="text" id="api-key" placeholder="Enter API Key" class="mt-1 block w-full px-4 py-2 bg-gray-50 border border-gray-300 rounded-md shadow-sm">
                                    </div>
                                    <button class="bg-gray-500 text-white py-2 px-4 rounded-md font-semibold hover:bg-gray-600 transition">Update API</button>
                                </div>
                            </div>
                        </div>
                    </div>
                `;

                document.getElementById('add-delivery-form').addEventListener('submit', handleAddDeliveryPartner);
                document.getElementById('add-category-form').addEventListener('submit', handleAddCategory);
                document.getElementById('add-menu-item-form').addEventListener('submit', handleAddMenuItem);
                document.getElementById('save-about-us-btn').addEventListener('click', handleSaveAboutUs);
                document.getElementById('add-review-form').addEventListener('submit', handleAddReview);

                renderDeliveryPartners();
                renderCategoriesAdmin();
                renderAdminMenu();
                renderAdminOrders();
                renderAdminReviews();
            };

            const renderDeliveryDashboard = () => {
                mainContent.innerHTML = `
                    <div class="container mx-auto px-6 py-12">
                        <h2 class="text-4xl font-bold mb-8 text-gray-900">Delivery Dashboard</h2>
                        <div class="bg-white p-8 rounded-xl shadow-lg">
                            <h3 class="text-2xl font-bold text-red-600 mb-6">Pending Orders</h3>
                            <div id="delivery-orders-list" class="space-y-4">
                                <p class="text-gray-500">No pending orders to deliver.</p>
                            </div>
                        </div>
                    </div>
                `;
                renderDeliveryOrders();
            };

            const renderCartPage = () => {
                const total = appState.cart.reduce((sum, item) => sum + (item.price * item.quantity), 0);
                let cartContent = '';
                if (appState.cart.length === 0) {
                    cartContent = '<p class="text-gray-500 text-center">Your cart is empty.</p>';
                } else {
                    cartContent = appState.cart.map(item => `
                        <div class="flex justify-between items-center p-4 bg-gray-50 rounded-lg">
                            <div>
                                <p class="font-semibold">${item.name}</p>
                                <p class="text-sm text-gray-600">Quantity: ${item.quantity}</p>
                            </div>
                            <span class="font-bold">₹${(item.price * item.quantity).toFixed(2)}</span>
                        </div>
                    `).join('');
                }
                
                mainContent.innerHTML = `
                    <div class="container mx-auto px-6 py-12">
                        <div class="max-w-3xl mx-auto bg-white p-8 rounded-xl shadow-lg">
                            <h2 class="text-3xl font-bold mb-8 text-gray-900">Your Cart</h2>
                            <div id="cart-items-container" class="space-y-4">
                                ${cartContent}
                            </div>
                            <div class="mt-8 pt-4 border-t border-gray-200 flex justify-between items-center text-2xl font-bold">
                                <span>Total:</span>
                                <span>₹${total.toFixed(2)}</span>
                            </div>
                            <div class="mt-8 space-y-4">
                                <h3 class="text-xl font-semibold">Choose Service Type:</h3>
                                <div class="flex justify-between space-x-4">
                                    <button id="service-delivery-btn" class="service-btn flex-1 bg-red-500 text-white font-semibold py-3 rounded-lg hover:bg-red-600 transition">
                                        <i class="fas fa-motorcycle mr-2"></i>Delivery
                                    </button>
                                    <button id="service-takeaway-btn" class="service-btn flex-1 bg-yellow-500 text-gray-900 font-semibold py-3 rounded-lg hover:bg-yellow-600 transition">
                                        <i class="fas fa-shopping-bag mr-2"></i>Take Away
                                    </button>
                                    <button id="service-dinein-btn" class="service-btn flex-1 bg-green-500 text-white font-semibold py-3 rounded-lg hover:bg-green-600 transition">
                                        <i class="fas fa-utensils mr-2"></i>Dine In
                                    </button>
                                </div>
                                <div id="service-options-container"></div>
                                <div class="mt-8 flex justify-between space-x-4">
                                    <button id="continue-shopping-btn" class="flex-1 border border-gray-300 text-gray-700 py-3 rounded-lg font-semibold hover:bg-gray-100 transition">
                                        Continue Shopping
                                    </button>
                                    <button id="checkout-btn" class="flex-1 bg-red-600 text-white py-3 rounded-lg font-semibold hover:bg-red-700 transition">
                                        Checkout
                                    </button>
                                </div>
                            </div>
                        </div>
                    </div>
                `;
                
                document.getElementById('continue-shopping-btn').addEventListener('click', () => renderView('customer-website'));
                document.getElementById('checkout-btn').addEventListener('click', handleCheckout);
                document.getElementById('service-delivery-btn').addEventListener('click', () => renderServiceOptions('delivery'));
                document.getElementById('service-takeaway-btn').addEventListener('click', () => renderServiceOptions('takeaway'));
                document.getElementById('service-dinein-btn').addEventListener('click', () => renderServiceOptions('dinein'));
            };

            const renderServiceOptions = (serviceType) => {
                const optionsContainer = document.getElementById('service-options-container');
                optionsContainer.innerHTML = '';
                appState.serviceType = serviceType;
                appState.tableNumber = null;
                appState.customerInfo = null;
                
                if (serviceType === 'delivery') {
                    optionsContainer.innerHTML = `
                        <div class="mt-6 space-y-4">
                            <h4 class="text-lg font-semibold">Delivery Details:</h4>
                            <form id="delivery-details-form" class="space-y-4">
                                <input type="text" id="customer-name" placeholder="Your Name" required class="w-full px-4 py-2 border rounded-md">
                                <input type="tel" id="customer-phone" placeholder="Phone Number" required class="w-full px-4 py-2 border rounded-md">
                                <input type="text" id="customer-address" placeholder="Address" required class="w-full px-4 py-2 border rounded-md">
                                <input type="text" id="customer-landmark" placeholder="Landmark" required class="w-full px-4 py-2 border rounded-md">
                                <div class="rounded-lg overflow-hidden shadow-lg mb-6 h-64">
                                    <div id="map" class="w-full h-full"></div>
                                </div>
                            </form>
                        </div>
                    `;
                    document.getElementById('delivery-details-form').addEventListener('input', (e) => {
                        appState.customerInfo = {
                            name: document.getElementById('customer-name').value,
                            phone: document.getElementById('customer-phone').value,
                            address: document.getElementById('customer-address').value,
                            landmark: document.getElementById('customer-landmark').value,
                            location: {lat: 17.32700098801938, lng: 76.82999931487766} // Simulated default pin
                        };
                    });
                } else if (serviceType === 'dinein') {
                    optionsContainer.innerHTML = `
                        <div class="mt-6 space-y-4">
                            <h4 class="text-lg font-semibold">Select a Table:</h4>
                            <div id="table-grid" class="grid grid-cols-4 gap-4"></div>
                        </div>
                    `;
                    renderTableButtons();
                }
                
                document.querySelectorAll('.service-btn').forEach(btn => btn.classList.remove('active'));
                document.getElementById(`service-${serviceType}-btn`).classList.add('active');
            };

            const renderTableButtons = () => {
                const tableGrid = document.getElementById('table-grid');
                if (!tableGrid) return;
                tableGrid.innerHTML = '';
                for (let i = 1; i <= 7; i++) {
                    const tableBtn = document.createElement('button');
                    tableBtn.textContent = `Table ${i}`;
                    tableBtn.className = "bg-gray-200 text-gray-800 p-3 rounded-lg font-semibold hover:bg-gray-300 transition";
                    tableBtn.dataset.tableNumber = i;
                    tableBtn.addEventListener('click', () => {
                        document.querySelectorAll('#table-grid button').forEach(btn => btn.classList.remove('bg-red-500', 'text-white'));
                        tableBtn.classList.add('bg-red-500', 'text-white');
                        appState.tableNumber = i;
                    });
                    tableGrid.appendChild(tableBtn);
                }
            };
            
            // =================================================================
            // AUTHENTICATION LOGIC
            // =================================================================
            const handleLogin = (e) => {
                e.preventDefault();
                const username = document.getElementById('username').value;
                const password = document.getElementById('password').value;
                const user = appState.users[username];

                if (user && user.password === password) {
                    setLoggedInUser(username, user.role);
                    hideLoginModal();
                    if(appState.previousView === 'cart') {
                      renderView('cart');
                    } else {
                      window.location.href = 'index.html';
                    }
                    showMessageModal('Login Successful', `Welcome, ${user.role}!`);
                } else {
                    showMessageModal('Login Failed', 'Invalid username or password.');
                }
            };

            const handleSignup = (e) => {
                e.preventDefault();
                const username = document.getElementById('signup-username').value;
                const password = document.getElementById('signup-password').value;
                const confirmPassword = document.getElementById('signup-confirm-password').value;
                const uniqueCode = document.getElementById('signup-code').value;

                if (password !== confirmPassword) {
                    showMessageModal('Signup Failed', 'Passwords do not match.');
                    return;
                }

                if (appState.users[username]) {
                    showMessageModal('Signup Failed', 'Username already exists.');
                    return;
                }
                
                let userRole = 'customer';
                if (uniqueCode === appState.adminCode) {
                    userRole = 'admin';
                } else if (uniqueCode === appState.deliveryCode) {
                    userRole = 'delivery';
                    appState.deliveryPartners.push(username);
                } else if (uniqueCode) {
                    showMessageModal('Signup Failed', 'Invalid unique code.');
                    return;
                }

                appState.users[username] = { password, role: userRole };
                saveAppState();
                showMessageModal('Success!', 'Account created successfully. You can now log in.');
                loginContainer.classList.remove('right-panel-active');
            };

            // =================================================================
            // DATA MANAGEMENT & RENDERING FUNCTIONS (Not in customer view, but needed for state)
            // =================================================================
            const renderMenuItems = () => {
                const menuGrid = document.getElementById('menu-grid');
                if (!menuGrid) return;
                
                const categoryButtons = document.querySelectorAll('.menu-category-btn');
                categoryButtons.forEach(btn => {
                    btn.addEventListener('click', () => {
                        categoryButtons.forEach(b => b.classList.remove('active'));
                        btn.classList.add('active');
                        const categoryId = btn.dataset.categoryId;
                        filterAndRenderMenu(categoryId);
                    });
                });

                filterAndRenderMenu('all');
            };

            const filterAndRenderMenu = (categoryId) => {
                const menuGrid = document.getElementById('menu-grid');
                if (!menuGrid) return;
                
                let itemsToRender = appState.menuItems;
                if (categoryId !== 'all') {
                    itemsToRender = appState.menuItems.filter(item => item.categoryId === categoryId);
                }
                
                menuGrid.innerHTML = itemsToRender.map(item => `
                    <div class="bg-white rounded-lg shadow-lg overflow-hidden transform hover:scale-105 transition-transform duration-300">
                        <img src="${item.image}" alt="${item.name}" class="w-full menu-card-image" onerror="this.src='https://placehold.co/600x400/cccccc/ffffff?text=Image+Not+Found';">
                        <div class="p-6">
                            <h3 class="text-2xl font-bold mb-4 text-red-600">${item.name}</h3>
                            <div class="space-y-3 text-gray-700">
                                <div class="flex justify-between items-center">
                                    <span>Price - ₹${item.price}</span>
                                    <button class="add-to-cart-btn bg-red-500 text-white px-3 py-1 rounded-full text-sm" data-id="${item.id}" data-name="${item.name}" data-price="${item.price}">Add</button>
                                </div>
                            </div>
                        </div>
                    </div>
                `).join('');
            };

            const addToCart = (id, name, price) => {
                if(!appState.loggedInUser) {
                    appState.previousView = 'customer-website';
                    showLoginModal();
                    return;
                }
                const existingItem = appState.cart.find(item => item.id === id);
                if (existingItem) {
                    existingItem.quantity++;
                } else {
                    appState.cart.push({ id, name, price, quantity: 1 });
                }
                saveAppState();
                
                const cartPopup = document.getElementById('cart-popup');
                const popupText = document.getElementById('popup-text');
                popupText.textContent = `${name} added to cart!`;
                cartPopup.classList.remove('translate-y-full', 'opacity-0');
                cartPopup.classList.add('-translate-y-4');
                clearTimeout(cartPopup.timeout);
                cartPopup.timeout = setTimeout(() => {
                    cartPopup.classList.add('translate-y-full', 'opacity-0');
                    cartPopup.classList.remove('-translate-y-4');
                }, 3000);
            };

            const handleCheckout = () => {
                if (appState.cart.length === 0) {
                    showMessageModal('Empty Cart', 'Please add items to your cart before checking out.');
                    return;
                }
                
                if (!appState.loggedInUser) {
                    appState.previousView = 'cart';
                    showLoginModal();
                    return;
                }
                
                const serviceType = appState.serviceType;
                
                if (!serviceType) {
                    showMessageModal('Service Required', 'Please select a service type before checking out.');
                    return;
                }
                
                let orderDetails = {};
                let summaryDetailsHtml = '';
                let confirmationMessage = '';
                
                const customerName = document.getElementById('customer-name')?.value || 'N/A';
                const customerPhone = document.getElementById('customer-phone')?.value || 'N/A';
                const customerAddress = document.getElementById('customer-address')?.value || 'N/A';
                const customerLandmark = document.getElementById('customer-landmark')?.value || 'N/A';
                
                if (serviceType === 'delivery') {
                    if (!customerName || !customerPhone || !customerAddress) {
                        showMessageModal('Details Required', 'Please fill in all delivery details.');
                        return;
                    }
                    const orderCode = `BnM-${Math.floor(1000 + Math.random() * 9000)}`;
                    orderDetails = {
                        id: `order-${Date.now()}`,
                        code: orderCode,
                        customer: appState.loggedInUser.username,
                        items: appState.cart,
                        service: 'Delivery',
                        status: 'Pending',
                        timestamp: new Date().toLocaleTimeString(),
                        deliveryInfo: { name: customerName, phone: customerPhone, address: customerAddress, landmark: customerLandmark }
                    };
                    confirmationMessage = 'Thank you! We have received your order. 😊';
                    summaryDetailsHtml = `
                        <p><strong>Order Code:</strong> <span class="font-bold">${orderCode}</span></p>
                        <p><strong>Service:</strong> Delivery</p>
                        <h4 class="font-semibold mt-4">Delivery Details:</h4>
                        <p><strong>Name:</strong> ${customerName}</p>
                        <p><strong>Phone:</strong> ${customerPhone}</p>
                        <p><strong>Address:</strong> ${customerAddress}, ${customerLandmark}</p>
                        <p><strong>Location Pin:</strong> ${orderDetails.deliveryInfo.location}</p>
                    `;
                } else if (serviceType === 'takeaway') {
                    const orderCode = `BnM-${Math.floor(1000 + Math.random() * 9000)}`;
                    orderDetails = {
                        id: `order-${Date.now()}`,
                        code: orderCode,
                        customer: appState.loggedInUser.username,
                        items: appState.cart,
                        service: 'Take Away',
                        status: 'Pending',
                        timestamp: new Date().toLocaleTimeString()
                    };
                    confirmationMessage = 'Thank you for your order! It will be ready for pickup shortly. �';
                    summaryDetailsHtml = `
                        <p><strong>Order Code:</strong> <span class="font-bold">${orderCode}</span></p>
                        <p><strong>Service:</strong> Take Away</p>
                    `;
                } else if (serviceType === 'dinein') {
                    if (!appState.tableNumber) {
                        showMessageModal('Table Required', 'Please select a table number for dine-in service.');
                        return;
                    }
                    orderDetails = {
                        id: `order-${Date.now()}`,
                        customer: appState.loggedInUser.username,
                        items: appState.cart,
                        service: 'Dine In',
                        table: appState.tableNumber,
                        status: 'Pending',
                        timestamp: new Date().toLocaleTimeString()
                    };
                    confirmationMessage = `Your order has been placed for Table ${appState.tableNumber}. Enjoy! 😊`;
                    summaryDetailsHtml = `
                        <p><strong>Service:</strong> Dine In</p>
                        <p><strong>Table:</strong> <span class="font-bold">${appState.tableNumber}</span></p>
                    `;
                }
                
                appState.orders.push(orderDetails);
                appState.cart = [];
                saveAppState();
                
                const randomQuote = orderQuotes[Math.floor(Math.random() * orderQuotes.length)];
                
                showOrderSummaryModal('Order Placed!', confirmationMessage, summaryDetailsHtml, randomQuote);
                
                if (appState.currentView === 'admin-dashboard') {
                    renderAdminOrders();
                }
                if (appState.currentView === 'delivery-dashboard') {
                    renderDeliveryOrders();
                }
            };
            
            const renderCartPage = () => {
                const total = appState.cart.reduce((sum, item) => sum + (item.price * item.quantity), 0);
                let cartContent = '';
                if (appState.cart.length === 0) {
                    cartContent = '<p class="text-gray-500 text-center">Your cart is empty.</p>';
                } else {
                    cartContent = appState.cart.map(item => `
                        <div class="flex justify-between items-center p-4 bg-gray-50 rounded-lg">
                            <div>
                                <p class="font-semibold">${item.name}</p>
                                <p class="text-sm text-gray-600">Quantity: ${item.quantity}</p>
                            </div>
                            <span class="font-bold">₹${(item.price * item.quantity).toFixed(2)}</span>
                        </div>
                    `).join('');
                }
                
                mainContent.innerHTML = `
                    <div class="container mx-auto px-6 py-12">
                        <div class="max-w-3xl mx-auto bg-white p-8 rounded-xl shadow-lg">
                            <h2 class="text-3xl font-bold mb-8 text-gray-900">Your Cart</h2>
                            <div id="cart-items-container" class="space-y-4">
                                ${cartContent}
                            </div>
                            <div class="mt-8 pt-4 border-t border-gray-200 flex justify-between items-center text-2xl font-bold">
                                <span>Total:</span>
                                <span>₹${total.toFixed(2)}</span>
                            </div>
                            <div class="mt-8 space-y-4">
                                <h3 class="text-xl font-semibold">Choose Service Type:</h3>
                                <div class="flex justify-between space-x-4">
                                    <button id="service-delivery-btn" class="service-btn flex-1 bg-red-500 text-white font-semibold py-3 rounded-lg hover:bg-red-600 transition">
                                        <i class="fas fa-motorcycle mr-2"></i>Delivery
                                    </button>
                                    <button id="service-takeaway-btn" class="service-btn flex-1 bg-yellow-500 text-gray-900 font-semibold py-3 rounded-lg hover:bg-yellow-600 transition">
                                        <i class="fas fa-shopping-bag mr-2"></i>Take Away
                                    </button>
                                    <button id="service-dinein-btn" class="service-btn flex-1 bg-green-500 text-white font-semibold py-3 rounded-lg hover:bg-green-600 transition">
                                        <i class="fas fa-utensils mr-2"></i>Dine In
                                    </button>
                                </div>
                                <div id="service-options-container"></div>
                                <div class="mt-8 flex justify-between space-x-4">
                                    <button id="continue-shopping-btn" class="flex-1 border border-gray-300 text-gray-700 py-3 rounded-lg font-semibold hover:bg-gray-100 transition">
                                        Continue Shopping
                                    </button>
                                    <button id="checkout-btn" class="flex-1 bg-red-600 text-white py-3 rounded-lg font-semibold hover:bg-red-700 transition">
                                        Checkout
                                    </button>
                                </div>
                            </div>
                        </div>
                    </div>
                `;
                
                document.getElementById('continue-shopping-btn').addEventListener('click', () => renderView('customer-website'));
                document.getElementById('checkout-btn').addEventListener('click', handleCheckout);
                document.getElementById('service-delivery-btn').addEventListener('click', () => renderServiceOptions('delivery'));
                document.getElementById('service-takeaway-btn').addEventListener('click', () => renderServiceOptions('takeaway'));
                document.getElementById('service-dinein-btn').addEventListener('click', () => renderServiceOptions('dinein'));
            };

            const renderServiceOptions = (serviceType) => {
                const optionsContainer = document.getElementById('service-options-container');
                optionsContainer.innerHTML = '';
                appState.serviceType = serviceType;
                appState.tableNumber = null;
                appState.customerInfo = null;
                
                if (serviceType === 'delivery') {
                    optionsContainer.innerHTML = `
                        <div class="mt-6 space-y-4">
                            <h4 class="text-lg font-semibold">Delivery Details:</h4>
                            <form id="delivery-details-form" class="space-y-4">
                                <input type="text" id="customer-name" placeholder="Your Name" required class="w-full px-4 py-2 border rounded-md">
                                <input type="tel" id="customer-phone" placeholder="Phone Number" required class="w-full px-4 py-2 border rounded-md">
                                <input type="text" id="customer-address" placeholder="Address" required class="w-full px-4 py-2 border rounded-md">
                                <input type="text" id="customer-landmark" placeholder="Landmark" required class="w-full px-4 py-2 border rounded-md">
                                <div class="rounded-lg overflow-hidden shadow-lg mb-6 h-64">
                                    <div id="map" class="w-full h-full"></div>
                                </div>
                            </form>
                        </div>
                    `;
                    
                    const initMap = () => {
                        const defaultLocation = { lat: 17.32700098801938, lng: 76.82999931487766 };
                        const map = new google.maps.Map(document.getElementById('map'), {
                            zoom: 15,
                            center: defaultLocation,
                        });
                        let marker = new google.maps.Marker({
                            position: defaultLocation,
                            map: map,
                            draggable: true
                        });
                        map.addListener('click', (event) => {
                            marker.setPosition(event.latLng);
                            appState.customerInfo.location = {
                                lat: event.latLng.lat(),
                                lng: event.latLng.lng()
                            };
                        });
                    };

                    const script = document.createElement('script');
                    script.src = `https://maps.googleapis.com/maps/api/js?key=AIzaSyBhLn0CUcyUxslVSg4_5m5UfTUMtKM0PRM&callback=initMap`;
                    script.defer = true;
                    document.head.appendChild(script);
                    window.initMap = initMap;
                    
                    document.getElementById('delivery-details-form').addEventListener('input', (e) => {
                        appState.customerInfo = {
                            name: document.getElementById('customer-name').value,
                            phone: document.getElementById('customer-phone').value,
                            address: document.getElementById('customer-address').value,
                            landmark: document.getElementById('customer-landmark').value,
                            location: appState.customerInfo?.location || { lat: 17.32700098801938, lng: 76.82999931487766 }
                        };
                    });
                } else if (serviceType === 'dinein') {
                    optionsContainer.innerHTML = `
                        <div class="mt-6 space-y-4">
                            <h4 class="text-lg font-semibold">Select a Table:</h4>
                            <div id="table-grid" class="grid grid-cols-4 gap-4"></div>
                        </div>
                    `;
                    renderTableButtons();
                }
                
                document.querySelectorAll('.service-btn').forEach(btn => btn.classList.remove('active'));
                document.getElementById(`service-${serviceType}-btn`).classList.add('active');
            };


            const renderTableButtons = () => {
                const tableGrid = document.getElementById('table-grid');
                if (!tableGrid) return;
                tableGrid.innerHTML = '';
                for (let i = 1; i <= 7; i++) {
                    const tableBtn = document.createElement('button');
                    tableBtn.textContent = `Table ${i}`;
                    tableBtn.className = "bg-gray-200 text-gray-800 p-3 rounded-lg font-semibold hover:bg-gray-300 transition";
                    tableBtn.dataset.tableNumber = i;
                    tableBtn.addEventListener('click', () => {
                        document.querySelectorAll('#table-grid button').forEach(btn => btn.classList.remove('bg-red-500', 'text-white'));
                        tableBtn.classList.add('bg-red-500', 'text-white');
                        appState.tableNumber = i;
                    });
                    tableGrid.appendChild(tableBtn);
                }
            };
            
            // =================================================================
            // AUTHENTICATION LOGIC
            // =================================================================
            const handleLogin = (e) => {
                e.preventDefault();
                const username = document.getElementById('username').value;
                const password = document.getElementById('password').value;
                const user = appState.users[username];

                if (user && user.password === password) {
                    setLoggedInUser(username, user.role);
                    hideLoginModal();
                    if(appState.previousView === 'cart') {
                      renderView('cart');
                    } else if (user.role === 'admin') {
                      window.location.href = 'admin.html';
                    } else {
                      renderView('customer-website');
                    }
                    showMessageModal('Login Successful', `Welcome, ${user.role}!`);
                } else {
                    showMessageModal('Login Failed', 'Invalid username or password.');
                }
            };

            const handleSignup = (e) => {
                e.preventDefault();
                const username = document.getElementById('signup-username').value;
                const password = document.getElementById('signup-password').value;
                const confirmPassword = document.getElementById('signup-confirm-password').value;
                const uniqueCode = document.getElementById('signup-code').value;

                if (password !== confirmPassword) {
                    showMessageModal('Signup Failed', 'Passwords do not match.');
                    return;
                }

                if (appState.users[username]) {
                    showMessageModal('Signup Failed', 'Username already exists.');
                    return;
                }
                
                let userRole = 'customer';
                if (uniqueCode === appState.adminCode) {
                    userRole = 'admin';
                } else if (uniqueCode === appState.deliveryCode) {
                    userRole = 'delivery';
                    appState.deliveryPartners.push(username);
                } else if (uniqueCode) {
                    showMessageModal('Signup Failed', 'Invalid unique code.');
                    return;
                }

                appState.users[username] = { password, role: userRole };
                saveAppState();
                showMessageModal('Success!', 'Account created successfully. You can now log in.');
                loginContainer.classList.remove('right-panel-active');
            };

            // =================================================================
            // DATA MANAGEMENT & RENDERING FUNCTIONS (Not in customer view, but needed for state)
            // =================================================================
            const renderMenuItems = () => {
                const menuGrid = document.getElementById('menu-grid');
                if (!menuGrid) return;
                
                const categoryButtons = document.querySelectorAll('.menu-category-btn');
                categoryButtons.forEach(btn => {
                    btn.addEventListener('click', () => {
                        categoryButtons.forEach(b => b.classList.remove('active'));
                        btn.classList.add('active');
                        const categoryId = btn.dataset.categoryId;
                        filterAndRenderMenu(categoryId);
                    });
                });

                filterAndRenderMenu('all');
            };

            const filterAndRenderMenu = (categoryId) => {
                const menuGrid = document.getElementById('menu-grid');
                if (!menuGrid) return;
                
                let itemsToRender = appState.menuItems;
                if (categoryId !== 'all') {
                    itemsToRender = appState.menuItems.filter(item => item.categoryId === categoryId);
                }
                
                menuGrid.innerHTML = itemsToRender.map(item => `
                    <div class="bg-white rounded-lg shadow-lg overflow-hidden transform hover:scale-105 transition-transform duration-300">
                        <img src="${item.image}" alt="${item.name}" class="w-full menu-card-image" onerror="this.src='https://placehold.co/600x400/cccccc/ffffff?text=Image+Not+Found';">
                        <div class="p-6">
                            <h3 class="text-2xl font-bold mb-4 text-red-600">${item.name}</h3>
                            <div class="space-y-3 text-gray-700">
                                <div class="flex justify-between items-center">
                                    <span>Price - ₹${item.price}</span>
                                    <button class="add-to-cart-btn bg-red-500 text-white px-3 py-1 rounded-full text-sm" data-id="${item.id}" data-name="${item.name}" data-price="${item.price}">Add</button>
                                </div>
                            </div>
                        </div>
                    </div>
                `).join('');
            };

            const addToCart = (id, name, price) => {
                if(!appState.loggedInUser) {
                    appState.previousView = 'customer-website';
                    showLoginModal();
                    return;
                }
                const existingItem = appState.cart.find(item => item.id === id);
                if (existingItem) {
                    existingItem.quantity++;
                } else {
                    appState.cart.push({ id, name, price, quantity: 1 });
                }
                saveAppState();
                
                const cartPopup = document.getElementById('cart-popup');
                const popupText = document.getElementById('popup-text');
                popupText.textContent = `${name} added to cart!`;
                cartPopup.classList.remove('translate-y-full', 'opacity-0');
                cartPopup.classList.add('-translate-y-4');
                clearTimeout(cartPopup.timeout);
                cartPopup.timeout = setTimeout(() => {
                    cartPopup.classList.add('translate-y-full', 'opacity-0');
                    cartPopup.classList.remove('-translate-y-4');
                }, 3000);
            };

            const handleCheckout = () => {
                if (appState.cart.length === 0) {
                    showMessageModal('Empty Cart', 'Please add items to your cart before checking out.');
                    return;
                }
                
                if (!appState.loggedInUser) {
                    appState.previousView = 'cart';
                    showLoginModal();
                    return;
                }
                
                const serviceType = appState.serviceType;
                
                if (!serviceType) {
                    showMessageModal('Service Required', 'Please select a service type before checking out.');
                    return;
                }
                
                let orderDetails = {};
                let summaryDetailsHtml = '';
                let confirmationMessage = '';
                
                const customerName = document.getElementById('customer-name')?.value || 'N/A';
                const customerPhone = document.getElementById('customer-phone')?.value || 'N/A';
                const customerAddress = document.getElementById('customer-address')?.value || 'N/A';
                const customerLandmark = document.getElementById('customer-landmark')?.value || 'N/A';
                
                if (serviceType === 'delivery') {
                    if (!customerName || !customerPhone || !customerAddress) {
                        showMessageModal('Details Required', 'Please fill in all delivery details.');
                        return;
                    }
                    const orderCode = `BnM-${Math.floor(1000 + Math.random() * 9000)}`;
                    orderDetails = {
                        id: `order-${Date.now()}`,
                        code: orderCode,
                        customer: appState.loggedInUser.username,
                        items: appState.cart,
                        service: 'Delivery',
                        status: 'Pending',
                        timestamp: new Date().toLocaleTimeString(),
                        deliveryInfo: { name: customerName, phone: customerPhone, address: customerAddress, landmark: customerLandmark }
                    };
                    confirmationMessage = 'Thank you! We have received your order. 😊';
                    summaryDetailsHtml = `
                        <p><strong>Order Code:</strong> <span class="font-bold">${orderCode}</span></p>
                        <p><strong>Service:</strong> Delivery</p>
                        <h4 class="font-semibold mt-4">Delivery Details:</h4>
                        <p><strong>Name:</strong> ${customerName}</p>
                        <p><strong>Phone:</strong> ${customerPhone}</p>
                        <p><strong>Address:</strong> ${customerAddress}, ${customerLandmark}</p>
                    `;
                } else if (serviceType === 'takeaway') {
                    const orderCode = `BnM-${Math.floor(1000 + Math.random() * 9000)}`;
                    orderDetails = {
                        id: `order-${Date.now()}`,
                        code: orderCode,
                        customer: appState.loggedInUser.username,
                        items: appState.cart,
                        service: 'Take Away',
                        status: 'Pending',
                        timestamp: new Date().toLocaleTimeString()
                    };
                    confirmationMessage = 'Thank you for your order! It will be ready for pickup shortly. 😊';
                    summaryDetailsHtml = `
                        <p><strong>Order Code:</strong> <span class="font-bold">${orderCode}</span></p>
                        <p><strong>Service:</strong> Take Away</p>
                    `;
                } else if (serviceType === 'dinein') {
                    if (!appState.tableNumber) {
                        showMessageModal('Table Required', 'Please select a table number for dine-in service.');
                        return;
                    }
                    orderDetails = {
                        id: `order-${Date.now()}`,
                        customer: appState.loggedInUser.username,
                        items: appState.cart,
                        service: 'Dine In',
                        table: appState.tableNumber,
                        status: 'Pending',
                        timestamp: new Date().toLocaleTimeString()
                    };
                    confirmationMessage = `Your order has been placed for Table ${appState.tableNumber}. Enjoy! 😊`;
                    summaryDetailsHtml = `
                        <p><strong>Service:</strong> Dine In</p>
                        <p><strong>Table:</strong> <span class="font-bold">${appState.tableNumber}</span></p>
                    `;
                }
                
                appState.orders.push(orderDetails);
                appState.cart = [];
                saveAppState();
                
                const randomQuote = orderQuotes[Math.floor(Math.random() * orderQuotes.length)];
                
                showOrderSummaryModal('Order Placed!', confirmationMessage, summaryDetailsHtml, randomQuote);
                
                if (appState.currentView === 'admin-dashboard') {
                    renderAdminOrders();
                }
                if (appState.currentView === 'delivery-dashboard') {
                    renderDeliveryOrders();
                }
            };
            
            document.body.addEventListener('click', (e) => {
                if (e.target.classList.contains('add-to-cart-btn')) {
                    const { id, name, price } = e.target.dataset;
                    addToCart(id, name, parseFloat(price));
                }
            });

            loginBtn.addEventListener('click', showLoginModal);
            logoutBtn.addEventListener('click', logout);
            changePasswordBtn.addEventListener('click', () => {
                passwordModal.classList.remove('hidden');
                passwordModal.classList.add('flex');
                changePasswordForm.reset();
            });
            cancelPasswordChangeBtn.addEventListener('click', () => {
                passwordModal.classList.add('hidden');
                passwordModal.classList.remove('flex');
            });
            changePasswordForm.addEventListener('submit', handleChangePassword);

            orderOnlineBtn.addEventListener('click', () => {
                if (appState.cart.length === 0) {
                    showMessageModal('Cart Empty', 'Your cart is empty. Please add items from the menu first!');
                } else {
                    if (!appState.loggedInUser) {
                        appState.previousView = 'cart';
                        showLoginModal();
                    } else {
                        renderView('cart');
                    }
                }
            });
            
            homeLink.addEventListener('click', (e) => {
                e.preventDefault();
                renderView('customer-website');
            });
            
            loginForm.addEventListener('submit', handleLogin);
            signupForm.addEventListener('submit', handleSignup);
            
            document.addEventListener('click', (e) => {
                const signUpButton = e.target.closest('#signUp');
                const signInButton = e.target.closest('#signIn');

                if (signUpButton && loginContainer) {
                    loginContainer.classList.add("right-panel-active");
                }
                if (signInButton && loginContainer) {
                    loginContainer.classList.remove("right-panel-active");
                }
            });
            
            loadAppState();
            updateUIForUser();
            if (!appState.loggedInUser) {
                showLoginModal();
            }
        });
    </script>
</body>

</html>
�
